2022-03-09 11:58:32.712 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5004 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 11:58:37.722 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 70746 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 11:58:37.723 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 11:58:38.910 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 11:58:38.913 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 11:58:38.936 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 11:58:38.941 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 11:58:38.942 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 11:58:38.952 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 8 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 11:58:38.968 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 11:58:38.970 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 11:58:38.989 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2022-03-09 11:58:39.786 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 11:58:39.808 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 11:58:39.809 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 11:58:39.809 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 11:58:39.968 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 11:58:39.968 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2176 ms
2022-03-09 11:58:40.398 [main] ERROR org.mybatis.spring.mapper.MapperFactoryBean - Error while adding the mapper 'interface com.zmj.demo.dao.dev1.AccountDao' to configuration.
org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.getSqlSourceFromAnnotations(MapperAnnotationBuilder.java:472)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.parseStatement(MapperAnnotationBuilder.java:289)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.parse(MapperAnnotationBuilder.java:134)
	at org.apache.ibatis.binding.MapperRegistry.addMapper(MapperRegistry.java:72)
	at org.apache.ibatis.session.Configuration.addMapper(Configuration.java:728)
	at org.mybatis.spring.mapper.MapperFactoryBean.checkDaoConfig(MapperFactoryBean.java:80)
	at org.springframework.dao.support.DaoSupport.afterPropertiesSet(DaoSupport.java:44)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1845)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:602)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1380)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1300)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:657)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:640)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:119)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:399)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1413)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:944)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:918)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:583)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:145)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:434)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:338)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1332)
	at com.zmj.demo.DemoApplication.main(DemoApplication.java:10)
Caused by: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.apache.ibatis.parsing.XPathParser.createDocument(XPathParser.java:259)
	at org.apache.ibatis.parsing.XPathParser.<init>(XPathParser.java:115)
	at org.apache.ibatis.scripting.xmltags.XMLLanguageDriver.createSqlSource(XMLLanguageDriver.java:51)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.buildSqlSourceFromStrings(MapperAnnotationBuilder.java:482)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.getSqlSourceFromAnnotations(MapperAnnotationBuilder.java:465)
	... 38 common frames omitted
Caused by: org.xml.sax.SAXParseException: 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:203)
	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:400)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:327)
	at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1473)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1749)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2967)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:602)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:505)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:842)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:771)
	at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:141)
	at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(DOMParser.java:243)
	at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(DocumentBuilderImpl.java:339)
	at org.apache.ibatis.parsing.XPathParser.createDocument(XPathParser.java:257)
	... 42 common frames omitted
2022-03-09 11:58:40.400 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlUtil': Unsatisfied dependency expressed through field 'accountDao'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'accountDao' defined in file [/Users/mac/tools/gitPro/515/demo/target/classes/com/zmj/demo/dao/dev1/AccountDao.class]: Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
2022-03-09 11:58:40.403 [main] INFO  org.apache.catalina.core.StandardService - Stopping service [Tomcat]
2022-03-09 11:58:40.421 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLoggingListener - 

Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.
2022-03-09 11:58:40.441 [main] ERROR org.springframework.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlUtil': Unsatisfied dependency expressed through field 'accountDao'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'accountDao' defined in file [/Users/mac/tools/gitPro/515/demo/target/classes/com/zmj/demo/dao/dev1/AccountDao.class]: Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:660)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:640)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:119)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:399)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1413)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:944)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:918)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:583)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:145)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:434)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:338)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1332)
	at com.zmj.demo.DemoApplication.main(DemoApplication.java:10)
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'accountDao' defined in file [/Users/mac/tools/gitPro/515/demo/target/classes/com/zmj/demo/dao/dev1/AccountDao.class]: Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:602)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1380)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1300)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:657)
	... 20 common frames omitted
Caused by: java.lang.IllegalArgumentException: org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.mybatis.spring.mapper.MapperFactoryBean.checkDaoConfig(MapperFactoryBean.java:83)
	at org.springframework.dao.support.DaoSupport.afterPropertiesSet(DaoSupport.java:44)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1845)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 30 common frames omitted
Caused by: org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.getSqlSourceFromAnnotations(MapperAnnotationBuilder.java:472)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.parseStatement(MapperAnnotationBuilder.java:289)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.parse(MapperAnnotationBuilder.java:134)
	at org.apache.ibatis.binding.MapperRegistry.addMapper(MapperRegistry.java:72)
	at org.apache.ibatis.session.Configuration.addMapper(Configuration.java:728)
	at org.mybatis.spring.mapper.MapperFactoryBean.checkDaoConfig(MapperFactoryBean.java:80)
	... 33 common frames omitted
Caused by: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.apache.ibatis.parsing.XPathParser.createDocument(XPathParser.java:259)
	at org.apache.ibatis.parsing.XPathParser.<init>(XPathParser.java:115)
	at org.apache.ibatis.scripting.xmltags.XMLLanguageDriver.createSqlSource(XMLLanguageDriver.java:51)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.buildSqlSourceFromStrings(MapperAnnotationBuilder.java:482)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.getSqlSourceFromAnnotations(MapperAnnotationBuilder.java:465)
	... 38 common frames omitted
Caused by: org.xml.sax.SAXParseException: 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:203)
	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:400)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:327)
	at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1473)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1749)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2967)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:602)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:505)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:842)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:771)
	at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:141)
	at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(DOMParser.java:243)
	at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(DocumentBuilderImpl.java:339)
	at org.apache.ibatis.parsing.XPathParser.createDocument(XPathParser.java:257)
	... 42 common frames omitted
2022-03-09 12:03:15.351 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5006 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 12:03:20.362 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 70804 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 12:03:20.363 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 12:03:21.190 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:03:21.192 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:03:21.209 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 12 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 12:03:21.213 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:03:21.214 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:03:21.221 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 12:03:21.233 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:03:21.234 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 12:03:21.249 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2022-03-09 12:03:21.866 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 12:03:21.880 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 12:03:21.881 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 12:03:21.881 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 12:03:22.013 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 12:03:22.014 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1592 ms
2022-03-09 12:03:22.364 [main] ERROR org.mybatis.spring.mapper.MapperFactoryBean - Error while adding the mapper 'interface com.zmj.demo.dao.dev1.AccountDao' to configuration.
org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.getSqlSourceFromAnnotations(MapperAnnotationBuilder.java:472)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.parseStatement(MapperAnnotationBuilder.java:289)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.parse(MapperAnnotationBuilder.java:134)
	at org.apache.ibatis.binding.MapperRegistry.addMapper(MapperRegistry.java:72)
	at org.apache.ibatis.session.Configuration.addMapper(Configuration.java:728)
	at org.mybatis.spring.mapper.MapperFactoryBean.checkDaoConfig(MapperFactoryBean.java:80)
	at org.springframework.dao.support.DaoSupport.afterPropertiesSet(DaoSupport.java:44)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1845)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:602)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1380)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1300)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:657)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:640)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:119)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:399)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1413)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:944)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:918)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:583)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:145)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:434)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:338)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1332)
	at com.zmj.demo.DemoApplication.main(DemoApplication.java:10)
Caused by: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.apache.ibatis.parsing.XPathParser.createDocument(XPathParser.java:259)
	at org.apache.ibatis.parsing.XPathParser.<init>(XPathParser.java:115)
	at org.apache.ibatis.scripting.xmltags.XMLLanguageDriver.createSqlSource(XMLLanguageDriver.java:51)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.buildSqlSourceFromStrings(MapperAnnotationBuilder.java:482)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.getSqlSourceFromAnnotations(MapperAnnotationBuilder.java:465)
	... 38 common frames omitted
Caused by: org.xml.sax.SAXParseException: 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:203)
	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:400)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:327)
	at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1473)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1749)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2967)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:602)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:505)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:842)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:771)
	at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:141)
	at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(DOMParser.java:243)
	at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(DocumentBuilderImpl.java:339)
	at org.apache.ibatis.parsing.XPathParser.createDocument(XPathParser.java:257)
	... 42 common frames omitted
2022-03-09 12:03:22.366 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlUtil': Unsatisfied dependency expressed through field 'accountDao'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'accountDao' defined in file [/Users/mac/tools/gitPro/515/demo/target/classes/com/zmj/demo/dao/dev1/AccountDao.class]: Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
2022-03-09 12:03:22.370 [main] INFO  org.apache.catalina.core.StandardService - Stopping service [Tomcat]
2022-03-09 12:03:22.387 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLoggingListener - 

Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.
2022-03-09 12:03:22.403 [main] ERROR org.springframework.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlUtil': Unsatisfied dependency expressed through field 'accountDao'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'accountDao' defined in file [/Users/mac/tools/gitPro/515/demo/target/classes/com/zmj/demo/dao/dev1/AccountDao.class]: Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:660)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:640)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:119)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:399)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1413)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:944)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:918)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:583)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:145)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:434)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:338)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1332)
	at com.zmj.demo.DemoApplication.main(DemoApplication.java:10)
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'accountDao' defined in file [/Users/mac/tools/gitPro/515/demo/target/classes/com/zmj/demo/dao/dev1/AccountDao.class]: Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:602)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1380)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1300)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:657)
	... 20 common frames omitted
Caused by: java.lang.IllegalArgumentException: org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.mybatis.spring.mapper.MapperFactoryBean.checkDaoConfig(MapperFactoryBean.java:83)
	at org.springframework.dao.support.DaoSupport.afterPropertiesSet(DaoSupport.java:44)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1845)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 30 common frames omitted
Caused by: org.apache.ibatis.builder.BuilderException: Could not find value method on SQL annotation.  Cause: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.getSqlSourceFromAnnotations(MapperAnnotationBuilder.java:472)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.parseStatement(MapperAnnotationBuilder.java:289)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.parse(MapperAnnotationBuilder.java:134)
	at org.apache.ibatis.binding.MapperRegistry.addMapper(MapperRegistry.java:72)
	at org.apache.ibatis.session.Configuration.addMapper(Configuration.java:728)
	at org.mybatis.spring.mapper.MapperFactoryBean.checkDaoConfig(MapperFactoryBean.java:80)
	... 33 common frames omitted
Caused by: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 327; 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at org.apache.ibatis.parsing.XPathParser.createDocument(XPathParser.java:259)
	at org.apache.ibatis.parsing.XPathParser.<init>(XPathParser.java:115)
	at org.apache.ibatis.scripting.xmltags.XMLLanguageDriver.createSqlSource(XMLLanguageDriver.java:51)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.buildSqlSourceFromStrings(MapperAnnotationBuilder.java:482)
	at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.getSqlSourceFromAnnotations(MapperAnnotationBuilder.java:465)
	... 38 common frames omitted
Caused by: org.xml.sax.SAXParseException: 元素类型 "script" 必须由匹配的结束标记 "</script>" 终止。
	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:203)
	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:400)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:327)
	at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1473)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1749)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2967)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:602)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:505)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:842)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:771)
	at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:141)
	at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(DOMParser.java:243)
	at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(DocumentBuilderImpl.java:339)
	at org.apache.ibatis.parsing.XPathParser.createDocument(XPathParser.java:257)
	... 42 common frames omitted
2022-03-09 12:04:38.001 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5003 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 12:04:43.013 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 70820 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 12:04:43.014 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 12:04:43.802 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:04:43.804 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:04:43.822 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 13 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 12:04:43.827 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:04:43.827 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:04:43.836 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 8 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 12:04:43.847 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:04:43.848 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 12:04:43.863 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2022-03-09 12:04:44.510 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 12:04:44.523 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 12:04:44.524 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 12:04:44.524 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 12:04:44.651 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 12:04:44.651 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1582 ms
2022-03-09 12:04:45.944 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 12:04:46.948 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 12:04:46.950 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 12:04:46.950 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 12:04:47.308 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 12:04:47.331 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 12:04:47.347 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 24.899 seconds (JVM running for 25.41)
2022-03-09 12:05:23.731 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 12:05:23.732 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 12:05:23.733 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2022-03-09 12:05:24.238 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 12:05:25.466 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 12:05:25.478 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 11:34:00' and user_id = ? and type not in (16,27) 
2022-03-09 12:05:25.525 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:05:25.651 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:05:25.656 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:05:25.657 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:05:25.748 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:05:25.749 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:05:25.770 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:0E-16,操作后，计算剩余的金额:636.5348494800000000,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:05:25.770 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:05:25.771 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:05:25.862 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:05:25.863 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:05:25.864 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:05:25.953 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:05:25.954 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:05:25.955 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:05:26.054 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:05:26.055 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:05:26.056 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:05:26.144 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:05:26.146 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:05:26.146 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:05:26.236 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:05:26.236 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:05:26.237 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 11:34:00' 
2022-03-09 12:05:26.238 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:05:26.329 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 12:05:26.330 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-218.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:05:26.330 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:05:26.330 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-218.5660032258064516
2022-03-09 12:05:26.337 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:05:26.337 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:05:26.428 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:05:26.428 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:05:26.429 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:05:26.518 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:05:26.520 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:05:26.520 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:05:26.608 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:05:26.610 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:05:26.611 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:05:26.701 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:05:26.781 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:05:26.782 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:05:26.871 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:05:26.872 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 12:05:26.873 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:05:26.873 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:05:26.977 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:05:26.978 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 12:05:26.980 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:05:26.980 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:05:26.982 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:05:26.982 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:05:27.071 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:05:27.072 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 12:05:27.072 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:05:27.073 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:05:27.075 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:05:27.163 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:05:27.176 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 12:05:27.176 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:05:27.176 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:05:27.176 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:05:27.263 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:05:27.264 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:05:27.264 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:05:27.353 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:05:27.354 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 手续费计算不正确--->用户:51905047,订单:4667,类型:52
2022-03-09 12:05:27.354 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:05:27.355 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:05:27.442 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:05:27.442 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 12:05:27.443 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:05:27.443 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:05:27.531 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:05:27.533 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:05:27.533 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:05:27.621 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:05:27.621 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:05:27.622 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:05:27.708 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:05:27.709 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:05:27.709 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:05:27.802 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:05:27.803 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:05:27.803 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:05:27.890 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:05:27.891 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 12:05:27.891 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:05:27.891 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:05:27.980 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:05:27.980 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 12:05:27.981 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:05:27.981 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:05:28.077 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:05:28.077 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 12:05:28.077 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:05:28.078 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:05:28.168 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:05:28.168 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 12:05:28.169 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:08:36.305 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2022-03-09 12:08:36.322 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2022-03-09 12:08:56.303 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5004 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 12:09:01.312 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 70924 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 12:09:01.313 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 12:09:02.268 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:09:02.271 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:09:02.291 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 15 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 12:09:02.297 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:09:02.298 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:09:02.304 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 12:09:02.316 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:09:02.318 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 12:09:02.336 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2022-03-09 12:09:03.140 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 12:09:03.158 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 12:09:03.159 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 12:09:03.159 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 12:09:03.296 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 12:09:03.296 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1924 ms
2022-03-09 12:09:04.672 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 12:09:05.382 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 12:09:05.384 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 12:09:05.384 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 12:09:05.661 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 12:09:05.685 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 12:09:05.703 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 25.033 seconds (JVM running for 25.522)
2022-03-09 12:09:09.451 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 12:09:09.452 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 12:09:09.454 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2022-03-09 12:09:09.891 [http-nio-10090-exec-2] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 12:09:11.105 [http-nio-10090-exec-2] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 12:09:11.113 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 11:34:00' and user_id = ? and type not in (16,27) 
2022-03-09 12:09:11.150 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:09:11.270 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:09:11.274 [http-nio-10090-exec-2] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:09:11.275 [http-nio-10090-exec-2] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:09:11.364 [http-nio-10090-exec-2] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:09:11.365 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:09:11.382 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:0E-16,操作后，计算剩余的金额:636.5348494800000000,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:09:11.383 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:09:11.383 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:09:11.474 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:09:11.476 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:09:11.477 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:09:11.572 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:09:11.573 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:09:11.574 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:09:11.663 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:09:11.664 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:09:11.665 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:09:11.753 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:09:11.754 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:09:11.755 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:09:11.843 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:09:11.844 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:09:11.845 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 11:34:00' 
2022-03-09 12:09:11.845 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:09:11.945 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 12:09:11.945 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-218.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:09:11.946 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:09:11.946 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-218.5660032258064516
2022-03-09 12:09:11.954 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:09:11.954 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:09:12.048 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:09:12.049 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:09:12.050 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:09:12.146 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:09:12.147 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:09:12.147 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:09:12.240 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:09:12.241 [http-nio-10090-exec-2] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:09:12.242 [http-nio-10090-exec-2] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:09:12.332 [http-nio-10090-exec-2] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:09:12.396 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:09:12.397 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:09:12.490 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:09:12.491 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 12:09:12.492 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:09:12.493 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:09:12.584 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:09:12.584 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 12:09:12.585 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:09:12.585 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:09:12.586 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:09:12.587 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:09:12.684 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:09:12.684 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 12:09:12.685 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:09:12.686 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:09:12.688 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:09:12.784 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:09:12.787 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 12:09:12.787 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:09:12.788 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:09:12.789 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:09:12.877 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:09:12.879 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:09:12.879 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:09:13.060 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:09:13.062 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:09:13.063 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:09:13.152 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:09:13.153 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 12:09:13.154 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:09:13.155 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:09:13.243 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:09:13.244 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:09:13.245 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:09:13.332 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:09:13.333 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:09:13.333 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:09:13.420 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:09:13.421 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:09:13.421 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:09:13.509 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:09:13.513 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:09:13.514 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:09:13.607 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:09:13.608 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 12:09:13.610 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:09:13.610 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:09:13.698 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:09:13.698 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 12:09:13.699 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:09:13.699 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:09:13.803 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:09:13.804 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 12:09:13.805 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:09:13.806 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:09:13.900 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:09:13.900 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 12:09:13.900 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:27:08.678 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=12m57s433ms).
2022-03-09 12:29:34.175 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2022-03-09 12:29:34.186 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2022-03-09 12:29:53.290 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5004 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 12:29:58.304 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 71232 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 12:29:58.305 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 12:29:59.252 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:29:59.256 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:29:59.282 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 12:29:59.288 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:29:59.289 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:29:59.298 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 12:29:59.312 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:29:59.313 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 12:29:59.334 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2022-03-09 12:30:00.498 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 12:30:00.509 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 12:30:00.510 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 12:30:00.510 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 12:30:00.632 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 12:30:00.632 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2267 ms
2022-03-09 12:30:02.257 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 12:30:03.269 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 12:30:03.270 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 12:30:03.271 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 12:30:03.517 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 12:30:03.533 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 12:30:03.545 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 25.97 seconds (JVM running for 26.49)
2022-03-09 12:30:16.321 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 12:30:16.321 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 12:30:16.323 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2022-03-09 12:30:16.736 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 12:30:17.968 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 12:30:17.980 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 11:34:00' and user_id = ? and type not in (16,27) 
2022-03-09 12:30:18.016 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:30:18.183 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:30:18.191 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:30:18.191 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:30:18.285 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:30:18.286 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:30:18.300 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:0E-16,操作后，计算剩余的金额:636.5348494800000000,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:30:18.301 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:30:18.302 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:30:18.404 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:30:18.405 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:30:18.406 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:30:18.500 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:30:18.501 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:30:18.501 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:30:18.596 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:30:18.598 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:30:18.599 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:30:18.697 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:30:18.700 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:30:18.700 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:30:18.795 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:30:18.796 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:30:18.798 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 11:34:00' 
2022-03-09 12:30:18.799 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:30:18.900 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 12:30:18.900 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-218.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:30:18.901 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:30:18.901 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-218.5660032258064516
2022-03-09 12:30:18.909 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:30:18.909 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:30:19.007 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:30:19.008 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:30:19.008 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:30:19.107 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:30:19.108 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:30:19.108 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:30:19.206 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:30:19.208 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:30:19.209 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:30:19.302 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:30:19.356 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:30:19.356 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:30:19.451 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:30:19.452 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.00715000
2022-03-09 12:30:19.453 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:30:19.454 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:30:19.548 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:30:19.549 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.06435000
2022-03-09 12:30:19.549 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:30:19.550 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:30:19.552 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:30:19.553 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:30:19.647 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:30:19.648 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.93125559
2022-03-09 12:30:19.648 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:30:19.648 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:30:19.649 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:30:19.754 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:30:19.757 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.38130038
2022-03-09 12:30:19.757 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:30:19.758 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:30:19.758 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:30:19.854 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:30:19.856 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:30:19.856 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:30:19.953 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:30:19.956 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:30:19.957 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:30:20.050 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:30:20.051 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.08295000,计算:0.08295027
2022-03-09 12:30:20.052 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:30:20.053 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:30:20.144 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:30:20.145 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:30:20.145 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:30:20.239 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:30:20.240 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:30:20.241 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:30:20.333 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:30:20.334 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:30:20.334 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:30:20.429 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:30:20.430 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:30:20.430 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:30:20.530 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:30:20.531 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.22396574
2022-03-09 12:30:20.532 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:30:20.532 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:30:20.625 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:30:20.625 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.14931049
2022-03-09 12:30:20.626 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:30:20.626 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:30:20.720 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:30:20.720 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.29862099
2022-03-09 12:30:20.721 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:30:20.722 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:30:20.816 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:30:20.817 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.07465524
2022-03-09 12:30:20.817 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:31:00.564 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2022-03-09 12:31:00.575 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2022-03-09 12:31:19.803 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5004 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 12:31:24.814 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 71247 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 12:31:24.815 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 12:31:25.603 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:31:25.605 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:31:25.622 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 13 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 12:31:25.627 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:31:25.627 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:31:25.634 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 12:31:25.644 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:31:25.646 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 12:31:25.660 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2022-03-09 12:31:26.311 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 12:31:26.322 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 12:31:26.323 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 12:31:26.323 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 12:31:26.450 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 12:31:26.450 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1578 ms
2022-03-09 12:31:27.525 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 12:31:28.258 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 12:31:28.259 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 12:31:28.259 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 12:31:28.482 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 12:31:28.502 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 12:31:28.513 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 24.25 seconds (JVM running for 24.749)
2022-03-09 12:32:18.646 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 12:32:18.647 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 12:32:18.648 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2022-03-09 12:32:19.078 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 12:32:20.168 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 12:32:20.179 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 11:34:00' and user_id = ? and type not in (16,27) 
2022-03-09 12:32:20.210 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:32:20.328 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:32:20.334 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:32:20.335 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:32:20.417 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:32:20.417 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:32:20.429 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:0E-16,操作后，计算剩余的金额:636.5348494800000000,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:32:20.430 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:32:20.430 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:32:20.517 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:32:20.518 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:32:20.518 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:32:20.599 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:32:20.600 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:32:20.601 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:32:20.683 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:32:20.683 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:32:20.683 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:32:20.768 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:32:20.769 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:32:20.769 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:32:20.851 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:32:20.852 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:32:20.853 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 11:34:00' 
2022-03-09 12:32:20.853 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:32:20.950 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 12:32:20.950 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-218.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:32:20.951 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:32:20.951 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-218.5660032258064516
2022-03-09 12:32:20.960 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:32:20.960 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:32:21.048 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:32:21.049 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:32:21.049 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:32:21.132 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:32:21.134 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:32:21.135 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:32:21.224 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:32:21.226 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:32:21.226 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:32:21.378 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:32:21.437 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:32:21.437 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:32:21.519 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:32:21.519 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 12:32:21.520 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:32:21.521 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:32:21.603 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:32:21.604 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 12:32:21.604 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:32:21.605 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:32:21.606 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:32:21.607 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:32:21.689 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:32:21.690 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 12:32:21.690 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:32:21.691 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:32:21.692 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:32:21.775 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:32:21.776 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 12:32:21.777 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:32:21.777 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:32:21.777 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:32:21.859 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:32:21.860 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:32:21.860 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:32:21.941 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:32:21.943 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:32:21.944 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:32:22.028 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:32:22.029 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 12:32:22.030 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:32:22.031 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:32:22.111 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:32:22.112 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:32:22.112 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:32:22.194 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:32:22.194 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:32:22.195 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:32:22.276 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:32:22.277 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:32:22.277 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:32:22.359 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:32:22.360 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:32:22.361 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:32:22.442 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:32:22.443 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 12:32:22.443 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:32:22.444 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:32:22.525 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:32:22.525 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 12:32:22.526 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:32:22.527 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:32:22.609 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:32:22.610 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 12:32:22.610 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:32:22.611 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:32:22.692 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:32:22.692 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 12:32:22.692 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:40:27.976 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 11:34:00' and user_id = ? and type not in (16,27) 
2022-03-09 12:40:27.978 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:40:28.059 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:40:28.060 [http-nio-10090-exec-4] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:40:28.061 [http-nio-10090-exec-4] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:40:28.142 [http-nio-10090-exec-4] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:40:28.142 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:40:28.143 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:1.0000000000000000,操作后，计算剩余的金额:637.5348494800000000,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:40:28.143 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:40:28.143 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:40:28.224 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:40:28.225 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:40:28.225 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:40:28.305 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:40:28.306 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:40:28.306 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:40:28.386 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:40:28.387 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:40:28.387 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:40:28.472 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:40:28.473 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:40:28.473 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:40:28.554 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:40:28.555 [http-nio-10090-exec-4] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:40:28.556 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 11:34:00' 
2022-03-09 12:40:28.556 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:40:28.645 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 12:40:28.646 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-217.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:40:28.646 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:40:28.647 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-217.5660032258064516
2022-03-09 12:40:28.647 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:40:28.647 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:40:28.730 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:40:28.731 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:40:28.731 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:40:28.812 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:40:28.813 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 盈亏计算不正确--->,用户:51905047,订单:4667,类型:4
2022-03-09 12:40:28.814 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:40:28.814 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:40:28.895 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:40:28.895 [http-nio-10090-exec-4] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:40:28.896 [http-nio-10090-exec-4] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:40:28.978 [http-nio-10090-exec-4] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:40:28.979 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:40:28.980 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:40:29.063 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:40:29.064 [http-nio-10090-exec-4] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 12:40:29.064 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:40:29.065 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:40:29.147 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:40:29.147 [http-nio-10090-exec-4] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 12:40:29.148 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:40:29.148 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:40:29.148 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:40:29.149 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:40:29.232 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:40:29.233 [http-nio-10090-exec-4] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 12:40:29.233 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:40:29.234 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:40:29.235 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:40:29.318 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:40:29.319 [http-nio-10090-exec-4] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 12:40:29.319 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:40:29.320 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:40:29.321 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:40:29.404 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:40:29.405 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:40:29.405 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:40:29.496 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:40:29.498 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:40:29.499 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:40:29.581 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:40:29.582 [http-nio-10090-exec-4] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 12:40:29.583 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:40:29.584 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:40:29.665 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:40:29.678 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:40:29.678 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:40:29.761 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:40:29.762 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:40:29.763 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:40:29.844 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:40:29.845 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:40:29.846 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:40:29.929 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:40:29.931 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:40:29.932 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:40:30.015 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:40:30.016 [http-nio-10090-exec-4] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 12:40:30.017 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:40:30.018 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:40:30.099 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:40:30.099 [http-nio-10090-exec-4] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 12:40:30.100 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:40:30.101 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:40:30.183 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:40:30.184 [http-nio-10090-exec-4] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 12:40:30.185 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:40:30.185 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:40:30.269 [http-nio-10090-exec-4] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:40:30.269 [http-nio-10090-exec-4] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 12:40:30.270 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:43:58.061 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2022-03-09 12:43:58.077 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2022-03-09 12:44:18.198 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5005 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 12:44:23.210 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 71346 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 12:44:23.211 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 12:44:24.037 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:44:24.039 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:44:24.059 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 14 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 12:44:24.063 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:44:24.064 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:44:24.072 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 12:44:24.082 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:44:24.084 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 12:44:24.098 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2022-03-09 12:44:24.737 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 12:44:24.747 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 12:44:24.748 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 12:44:24.748 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 12:44:24.871 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 12:44:24.871 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1607 ms
2022-03-09 12:44:25.959 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 12:44:26.692 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 12:44:26.694 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 12:44:26.694 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 12:44:26.924 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 12:44:26.941 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 12:44:26.953 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 24.321 seconds (JVM running for 24.803)
2022-03-09 12:44:36.938 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 12:44:36.939 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 12:44:36.942 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2022-03-09 12:44:37.361 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 12:44:39.581 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 12:44:39.591 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 11:34:00' and user_id = ? and type not in (16,27) 
2022-03-09 12:44:39.621 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:44:39.742 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:44:39.747 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:44:39.747 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:44:39.845 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:44:39.845 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:44:39.859 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:1.0000000000000000,操作后，计算剩余的金额:637.5348494800000000,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:44:39.859 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:44:39.860 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:44:39.951 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:44:39.952 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:44:39.952 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:44:40.045 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:44:40.046 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:44:40.046 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:44:40.134 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:44:40.135 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:44:40.135 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:44:40.223 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:44:40.224 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:44:40.225 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:44:40.315 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:44:40.316 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:44:40.317 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 11:34:00' 
2022-03-09 12:44:40.317 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:44:40.413 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 12:44:40.413 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-217.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:44:40.413 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:44:40.414 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-217.5660032258064516
2022-03-09 12:44:40.421 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:44:40.421 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:44:40.512 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:44:40.513 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:44:40.513 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:44:40.606 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:44:40.609 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 盈亏计算不正确--->,用户:51905047,订单:4667,类型:4
2022-03-09 12:44:40.610 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:44:40.611 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:44:40.701 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:44:40.703 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:44:40.704 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:44:40.793 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:44:40.850 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:44:40.851 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:44:40.947 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:44:40.947 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 12:44:40.948 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:44:40.949 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:44:41.047 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:44:41.047 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 12:44:41.048 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:44:41.048 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:44:41.049 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:44:41.050 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:44:41.141 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:44:41.142 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 12:44:41.143 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:44:41.144 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:44:41.145 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:44:41.237 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:44:41.240 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 12:44:41.240 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:44:41.241 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:44:41.242 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:44:41.331 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:44:41.331 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:44:41.332 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:44:41.420 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:44:41.423 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:44:41.423 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:44:41.514 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:44:41.515 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 12:44:41.516 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:44:41.516 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:44:41.609 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:44:41.611 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:44:41.612 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:44:41.700 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:44:41.701 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:44:41.702 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:44:41.789 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:44:41.790 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:44:41.791 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:44:41.879 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:44:41.880 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:44:41.880 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:44:41.970 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:44:41.971 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 12:44:41.971 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:44:41.972 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:44:42.061 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:44:42.062 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 12:44:42.063 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:44:42.063 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:44:42.153 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:44:42.153 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 12:44:42.154 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:44:42.155 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:44:42.245 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:44:42.245 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 12:44:42.245 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:45:59.893 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2022-03-09 12:45:59.904 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2022-03-09 12:46:19.371 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5006 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 12:46:24.380 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 71369 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 12:46:24.381 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 12:46:25.254 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:46:25.257 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:46:25.274 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 13 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 12:46:25.279 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:46:25.280 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 12:46:25.288 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 12:46:25.298 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 12:46:25.300 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 12:46:25.315 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2022-03-09 12:46:26.252 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 12:46:26.266 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 12:46:26.267 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 12:46:26.267 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 12:46:26.408 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 12:46:26.409 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1952 ms
2022-03-09 12:46:27.684 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 12:46:28.446 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 12:46:28.448 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 12:46:28.448 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 12:46:28.687 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 12:46:28.703 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 12:46:28.715 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 24.895 seconds (JVM running for 25.399)
2022-03-09 12:46:35.664 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 12:46:35.665 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 12:46:35.666 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2022-03-09 12:46:36.093 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 12:46:37.239 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 12:46:37.250 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 11:34:00' and user_id = ? and type not in (16,27) 
2022-03-09 12:46:37.283 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:46:37.406 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:46:37.411 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:46:37.411 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:46:37.496 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:46:37.497 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:46:37.508 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:1.0000000000000000,操作后，计算剩余的金额:637.5348494800000000,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:46:37.508 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:46:37.509 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:46:37.600 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:46:37.601 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:46:37.601 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:46:37.692 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:46:37.693 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:46:37.693 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:46:37.788 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:46:37.789 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:46:37.790 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:46:37.877 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:46:37.877 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:46:37.878 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:46:37.964 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:46:37.964 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:46:37.965 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 11:34:00' 
2022-03-09 12:46:37.966 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:46:38.061 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 12:46:38.061 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-217.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:46:38.062 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:46:38.062 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-217.5660032258064516
2022-03-09 12:46:38.070 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:46:38.070 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:46:38.160 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:46:38.161 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:46:38.161 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:46:38.251 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:46:38.253 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 盈亏计算不正确--->,用户:51905047,订单:4667,类型:4
2022-03-09 12:46:38.255 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:46:38.256 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:46:38.345 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:46:38.347 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:46:38.347 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:46:38.443 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:46:38.502 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:38.503 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:46:38.596 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:38.596 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 12:46:38.597 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:38.597 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:46:38.685 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:38.686 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 12:46:38.686 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:46:38.687 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:46:38.688 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:38.689 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:46:38.778 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:38.778 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 12:46:38.779 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:46:38.779 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:38.780 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:46:38.868 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:38.869 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 12:46:38.869 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:46:38.870 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:46:38.870 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:46:38.959 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:46:38.959 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:46:38.960 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:46:39.047 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:46:39.049 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:39.050 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:46:39.141 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:39.141 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 12:46:39.142 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:46:39.143 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:46:39.228 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:46:39.229 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:46:39.230 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:46:39.316 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:46:39.317 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:46:39.317 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:46:39.402 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:46:39.403 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:46:39.403 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:46:39.489 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:46:39.491 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:39.491 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:46:39.578 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:39.578 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 12:46:39.579 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:39.579 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:46:39.671 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:39.672 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 12:46:39.673 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:39.673 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:46:39.763 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:39.763 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 12:46:39.764 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:39.765 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:46:39.855 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:39.856 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 12:46:39.856 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:46:53.243 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 11:34:00' and user_id = ? and type not in (16,27) 
2022-03-09 12:46:53.245 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:46:53.333 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:46:53.334 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:46:53.335 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:46:53.422 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:46:53.423 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:46:53.423 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:0E-16,操作后，计算剩余的金额:636.5348494800000000,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:46:53.424 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:46:53.425 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:46:53.511 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:46:53.512 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:46:53.513 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:46:53.600 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:46:53.601 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:46:53.602 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:46:53.691 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:46:53.692 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:46:53.693 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:46:53.788 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:46:53.789 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:46:53.789 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:46:53.882 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:46:53.882 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:46:53.883 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 11:34:00' 
2022-03-09 12:46:53.883 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:46:53.978 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 12:46:53.978 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-218.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:46:53.978 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:46:53.978 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-218.5660032258064516
2022-03-09 12:46:53.979 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:46:53.979 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:46:54.070 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:46:54.072 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:46:54.072 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:46:54.157 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:46:54.158 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:46:54.158 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:46:54.245 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:46:54.246 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:46:54.247 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:46:54.333 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:46:54.334 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:54.335 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:46:54.423 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:54.425 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 12:46:54.426 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:54.427 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:46:54.513 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:54.514 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 12:46:54.515 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:46:54.515 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:46:54.516 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:54.516 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:46:54.604 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:54.615 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 12:46:54.616 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:46:54.616 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:54.617 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:46:54.703 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:54.703 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 12:46:54.704 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:46:54.704 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:46:54.704 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:46:54.793 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:46:54.794 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:46:54.795 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:46:54.889 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:46:54.891 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:54.893 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:46:54.979 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:54.980 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 12:46:54.980 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:46:54.981 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:46:55.068 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:46:55.070 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:46:55.071 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:46:55.159 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:46:55.160 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:46:55.160 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:46:55.249 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:46:55.251 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:46:55.251 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:46:55.340 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:46:55.342 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:55.343 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:46:55.430 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:55.431 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 12:46:55.431 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:55.432 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:46:55.519 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:55.519 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 12:46:55.520 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:55.521 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:46:55.608 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:55.609 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 12:46:55.610 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:46:55.610 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:46:55.702 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:46:55.702 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 12:46:55.703 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:54:18.160 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 11:35:00' and user_id = ? and type not in (16,27) 
2022-03-09 12:54:18.161 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:54:18.250 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:54:18.251 [http-nio-10090-exec-6] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:54:18.251 [http-nio-10090-exec-6] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:54:18.338 [http-nio-10090-exec-6] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:54:18.338 [http-nio-10090-exec-6] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:54:18.339 [http-nio-10090-exec-6] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:218.4830532258064516,操作后，计算剩余的金额:855.0179027058064516,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:54:18.340 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:54:18.340 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:54:18.428 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:54:18.428 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:54:18.428 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:54:18.515 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:54:18.516 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:54:18.517 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:54:18.602 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:54:18.603 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:54:18.604 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:54:18.691 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:54:18.691 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:54:18.692 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:54:18.778 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:54:18.778 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:54:18.779 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 11:35:00' 
2022-03-09 12:54:18.780 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:54:18.869 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 12:54:18.870 [http-nio-10090-exec-6] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-218.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:54:18.871 [http-nio-10090-exec-6] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:54:18.871 [http-nio-10090-exec-6] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-218.5660032258064516
2022-03-09 12:54:18.871 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:54:18.872 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:54:18.958 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:54:18.959 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:54:18.959 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:54:19.054 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:54:19.056 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:54:19.056 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:54:19.141 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:54:19.141 [http-nio-10090-exec-6] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:54:19.141 [http-nio-10090-exec-6] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:54:19.227 [http-nio-10090-exec-6] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:54:19.228 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:54:19.228 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:54:19.315 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:54:19.316 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 12:54:19.318 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:54:19.318 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:54:19.406 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:54:19.406 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 12:54:19.407 [http-nio-10090-exec-6] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:54:19.407 [http-nio-10090-exec-6] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:54:19.407 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:54:19.408 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:54:19.495 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:54:19.496 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 12:54:19.496 [http-nio-10090-exec-6] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:54:19.497 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:54:19.498 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:54:19.584 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:54:19.584 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 12:54:19.585 [http-nio-10090-exec-6] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:54:19.586 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:54:19.586 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:54:19.674 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:54:19.675 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:54:19.675 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:54:19.761 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:54:19.763 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:54:19.763 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:54:19.852 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:54:19.853 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 12:54:19.854 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:54:19.854 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:54:19.940 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:54:19.941 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:54:19.941 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:54:20.040 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:54:20.041 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:54:20.041 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:54:20.132 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:54:20.133 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:54:20.134 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:54:20.224 [http-nio-10090-exec-6] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:54:20.226 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:54:20.226 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:54:20.313 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:54:20.314 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 12:54:20.315 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:54:20.316 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:54:20.403 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:54:20.404 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 12:54:20.405 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:54:20.406 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:54:20.493 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:54:20.493 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 12:54:20.494 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:54:20.494 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:54:20.582 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:54:20.583 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 12:54:20.583 [http-nio-10090-exec-6] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:59:01.862 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 12:59:01.864 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:59:01.949 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:59:01.949 [http-nio-10090-exec-9] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:01.950 [http-nio-10090-exec-9] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:02.036 [http-nio-10090-exec-9] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:02.037 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:59:02.038 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:-800.9225376172704714,操作后，计算剩余的金额:-164.3876881372704714,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:59:02.039 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:02.039 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:59:02.131 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:59:02.131 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:02.131 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:59:02.228 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:59:02.229 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:02.230 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:59:02.316 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:59:02.317 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:02.318 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:59:02.405 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:59:02.406 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:59:02.406 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:59:02.494 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:59:02.495 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:59:02.496 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='' 
2022-03-09 12:59:02.496 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:59:02.594 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 31
2022-03-09 12:59:02.595 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=3, size=-15.3237600000000000, preBalance=1000.0000000000000000, postBalance=984.6762400000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467开仓保证金-15.3237600000000000, createdDate=2022-03-08 13:36:36, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0153230000000000, preBalance=984.6762400000000000, postBalance=984.6915630000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467返还手续费0.0153230000000000, createdDate=2022-03-08 13:36:36, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.1532376000000000, preBalance=984.6915630000000000, postBalance=984.5383254000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467开仓手续费-0.1532376000000000, createdDate=2022-03-08 13:36:36, fromUserId=0, total=null), UserBillChain(userId=51905047, type=3, size=-39.0798720000000000, preBalance=984.5383254000000000, postBalance=945.4584534000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468开仓保证金-39.0798720000000000, createdDate=2022-03-08 13:36:44, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0781590000000000, preBalance=945.4584534000000000, postBalance=945.5366124000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468返还手续费0.0781590000000000, createdDate=2022-03-08 13:36:44, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.7815974400000000, preBalance=945.5366124000000000, postBalance=944.7550149600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468开仓手续费-0.7815974400000000, createdDate=2022-03-08 13:36:46, fromUserId=0, total=null), UserBillChain(userId=51905047, type=3, size=-31.5054967741935483, preBalance=944.7550149600000000, postBalance=913.2495181858064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469开仓保证金-31.5054967741935483, createdDate=2022-03-08 13:36:58, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0781330000000000, preBalance=913.2495181858064517, postBalance=913.3276511858064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469返还手续费0.0781330000000000, createdDate=2022-03-08 13:36:58, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.7813363200000000, preBalance=913.3276511858064517, postBalance=912.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469开仓手续费-0.7813363200000000, createdDate=2022-03-08 13:37:06, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=912.5463148658064517, postBalance=812.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469增加保证金-100.0000000000000000, createdDate=2022-03-08 13:37:08, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=812.5463148658064517, postBalance=712.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468增加保证金-100.0000000000000000, createdDate=2022-03-08 13:37:15, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=712.5463148658064517, postBalance=612.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467增加保证金-100.0000000000000000, createdDate=2022-03-08 13:37:22, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-200.0000000000000000, preBalance=612.5463148658064517, postBalance=412.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469增加保证金-200.0000000000000000, createdDate=2022-03-08 13:38:57, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=412.5463148658064517, postBalance=312.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469增加保证金-100.0000000000000000, createdDate=2022-03-08 13:39:32, fromUserId=0, total=null), UserBillChain(userId=51905047, type=3, size=-12.3885784615384615, preBalance=312.5463148658064517, postBalance=300.1577364042679902, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4470, note=单号:4470开仓保证金-12.3885784615384615, createdDate=2022-03-08 13:44:11, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0322100000000000, preBalance=300.1577364042679902, postBalance=300.1899464042679902, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4470, note=单号:4470返还手续费0.0322100000000000, createdDate=2022-03-08 13:44:11, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.3221030400000000, preBalance=300.1899464042679902, postBalance=299.8678433642679902, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4470, note=单号:4470开仓手续费-0.3221030400000000, createdDate=2022-03-08 13:44:15, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=2.8896615384615384, preBalance=299.8678433642679902, postBalance=302.6885037027295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4471, note=单号:4471平仓收益2.8206603384615384, createdDate=2022-03-08 13:44:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0076660000000000, preBalance=302.6885037027295286, postBalance=302.6885037027295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4471, note=单号:4471返还手续费0.0076660000000000, createdDate=2022-03-08 13:44:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.0766672000000000, preBalance=302.6885037027295286, postBalance=302.6885037027295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4471, note=单号:4471平仓手续费-0.0766672000000000, createdDate=2022-03-08 13:45:05, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-4.9904000000000000, preBalance=302.6885037027295286, postBalance=297.4790290227295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4521, note=单号:4521平仓收益-5.2094746800000000, createdDate=2022-03-08 14:33:48, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0243410000000000, preBalance=297.4790290227295286, postBalance=297.4790290227295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4521, note=单号:4521返还手续费0.0243410000000000, createdDate=2022-03-08 14:33:48, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.2434156800000000, preBalance=297.4790290227295286, postBalance=297.4790290227295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4521, note=单号:4521平仓手续费-0.2434156800000000, createdDate=2022-03-08 14:33:57, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-97.6905000000000000, preBalance=297.4790290227295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4552, note=单号:4552平仓收益-98.4015666400000000, createdDate=2022-03-08 16:17:35, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0790070000000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4552, note=单号:4552返还手续费0.0790070000000000, createdDate=2022-03-08 16:17:35, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.7900736400000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4552, note=单号:4552平仓手续费-0.7900736400000000, createdDate=2022-03-08 16:17:39, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-218.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:59:02.596 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:59:02.596 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-15.3237600000000000
2022-03-09 12:59:02.597 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0153230000000000
2022-03-09 12:59:02.597 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.1532376000000000
2022-03-09 12:59:02.598 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4467' LIMIT 0,1000 
2022-03-09 12:59:02.598 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:02.684 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 12:59:02.685 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:02.685 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:02.771 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:02.772 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4467' and type=? limit 0,1 
2022-03-09 12:59:02.772 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:02.866 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:02.866 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4467,数据库:0.015323,计算:0.015323
2022-03-09 12:59:02.867 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:02.868 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:02.956 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:02.957 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:02.957 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:03.043 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:03.044 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:03.045 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:03.131 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:03.132 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:03.133 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:03.221 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:03.223 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4467' and type=? limit 0,1 
2022-03-09 12:59:03.224 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:03.312 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:03.312 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4467,比列:0.300000,数据库:0.04137438,计算:0.041373
2022-03-09 12:59:03.313 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4467' and type=? limit 0,1 
2022-03-09 12:59:03.314 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:03.401 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:03.402 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-39.0798720000000000
2022-03-09 12:59:03.402 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0781590000000000
2022-03-09 12:59:03.402 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.7815974400000000
2022-03-09 12:59:03.402 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4468' LIMIT 0,1000 
2022-03-09 12:59:03.403 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:03.490 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 12:59:03.492 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:03.492 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:03.581 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:03.583 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4468' and type=? limit 0,1 
2022-03-09 12:59:03.583 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:03.673 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:03.674 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4468,数据库:0.078159,计算:0.078159
2022-03-09 12:59:03.675 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:03.675 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:03.761 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:03.762 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:03.762 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:03.852 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:03.853 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:03.853 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:03.939 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:03.940 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:03.941 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:04.028 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:04.030 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4468' and type=? limit 0,1 
2022-03-09 12:59:04.031 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:04.119 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:04.120 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4468,比列:0.300000,数据库:0.21103153,计算:0.211031
2022-03-09 12:59:04.120 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4468' and type=? limit 0,1 
2022-03-09 12:59:04.121 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:04.209 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:04.210 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-31.5054967741935483
2022-03-09 12:59:04.210 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0781330000000000
2022-03-09 12:59:04.210 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.7813363200000000
2022-03-09 12:59:04.211 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4469' LIMIT 0,1000 
2022-03-09 12:59:04.212 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:04.303 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 4
2022-03-09 12:59:04.304 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:04.304 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:04.394 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:04.395 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4469' and type=? limit 0,1 
2022-03-09 12:59:04.396 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:04.483 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:04.484 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4469,数据库:0.078133,计算:0.078133
2022-03-09 12:59:04.485 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:04.485 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:04.577 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:04.578 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:04.578 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:04.676 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:04.676 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:04.676 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:04.768 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:04.768 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:04.769 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:04.854 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:04.855 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4469' and type=? limit 0,1 
2022-03-09 12:59:04.855 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:04.947 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:04.948 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4469,比列:0.300000,数据库:0.21096099,计算:0.210960
2022-03-09 12:59:04.949 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4469' and type=? limit 0,1 
2022-03-09 12:59:04.950 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:05.037 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:05.037 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 12:59:05.037 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 12:59:05.037 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 12:59:05.037 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-200.0000000000000000
2022-03-09 12:59:05.037 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 12:59:05.038 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-12.3885784615384615
2022-03-09 12:59:05.038 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0322100000000000
2022-03-09 12:59:05.038 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.3221030400000000
2022-03-09 12:59:05.038 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4470' LIMIT 0,1000 
2022-03-09 12:59:05.039 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:05.126 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:05.127 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:05.127 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:05.216 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:05.218 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4470' and type=? limit 0,1 
2022-03-09 12:59:05.219 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:05.307 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:05.307 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4470,数据库:0.032210,计算:0.032210
2022-03-09 12:59:05.308 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:05.309 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:05.398 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:05.399 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:05.399 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:05.490 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:05.491 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:05.491 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:05.577 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:05.577 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:05.578 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:05.665 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:05.666 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4470' and type=? limit 0,1 
2022-03-09 12:59:05.666 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:05.754 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:05.754 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4470,比列:0.300000,数据库:0.08696791,计算:0.086967
2022-03-09 12:59:05.755 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4470' and type=? limit 0,1 
2022-03-09 12:59:05.756 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:05.844 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:05.845 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:2.8896615384615384
2022-03-09 12:59:05.846 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4471' LIMIT 0,1000 
2022-03-09 12:59:05.846 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:05.941 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:05.942 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:05.942 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:06.028 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:06.029 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4471' 
2022-03-09 12:59:06.030 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:59:06.116 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:59:06.117 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4471' AND `margin_type` = 'FIXED' 
2022-03-09 12:59:06.118 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:59:06.209 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:59:06.210 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 12:59:06.211 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:59:06.306 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:06.307 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0076660000000000
2022-03-09 12:59:06.307 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.0766672000000000
2022-03-09 12:59:06.308 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4471' LIMIT 0,1000 
2022-03-09 12:59:06.308 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:06.400 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:06.401 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:06.401 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:06.498 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:06.500 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 12:59:06.501 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:06.594 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:06.594 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4471,数据库:0.007666,计算:0.007666
2022-03-09 12:59:06.595 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:06.596 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:06.686 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:06.687 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:06.687 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:06.779 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:06.780 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:06.781 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:06.867 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:06.868 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:06.868 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:06.955 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:06.956 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 12:59:06.957 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:07.044 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:07.045 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4471,比列:0.300000,数据库:0.02070036,计算:0.020700
2022-03-09 12:59:07.046 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 12:59:07.046 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:07.135 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:07.135 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-4.9904000000000000
2022-03-09 12:59:07.136 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4521' LIMIT 0,1000 
2022-03-09 12:59:07.136 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:07.224 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:07.225 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:07.225 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:07.311 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:07.311 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 盈亏计算不正确--->,用户:51905047,订单:4521,类型:4
2022-03-09 12:59:07.312 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4521' 
2022-03-09 12:59:07.312 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:59:07.398 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:59:07.399 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4521' AND `margin_type` = 'FIXED' 
2022-03-09 12:59:07.400 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:59:07.486 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:59:07.487 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 12:59:07.488 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:59:07.574 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:07.575 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0243410000000000
2022-03-09 12:59:07.575 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.2434156800000000
2022-03-09 12:59:07.576 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4521' LIMIT 0,1000 
2022-03-09 12:59:07.576 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:07.668 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:07.668 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:07.668 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:07.754 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:07.755 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 12:59:07.755 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:07.846 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:07.847 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4521,数据库:0.024341,计算:0.024341
2022-03-09 12:59:07.847 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:07.848 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:07.934 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:07.935 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:07.935 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:08.021 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:08.021 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:08.022 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:08.108 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:08.108 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:08.109 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:08.195 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:08.196 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 12:59:08.196 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:08.288 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:08.289 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4521,比列:0.300000,数据库:0.06572240,计算:0.065722
2022-03-09 12:59:08.289 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 12:59:08.289 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:08.376 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:08.377 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-97.6905000000000000
2022-03-09 12:59:08.377 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4552' LIMIT 0,1000 
2022-03-09 12:59:08.377 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:08.465 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:08.466 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:08.466 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:08.553 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:08.554 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 盈亏计算不正确--->,用户:51905047,订单:4552,类型:4
2022-03-09 12:59:08.555 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4552' 
2022-03-09 12:59:08.555 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:59:08.642 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:59:08.642 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4552' AND `margin_type` = 'FIXED' 
2022-03-09 12:59:08.643 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:59:08.729 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:59:08.730 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 12:59:08.731 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:59:08.818 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:08.819 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0790070000000000
2022-03-09 12:59:08.819 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.7900736400000000
2022-03-09 12:59:08.820 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4552' LIMIT 0,1000 
2022-03-09 12:59:08.820 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:08.909 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:08.909 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:08.909 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:09.008 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:09.009 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 12:59:09.010 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:09.100 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:09.101 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4552,数据库:0.079007,计算:0.079007
2022-03-09 12:59:09.102 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:09.102 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:09.192 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:09.192 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:09.193 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:09.291 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:09.291 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:09.292 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:09.378 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:09.378 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:09.378 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:09.466 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:09.466 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 12:59:09.466 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:09.552 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:09.553 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4552,比列:0.300000,数据库:0.21331999,计算:0.213319
2022-03-09 12:59:09.553 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 12:59:09.553 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:09.642 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:09.642 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-218.5660032258064516
2022-03-09 12:59:09.643 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:59:09.643 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:09.728 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:09.728 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:09.729 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:09.814 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:09.815 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:59:09.815 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:59:09.901 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:59:09.901 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:59:09.901 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:59:09.987 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:59:09.987 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:09.987 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:59:10.083 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:10.083 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 12:59:10.083 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:10.083 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:59:10.173 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:10.173 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 12:59:10.173 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:59:10.173 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:59:10.173 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:10.174 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:59:10.270 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:10.271 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 12:59:10.271 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:59:10.271 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:10.271 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:59:10.362 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:10.362 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 12:59:10.362 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:59:10.362 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:59:10.363 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:10.451 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:10.452 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:10.452 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:10.542 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:10.542 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:10.542 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:10.628 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:10.629 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 12:59:10.629 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:10.629 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:10.714 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:10.715 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:10.715 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:10.800 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:10.801 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:10.801 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:10.889 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:10.890 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:10.890 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:10.976 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:10.976 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:10.977 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:11.062 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:11.063 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 12:59:11.064 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:11.064 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:11.150 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:11.150 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 12:59:11.151 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:11.151 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:59:11.237 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:11.237 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 12:59:11.238 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:11.238 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:59:11.324 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:11.325 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 12:59:11.325 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:59:17.002 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 12:59:17.004 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 12:59:17.096 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 12:59:17.097 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:17.098 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:17.192 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:17.193 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 12:59:17.193 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:-800.9225376172704714,操作后，计算剩余的金额:-164.3876881372704714,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 12:59:17.193 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:17.193 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:59:17.287 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:59:17.288 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:17.289 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:59:17.383 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:59:17.384 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:17.384 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:59:17.478 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:59:17.478 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:17.478 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:59:17.573 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:59:17.574 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 12:59:17.575 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 12:59:17.669 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 12:59:17.670 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 12:59:17.670 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='' 
2022-03-09 12:59:17.671 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 12:59:17.763 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 31
2022-03-09 12:59:17.763 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=3, size=-15.3237600000000000, preBalance=1000.0000000000000000, postBalance=984.6762400000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467开仓保证金-15.3237600000000000, createdDate=2022-03-08 13:36:36, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0153230000000000, preBalance=984.6762400000000000, postBalance=984.6915630000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467返还手续费0.0153230000000000, createdDate=2022-03-08 13:36:36, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.1532376000000000, preBalance=984.6915630000000000, postBalance=984.5383254000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467开仓手续费-0.1532376000000000, createdDate=2022-03-08 13:36:36, fromUserId=0, total=null), UserBillChain(userId=51905047, type=3, size=-39.0798720000000000, preBalance=984.5383254000000000, postBalance=945.4584534000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468开仓保证金-39.0798720000000000, createdDate=2022-03-08 13:36:44, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0781590000000000, preBalance=945.4584534000000000, postBalance=945.5366124000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468返还手续费0.0781590000000000, createdDate=2022-03-08 13:36:44, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.7815974400000000, preBalance=945.5366124000000000, postBalance=944.7550149600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468开仓手续费-0.7815974400000000, createdDate=2022-03-08 13:36:46, fromUserId=0, total=null), UserBillChain(userId=51905047, type=3, size=-31.5054967741935483, preBalance=944.7550149600000000, postBalance=913.2495181858064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469开仓保证金-31.5054967741935483, createdDate=2022-03-08 13:36:58, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0781330000000000, preBalance=913.2495181858064517, postBalance=913.3276511858064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469返还手续费0.0781330000000000, createdDate=2022-03-08 13:36:58, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.7813363200000000, preBalance=913.3276511858064517, postBalance=912.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469开仓手续费-0.7813363200000000, createdDate=2022-03-08 13:37:06, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=912.5463148658064517, postBalance=812.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469增加保证金-100.0000000000000000, createdDate=2022-03-08 13:37:08, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=812.5463148658064517, postBalance=712.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468增加保证金-100.0000000000000000, createdDate=2022-03-08 13:37:15, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=712.5463148658064517, postBalance=612.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467增加保证金-100.0000000000000000, createdDate=2022-03-08 13:37:22, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-200.0000000000000000, preBalance=612.5463148658064517, postBalance=412.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469增加保证金-200.0000000000000000, createdDate=2022-03-08 13:38:57, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=412.5463148658064517, postBalance=312.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469增加保证金-100.0000000000000000, createdDate=2022-03-08 13:39:32, fromUserId=0, total=null), UserBillChain(userId=51905047, type=3, size=-12.3885784615384615, preBalance=312.5463148658064517, postBalance=300.1577364042679902, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4470, note=单号:4470开仓保证金-12.3885784615384615, createdDate=2022-03-08 13:44:11, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0322100000000000, preBalance=300.1577364042679902, postBalance=300.1899464042679902, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4470, note=单号:4470返还手续费0.0322100000000000, createdDate=2022-03-08 13:44:11, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.3221030400000000, preBalance=300.1899464042679902, postBalance=299.8678433642679902, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4470, note=单号:4470开仓手续费-0.3221030400000000, createdDate=2022-03-08 13:44:15, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=2.8896615384615384, preBalance=299.8678433642679902, postBalance=302.6885037027295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4471, note=单号:4471平仓收益2.8206603384615384, createdDate=2022-03-08 13:44:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0076660000000000, preBalance=302.6885037027295286, postBalance=302.6885037027295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4471, note=单号:4471返还手续费0.0076660000000000, createdDate=2022-03-08 13:44:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.0766672000000000, preBalance=302.6885037027295286, postBalance=302.6885037027295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4471, note=单号:4471平仓手续费-0.0766672000000000, createdDate=2022-03-08 13:45:05, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-4.9904000000000000, preBalance=302.6885037027295286, postBalance=297.4790290227295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4521, note=单号:4521平仓收益-5.2094746800000000, createdDate=2022-03-08 14:33:48, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0243410000000000, preBalance=297.4790290227295286, postBalance=297.4790290227295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4521, note=单号:4521返还手续费0.0243410000000000, createdDate=2022-03-08 14:33:48, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.2434156800000000, preBalance=297.4790290227295286, postBalance=297.4790290227295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4521, note=单号:4521平仓手续费-0.2434156800000000, createdDate=2022-03-08 14:33:57, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-97.6905000000000000, preBalance=297.4790290227295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4552, note=单号:4552平仓收益-98.4015666400000000, createdDate=2022-03-08 16:17:35, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0790070000000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4552, note=单号:4552返还手续费0.0790070000000000, createdDate=2022-03-08 16:17:35, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.7900736400000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4552, note=单号:4552平仓手续费-0.7900736400000000, createdDate=2022-03-08 16:17:39, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-218.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 12:59:17.765 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 12:59:17.765 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-15.3237600000000000
2022-03-09 12:59:17.765 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0153230000000000
2022-03-09 12:59:17.765 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.1532376000000000
2022-03-09 12:59:17.765 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4467' LIMIT 0,1000 
2022-03-09 12:59:17.765 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:17.851 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 12:59:17.852 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:17.852 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:17.937 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:17.938 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4467' and type=? limit 0,1 
2022-03-09 12:59:17.938 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:18.026 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:18.026 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4467,数据库:0.015323,计算:0.015323
2022-03-09 12:59:18.027 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:18.027 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:18.112 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:18.112 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:18.112 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:18.201 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:18.201 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:18.202 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:18.287 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:18.287 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:18.287 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:18.372 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:18.373 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4467' and type=? limit 0,1 
2022-03-09 12:59:18.373 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:18.461 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:18.462 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4467,比列:0.300000,数据库:0.04137438,计算:0.041373
2022-03-09 12:59:18.462 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4467' and type=? limit 0,1 
2022-03-09 12:59:18.463 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:18.551 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:18.551 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-39.0798720000000000
2022-03-09 12:59:18.551 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0781590000000000
2022-03-09 12:59:18.551 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.7815974400000000
2022-03-09 12:59:18.551 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4468' LIMIT 0,1000 
2022-03-09 12:59:18.551 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:18.639 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 12:59:18.640 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:18.640 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:18.727 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:18.727 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4468' and type=? limit 0,1 
2022-03-09 12:59:18.728 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:18.815 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:18.816 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4468,数据库:0.078159,计算:0.078159
2022-03-09 12:59:18.817 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:18.817 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:18.903 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:18.903 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:18.904 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:18.989 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:18.990 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:18.990 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:19.076 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:19.076 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:19.077 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:19.166 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:19.167 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4468' and type=? limit 0,1 
2022-03-09 12:59:19.168 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:19.262 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:19.262 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4468,比列:0.300000,数据库:0.21103153,计算:0.211031
2022-03-09 12:59:19.263 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4468' and type=? limit 0,1 
2022-03-09 12:59:19.263 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:19.349 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:19.349 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-31.5054967741935483
2022-03-09 12:59:19.350 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0781330000000000
2022-03-09 12:59:19.350 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.7813363200000000
2022-03-09 12:59:19.351 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4469' LIMIT 0,1000 
2022-03-09 12:59:19.351 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:19.440 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 4
2022-03-09 12:59:19.440 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:19.440 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:19.527 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:19.528 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4469' and type=? limit 0,1 
2022-03-09 12:59:19.528 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:19.615 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:19.615 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4469,数据库:0.078133,计算:0.078133
2022-03-09 12:59:19.616 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:19.617 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:19.702 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:19.703 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:19.704 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:19.789 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:19.789 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:19.790 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:19.876 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:19.877 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:19.877 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:19.963 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:19.963 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4469' and type=? limit 0,1 
2022-03-09 12:59:19.964 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:20.051 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:20.051 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4469,比列:0.300000,数据库:0.21096099,计算:0.210960
2022-03-09 12:59:20.052 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4469' and type=? limit 0,1 
2022-03-09 12:59:20.052 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:20.142 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:20.143 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 12:59:20.143 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 12:59:20.143 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 12:59:20.143 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-200.0000000000000000
2022-03-09 12:59:20.143 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 12:59:20.143 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-12.3885784615384615
2022-03-09 12:59:20.143 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0322100000000000
2022-03-09 12:59:20.143 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.3221030400000000
2022-03-09 12:59:20.144 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4470' LIMIT 0,1000 
2022-03-09 12:59:20.144 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:20.231 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:20.232 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:20.233 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:20.325 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:20.326 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4470' and type=? limit 0,1 
2022-03-09 12:59:20.327 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:20.414 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:20.414 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4470,数据库:0.032210,计算:0.032210
2022-03-09 12:59:20.415 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:20.415 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:20.501 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:20.502 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:20.502 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:20.588 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:20.589 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:20.589 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:20.683 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:20.683 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:20.684 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:20.774 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:20.774 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4470' and type=? limit 0,1 
2022-03-09 12:59:20.775 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:20.863 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:20.864 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4470,比列:0.300000,数据库:0.08696791,计算:0.086967
2022-03-09 12:59:20.864 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4470' and type=? limit 0,1 
2022-03-09 12:59:20.865 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:20.952 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:20.953 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:2.8896615384615384
2022-03-09 12:59:20.953 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4471' LIMIT 0,1000 
2022-03-09 12:59:20.954 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:21.042 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:21.043 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:21.043 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:21.132 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:21.133 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4471' 
2022-03-09 12:59:21.134 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:59:21.219 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:59:21.219 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4471' AND `margin_type` = 'FIXED' 
2022-03-09 12:59:21.219 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:59:21.305 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:59:21.305 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 12:59:21.306 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:59:21.393 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:21.393 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0076660000000000
2022-03-09 12:59:21.393 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.0766672000000000
2022-03-09 12:59:21.394 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4471' LIMIT 0,1000 
2022-03-09 12:59:21.394 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:21.481 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:21.482 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:21.482 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:21.569 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:21.570 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 12:59:21.570 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:21.668 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:21.668 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4471,数据库:0.007666,计算:0.007666
2022-03-09 12:59:21.669 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:21.669 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:21.756 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:21.757 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:21.757 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:21.843 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:21.844 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:21.844 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:21.933 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:21.935 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:21.935 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:22.021 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:22.022 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 12:59:22.023 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:22.113 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:22.113 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4471,比列:0.300000,数据库:0.02070036,计算:0.020700
2022-03-09 12:59:22.114 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 12:59:22.114 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:22.200 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:22.201 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-4.9904000000000000
2022-03-09 12:59:22.201 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4521' LIMIT 0,1000 
2022-03-09 12:59:22.201 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:22.294 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:22.295 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:22.295 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:22.383 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:22.383 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 盈亏计算不正确--->,用户:51905047,订单:4521,类型:4
2022-03-09 12:59:22.384 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4521' 
2022-03-09 12:59:22.384 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:59:22.470 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:59:22.471 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4521' AND `margin_type` = 'FIXED' 
2022-03-09 12:59:22.471 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:59:22.560 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:59:22.562 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 12:59:22.562 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:59:22.648 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:22.649 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0243410000000000
2022-03-09 12:59:22.649 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.2434156800000000
2022-03-09 12:59:22.650 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4521' LIMIT 0,1000 
2022-03-09 12:59:22.650 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:22.738 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:22.739 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:22.739 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:22.829 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:22.829 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 12:59:22.830 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:22.921 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:22.922 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4521,数据库:0.024341,计算:0.024341
2022-03-09 12:59:22.922 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:22.922 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:23.012 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:23.013 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:23.013 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:23.101 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:23.101 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:23.102 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:23.193 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:23.194 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:23.194 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:23.281 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:23.282 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 12:59:23.283 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:23.370 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:23.370 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4521,比列:0.300000,数据库:0.06572240,计算:0.065722
2022-03-09 12:59:23.371 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 12:59:23.371 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:23.458 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:23.458 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-97.6905000000000000
2022-03-09 12:59:23.459 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4552' LIMIT 0,1000 
2022-03-09 12:59:23.459 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:23.546 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:23.546 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:23.547 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:23.632 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:23.633 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 盈亏计算不正确--->,用户:51905047,订单:4552,类型:4
2022-03-09 12:59:23.634 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4552' 
2022-03-09 12:59:23.634 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:59:23.721 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:59:23.721 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4552' AND `margin_type` = 'FIXED' 
2022-03-09 12:59:23.721 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:59:23.810 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:59:23.811 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 12:59:23.811 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:59:23.897 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:23.897 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0790070000000000
2022-03-09 12:59:23.897 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.7900736400000000
2022-03-09 12:59:23.897 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4552' LIMIT 0,1000 
2022-03-09 12:59:23.898 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:23.985 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:23.986 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:23.986 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:24.075 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:24.076 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 12:59:24.076 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:24.163 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:24.163 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4552,数据库:0.079007,计算:0.079007
2022-03-09 12:59:24.164 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:24.164 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:24.258 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:24.259 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:24.259 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:24.350 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:24.350 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:24.351 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:24.438 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:24.439 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:24.440 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:24.528 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:24.529 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 12:59:24.530 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:24.622 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:24.622 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4552,比列:0.300000,数据库:0.21331999,计算:0.213319
2022-03-09 12:59:24.623 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 12:59:24.623 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:24.710 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 12:59:24.710 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-218.5660032258064516
2022-03-09 12:59:24.711 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:59:24.711 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:24.797 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:24.798 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:24.798 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:24.884 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:24.885 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 12:59:24.885 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 12:59:24.978 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 12:59:24.978 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 12:59:24.979 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 12:59:25.066 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 12:59:25.067 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:25.067 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 12:59:25.155 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:25.155 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 12:59:25.156 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:25.156 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 12:59:25.245 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:25.245 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 12:59:25.245 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 12:59:25.245 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 12:59:25.246 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:25.246 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 12:59:25.336 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:25.336 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 12:59:25.336 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 12:59:25.337 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:25.337 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 12:59:25.424 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:25.424 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 12:59:25.425 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 12:59:25.425 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 12:59:25.425 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 12:59:25.517 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 12:59:25.518 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 12:59:25.518 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 12:59:25.604 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 12:59:25.605 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:25.605 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 12:59:25.693 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:25.693 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 12:59:25.694 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 12:59:25.694 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:25.783 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:25.783 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 12:59:25.783 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:25.876 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:25.877 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 12:59:25.877 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:25.963 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:25.964 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 12:59:25.964 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 12:59:26.051 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 12:59:26.051 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:26.052 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 12:59:26.141 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:26.141 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 12:59:26.142 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:26.142 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 12:59:26.228 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:26.229 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 12:59:26.229 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:26.229 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 12:59:26.329 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:26.330 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 12:59:26.331 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 12:59:26.332 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 12:59:26.423 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 12:59:26.423 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 12:59:26.424 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 13:00:12.377 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 13:00:12.378 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 13:00:12.471 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 13:00:12.471 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:00:12.471 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:12.566 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:12.566 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 13:00:12.566 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:-800.9225376172704714,操作后，计算剩余的金额:-164.3876881372704714,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 13:00:12.567 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:00:12.567 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:00:12.653 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:00:12.654 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:00:12.654 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:00:12.744 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:00:12.745 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:00:12.745 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:00:12.835 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:00:12.836 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:00:12.836 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:00:12.929 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:00:12.930 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 13:00:12.930 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:00:13.024 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:00:13.024 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 13:00:13.024 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='' 
2022-03-09 13:00:13.025 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 13:00:13.123 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 31
2022-03-09 13:00:13.123 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=3, size=-15.3237600000000000, preBalance=1000.0000000000000000, postBalance=984.6762400000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467开仓保证金-15.3237600000000000, createdDate=2022-03-08 13:36:36, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0153230000000000, preBalance=984.6762400000000000, postBalance=984.6915630000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467返还手续费0.0153230000000000, createdDate=2022-03-08 13:36:36, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.1532376000000000, preBalance=984.6915630000000000, postBalance=984.5383254000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467开仓手续费-0.1532376000000000, createdDate=2022-03-08 13:36:36, fromUserId=0, total=null), UserBillChain(userId=51905047, type=3, size=-39.0798720000000000, preBalance=984.5383254000000000, postBalance=945.4584534000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468开仓保证金-39.0798720000000000, createdDate=2022-03-08 13:36:44, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0781590000000000, preBalance=945.4584534000000000, postBalance=945.5366124000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468返还手续费0.0781590000000000, createdDate=2022-03-08 13:36:44, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.7815974400000000, preBalance=945.5366124000000000, postBalance=944.7550149600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468开仓手续费-0.7815974400000000, createdDate=2022-03-08 13:36:46, fromUserId=0, total=null), UserBillChain(userId=51905047, type=3, size=-31.5054967741935483, preBalance=944.7550149600000000, postBalance=913.2495181858064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469开仓保证金-31.5054967741935483, createdDate=2022-03-08 13:36:58, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0781330000000000, preBalance=913.2495181858064517, postBalance=913.3276511858064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469返还手续费0.0781330000000000, createdDate=2022-03-08 13:36:58, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.7813363200000000, preBalance=913.3276511858064517, postBalance=912.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469开仓手续费-0.7813363200000000, createdDate=2022-03-08 13:37:06, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=912.5463148658064517, postBalance=812.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469增加保证金-100.0000000000000000, createdDate=2022-03-08 13:37:08, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=812.5463148658064517, postBalance=712.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4468, note=单号:4468增加保证金-100.0000000000000000, createdDate=2022-03-08 13:37:15, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=712.5463148658064517, postBalance=612.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4467, note=单号:4467增加保证金-100.0000000000000000, createdDate=2022-03-08 13:37:22, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-200.0000000000000000, preBalance=612.5463148658064517, postBalance=412.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469增加保证金-200.0000000000000000, createdDate=2022-03-08 13:38:57, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-100.0000000000000000, preBalance=412.5463148658064517, postBalance=312.5463148658064517, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4469, note=单号:4469增加保证金-100.0000000000000000, createdDate=2022-03-08 13:39:32, fromUserId=0, total=null), UserBillChain(userId=51905047, type=3, size=-12.3885784615384615, preBalance=312.5463148658064517, postBalance=300.1577364042679902, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4470, note=单号:4470开仓保证金-12.3885784615384615, createdDate=2022-03-08 13:44:11, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0322100000000000, preBalance=300.1577364042679902, postBalance=300.1899464042679902, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4470, note=单号:4470返还手续费0.0322100000000000, createdDate=2022-03-08 13:44:11, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-0.3221030400000000, preBalance=300.1899464042679902, postBalance=299.8678433642679902, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4470, note=单号:4470开仓手续费-0.3221030400000000, createdDate=2022-03-08 13:44:15, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=2.8896615384615384, preBalance=299.8678433642679902, postBalance=302.6885037027295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4471, note=单号:4471平仓收益2.8206603384615384, createdDate=2022-03-08 13:44:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0076660000000000, preBalance=302.6885037027295286, postBalance=302.6885037027295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4471, note=单号:4471返还手续费0.0076660000000000, createdDate=2022-03-08 13:44:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.0766672000000000, preBalance=302.6885037027295286, postBalance=302.6885037027295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4471, note=单号:4471平仓手续费-0.0766672000000000, createdDate=2022-03-08 13:45:05, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-4.9904000000000000, preBalance=302.6885037027295286, postBalance=297.4790290227295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4521, note=单号:4521平仓收益-5.2094746800000000, createdDate=2022-03-08 14:33:48, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0243410000000000, preBalance=297.4790290227295286, postBalance=297.4790290227295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4521, note=单号:4521返还手续费0.0243410000000000, createdDate=2022-03-08 14:33:48, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.2434156800000000, preBalance=297.4790290227295286, postBalance=297.4790290227295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4521, note=单号:4521平仓手续费-0.2434156800000000, createdDate=2022-03-08 14:33:57, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-97.6905000000000000, preBalance=297.4790290227295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4552, note=单号:4552平仓收益-98.4015666400000000, createdDate=2022-03-08 16:17:35, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0790070000000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4552, note=单号:4552返还手续费0.0790070000000000, createdDate=2022-03-08 16:17:35, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.7900736400000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4552, note=单号:4552平仓手续费-0.7900736400000000, createdDate=2022-03-08 16:17:39, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-218.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 13:00:13.124 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 13:00:13.124 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-15.3237600000000000
2022-03-09 13:00:13.124 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0153230000000000
2022-03-09 13:00:13.124 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.1532376000000000
2022-03-09 13:00:13.125 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4467' LIMIT 0,1000 
2022-03-09 13:00:13.125 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:13.219 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 13:00:13.219 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:13.219 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:13.311 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:13.312 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4467' and type=? limit 0,1 
2022-03-09 13:00:13.313 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 13:00:13.404 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:13.404 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4467,数据库:0.015323,计算:0.015323
2022-03-09 13:00:13.405 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:00:13.405 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:13.497 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:13.498 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:00:13.498 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:13.591 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:13.592 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:00:13.592 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:13.681 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:13.682 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:00:13.682 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:13.768 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:13.769 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4467' and type=? limit 0,1 
2022-03-09 13:00:13.769 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 13:00:13.854 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:13.855 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4467,比列:0.300000,数据库:0.04137438,计算:0.041373
2022-03-09 13:00:13.856 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4467' and type=? limit 0,1 
2022-03-09 13:00:13.856 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 13:00:13.949 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 13:00:13.949 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-39.0798720000000000
2022-03-09 13:00:13.950 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0781590000000000
2022-03-09 13:00:13.950 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.7815974400000000
2022-03-09 13:00:13.950 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4468' LIMIT 0,1000 
2022-03-09 13:00:13.951 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:14.036 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 13:00:14.037 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:14.037 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:14.135 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:14.136 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4468' and type=? limit 0,1 
2022-03-09 13:00:14.136 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 13:00:14.233 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:14.233 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4468,数据库:0.078159,计算:0.078159
2022-03-09 13:00:14.234 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:00:14.234 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:14.332 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:14.333 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:00:14.333 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:14.427 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:14.428 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:00:14.428 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:14.514 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:14.514 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:00:14.515 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:14.606 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:14.607 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4468' and type=? limit 0,1 
2022-03-09 13:00:14.608 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 13:00:14.696 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:14.696 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4468,比列:0.300000,数据库:0.21103153,计算:0.211031
2022-03-09 13:00:14.697 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4468' and type=? limit 0,1 
2022-03-09 13:00:14.697 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 13:00:14.791 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 13:00:14.792 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-31.5054967741935483
2022-03-09 13:00:14.792 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0781330000000000
2022-03-09 13:00:14.792 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.7813363200000000
2022-03-09 13:00:14.792 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4469' LIMIT 0,1000 
2022-03-09 13:00:14.793 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:14.882 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 4
2022-03-09 13:00:14.883 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:14.883 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:14.972 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:14.972 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4469' and type=? limit 0,1 
2022-03-09 13:00:14.973 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 13:00:15.066 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:15.067 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4469,数据库:0.078133,计算:0.078133
2022-03-09 13:00:15.067 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:00:15.067 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:15.154 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:15.155 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:00:15.155 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:15.251 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:15.252 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:00:15.252 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:15.352 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:15.352 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:00:15.352 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:15.440 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:15.441 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4469' and type=? limit 0,1 
2022-03-09 13:00:15.442 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 13:00:15.530 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:15.530 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4469,比列:0.300000,数据库:0.21096099,计算:0.210960
2022-03-09 13:00:15.531 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4469' and type=? limit 0,1 
2022-03-09 13:00:15.531 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 13:00:15.619 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 13:00:15.619 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 13:00:15.620 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 13:00:15.620 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 13:00:15.620 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-200.0000000000000000
2022-03-09 13:00:15.620 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-100.0000000000000000
2022-03-09 13:00:15.620 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-12.3885784615384615
2022-03-09 13:00:15.620 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0322100000000000
2022-03-09 13:00:15.620 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.3221030400000000
2022-03-09 13:00:15.621 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4470' LIMIT 0,1000 
2022-03-09 13:00:15.621 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:15.713 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:00:15.713 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:15.714 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:15.803 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:15.803 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4470' and type=? limit 0,1 
2022-03-09 13:00:15.804 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 13:00:15.893 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:15.893 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4470,数据库:0.032210,计算:0.032210
2022-03-09 13:00:15.894 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:00:15.894 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:15.981 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:15.982 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:00:15.982 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:16.074 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:16.075 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:00:16.075 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:16.167 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:16.167 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:00:16.168 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:16.270 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:16.271 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4470' and type=? limit 0,1 
2022-03-09 13:00:16.271 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 13:00:16.366 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:16.366 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4470,比列:0.300000,数据库:0.08696791,计算:0.086967
2022-03-09 13:00:16.367 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4470' and type=? limit 0,1 
2022-03-09 13:00:16.367 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 13:00:16.459 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 13:00:16.460 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:2.8896615384615384
2022-03-09 13:00:16.461 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4471' LIMIT 0,1000 
2022-03-09 13:00:16.461 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:16.554 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:00:16.555 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:16.555 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:16.649 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:16.650 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4471' 
2022-03-09 13:00:16.651 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 13:00:16.742 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 13:00:16.743 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4471' AND `margin_type` = 'FIXED' 
2022-03-09 13:00:16.744 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 13:00:16.835 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 13:00:16.836 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 13:00:16.836 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 13:00:16.927 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 13:00:16.927 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0076660000000000
2022-03-09 13:00:16.928 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.0766672000000000
2022-03-09 13:00:16.928 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4471' LIMIT 0,1000 
2022-03-09 13:00:16.929 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:17.018 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:00:17.019 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:17.020 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:17.108 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:17.109 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 13:00:17.110 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 13:00:17.203 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:17.203 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4471,数据库:0.007666,计算:0.007666
2022-03-09 13:00:17.204 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:00:17.205 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:17.301 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:17.302 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:00:17.302 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:17.393 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:17.394 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:00:17.395 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:17.487 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:17.487 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:00:17.488 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:17.578 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:17.579 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 13:00:17.579 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 13:00:17.669 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:17.670 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4471,比列:0.300000,数据库:0.02070036,计算:0.020700
2022-03-09 13:00:17.670 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4471' and type=? limit 0,1 
2022-03-09 13:00:17.670 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 13:00:17.765 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 13:00:17.766 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-4.9904000000000000
2022-03-09 13:00:17.767 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4521' LIMIT 0,1000 
2022-03-09 13:00:17.767 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:17.859 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:00:17.859 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:17.859 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:17.945 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:17.945 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 盈亏计算不正确--->,用户:51905047,订单:4521,类型:4
2022-03-09 13:00:17.946 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4521' 
2022-03-09 13:00:17.946 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 13:00:18.036 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 13:00:18.036 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4521' AND `margin_type` = 'FIXED' 
2022-03-09 13:00:18.037 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 13:00:18.129 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 13:00:18.130 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 13:00:18.130 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 13:00:18.223 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 13:00:18.223 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0243410000000000
2022-03-09 13:00:18.223 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.2434156800000000
2022-03-09 13:00:18.224 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4521' LIMIT 0,1000 
2022-03-09 13:00:18.224 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:18.310 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:00:18.311 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:18.311 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:18.397 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:18.398 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 13:00:18.398 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 13:00:18.487 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:18.488 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4521,数据库:0.024341,计算:0.024341
2022-03-09 13:00:18.489 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:00:18.489 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:18.576 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:18.577 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:00:18.577 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:18.665 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:18.665 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:00:18.665 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:18.752 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:18.753 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:00:18.753 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:18.839 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:18.840 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 13:00:18.841 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 13:00:18.927 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:18.927 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4521,比列:0.300000,数据库:0.06572240,计算:0.065722
2022-03-09 13:00:18.928 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4521' and type=? limit 0,1 
2022-03-09 13:00:18.928 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 13:00:19.015 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 13:00:19.016 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-97.6905000000000000
2022-03-09 13:00:19.016 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4552' LIMIT 0,1000 
2022-03-09 13:00:19.016 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:19.102 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:00:19.102 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:19.102 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:19.192 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:19.193 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 盈亏计算不正确--->,用户:51905047,订单:4552,类型:4
2022-03-09 13:00:19.193 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4552' 
2022-03-09 13:00:19.193 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 13:00:19.284 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 13:00:19.284 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4552' AND `margin_type` = 'FIXED' 
2022-03-09 13:00:19.285 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 13:00:19.379 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 13:00:19.380 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 13:00:19.380 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 13:00:19.474 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 13:00:19.474 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0790070000000000
2022-03-09 13:00:19.474 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.7900736400000000
2022-03-09 13:00:19.475 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4552' LIMIT 0,1000 
2022-03-09 13:00:19.475 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:19.566 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:00:19.566 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:19.567 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:19.654 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:19.655 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 13:00:19.655 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 13:00:19.746 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:19.746 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4552,数据库:0.079007,计算:0.079007
2022-03-09 13:00:19.747 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:00:19.747 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:19.840 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:19.841 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:00:19.841 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:19.932 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:19.932 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:00:19.932 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:20.025 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:20.025 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:00:20.025 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:20.119 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:20.120 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 13:00:20.120 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 13:00:20.212 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:20.212 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4552,比列:0.300000,数据库:0.21331999,计算:0.213319
2022-03-09 13:00:20.213 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4552' and type=? limit 0,1 
2022-03-09 13:00:20.213 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 13:00:20.317 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 0
2022-03-09 13:00:20.318 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-218.5660032258064516
2022-03-09 13:00:20.318 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 13:00:20.318 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:20.416 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:00:20.417 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:20.417 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:20.506 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:20.506 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 13:00:20.506 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 13:00:20.594 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 13:00:20.595 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 13:00:20.595 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 13:00:20.686 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 13:00:20.686 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:00:20.686 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 13:00:20.778 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:20.778 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 13:00:20.779 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:00:20.779 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 13:00:21.160 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:21.160 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 13:00:21.160 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 13:00:21.160 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 13:00:21.162 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:00:21.163 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 13:00:21.255 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:21.255 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 13:00:21.256 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 13:00:21.256 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:00:21.256 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 13:00:21.348 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:21.348 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 13:00:21.349 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 13:00:21.349 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 13:00:21.349 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:00:21.439 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:00:21.440 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:00:21.441 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:00:21.532 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:00:21.533 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:00:21.533 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 13:00:21.627 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:21.627 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 13:00:21.628 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:00:21.628 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:21.724 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:21.725 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:00:21.725 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:21.814 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:21.814 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:00:21.814 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:21.900 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:21.900 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:00:21.900 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:00:21.992 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:00:21.994 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:00:21.994 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 13:00:22.083 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:22.083 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 13:00:22.084 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:00:22.084 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 13:00:22.468 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:22.469 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 13:00:22.470 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:00:22.471 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 13:00:22.557 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:22.557 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 13:00:22.558 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:00:22.559 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 13:00:22.644 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:00:22.645 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 13:00:22.645 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 13:06:53.774 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:06:53.774 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:06:53.860 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:06:53.861 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:06:53.861 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:06:53.946 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:06:53.946 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:06:53.946 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:06:54.033 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:06:54.033 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:06:54.034 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:06:54.118 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:06:54.119 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 13:06:54.119 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:06:54.205 [http-nio-10090-exec-6] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:06:54.207 [http-nio-10090-exec-6] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 13:12:37.308 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Retrograde clock change detected (housekeeper delta=29s792ms), soft-evicting connections from pool.
2022-03-09 13:21:48.270 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=6m40s947ms).
2022-03-09 13:29:25.118 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=7m36s847ms).
2022-03-09 13:48:58.932 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2022-03-09 13:48:58.937 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2022-03-09 13:49:19.019 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5007 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 13:49:24.028 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 71929 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 13:49:24.029 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 13:49:24.866 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 13:49:24.869 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 13:49:24.894 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 13:49:24.899 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 13:49:24.900 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 13:49:24.909 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 8 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 13:49:24.924 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 13:49:24.926 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 13:49:24.945 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2022-03-09 13:49:25.648 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 13:49:25.661 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 13:49:25.661 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 13:49:25.661 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 13:49:25.816 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 13:49:25.816 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1723 ms
2022-03-09 13:49:27.214 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 13:49:28.014 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 13:49:28.016 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 13:49:28.016 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 13:49:28.273 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 13:49:28.289 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 13:49:28.302 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 25.034 seconds (JVM running for 25.61)
2022-03-09 13:50:02.411 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 13:50:02.413 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 13:50:02.414 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2022-03-09 13:50:02.810 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 13:50:04.355 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 13:50:04.366 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 11:35:00' and user_id = ? and type not in (16,27) 
2022-03-09 13:50:04.397 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 13:50:04.522 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 13:50:04.528 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:50:04.528 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:50:04.621 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:50:04.622 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 13:50:04.638 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:218.4830532258064516,操作后，计算剩余的金额:855.0179027058064516,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 13:50:04.638 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:50:04.639 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:50:04.734 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:50:04.735 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:50:04.735 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:50:04.837 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:50:04.838 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:50:04.838 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:50:04.931 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:50:04.932 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:50:04.933 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:50:05.026 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:50:05.027 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 13:50:05.028 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:50:05.130 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 13:50:05.131 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 13:50:05.132 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 11:35:00' 
2022-03-09 13:50:05.133 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 13:50:05.233 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 13:50:05.234 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-218.5660032258064516, preBalance=199.0774623827295286, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓收益-219.3125559858064516, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0829500000000000, preBalance=-20.2350936030769230, postBalance=-20.2350936030769230, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667返还手续费0.0829500000000000, createdDate=2022-03-09 11:35:00, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=21.9312555985806452, preBalance=-20.2350936030769230, postBalance=1.6961619955037222, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补21.9312555985806452, createdDate=2022-03-09 11:35:03, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=197.3813003872258064, preBalance=1.6961619955037222, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667穿仓回补197.3813003872258064, createdDate=2022-03-09 11:35:03, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-0.8295027600000000, preBalance=199.0774623827295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4667, note=单号:4667平仓手续费-0.8295027600000000, createdDate=2022-03-09 11:35:06, fromUserId=0, total=null)]
2022-03-09 13:50:05.234 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 13:50:05.235 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-218.5660032258064516
2022-03-09 13:50:05.243 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 13:50:05.243 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:50:05.338 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:50:05.339 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:50:05.340 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:50:05.435 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:50:05.439 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4667' 
2022-03-09 13:50:05.439 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 13:50:05.530 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 13:50:05.532 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4667' AND `margin_type` = 'FIXED' 
2022-03-09 13:50:05.533 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 13:50:05.624 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 13:50:05.683 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:50:05.683 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 13:50:05.778 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:50:05.779 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4667,比例:0.100000,数据库:65.00715000,计算得:65.007150
2022-03-09 13:50:05.780 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:50:05.781 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 13:50:05.876 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:50:05.876 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4667,数据库:585.06435000,计算得:585.064350
2022-03-09 13:50:05.877 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0829500000000000
2022-03-09 13:50:05.877 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:21.9312555985806452
2022-03-09 13:50:05.878 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:50:05.879 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 13:50:05.975 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:50:05.976 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4667,数据库:-21.93125559,计算得:21.931255
2022-03-09 13:50:05.977 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:197.3813003872258064
2022-03-09 13:50:05.978 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:50:05.980 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 13:50:06.080 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:50:06.083 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4667,数据库:-197.38130038,计算得:197.381300
2022-03-09 13:50:06.084 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8295027600000000
2022-03-09 13:50:06.085 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4667' LIMIT 0,1000 
2022-03-09 13:50:06.086 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 13:50:06.180 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 13:50:06.180 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 13:50:06.181 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 13:50:06.273 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 13:50:06.274 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:50:06.275 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 13:50:06.367 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:50:06.367 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4667,数据库:0.082950,计算:0.082950
2022-03-09 13:50:06.369 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 13:50:06.369 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:50:06.461 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:50:06.462 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 13:50:06.463 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:50:06.562 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:50:06.563 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 13:50:06.563 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:50:06.655 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:50:06.656 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 13:50:06.657 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 13:50:06.748 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 13:50:06.750 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:50:06.751 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 13:50:06.853 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:50:06.853 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4667,比列:0.300000,数据库:0.22396582,计算:0.223965
2022-03-09 13:50:06.854 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:50:06.855 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 13:50:06.947 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:50:06.947 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4667,比列:0.200000,数据库:0.14931055,计算:0.149310
2022-03-09 13:50:06.948 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:50:06.948 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 13:50:07.042 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:50:07.042 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4667,比列:0.400000,数据库:0.29862110,计算:0.298620
2022-03-09 13:50:07.043 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4667' and type=? limit 0,1 
2022-03-09 13:50:07.043 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 13:50:07.137 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 13:50:07.137 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4667,比列:0.100000,数据库:0.07465527,计算:0.074655
2022-03-09 13:50:07.137 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 13:54:03.343 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 13:54:03.345 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 13:54:03.442 [http-nio-10090-exec-4] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:25.395 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:35:25.398 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:25.490 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:25.491 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:35:25.491 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:25.579 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:25.581 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:35:25.581 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:25.669 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:25.670 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:35:25.670 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:25.760 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:25.761 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 14:35:25.762 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:25.852 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:25.853 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 14:35:25.887 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:35:25.888 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:25.978 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:25.979 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:35:25.980 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:26.069 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:26.072 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `liquidate_by` LIKE '%coerceClose%' LIMIT 0,1000 
2022-03-09 14:35:26.072 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:35:26.163 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 3
2022-03-09 14:35:26.164 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:35:26.164 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:35:26.253 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:35:26.254 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:35:26.254 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:26.342 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:26.343 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:35:26.343 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:26.433 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:26.434 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 账户初始保证金:9.4389169230769230,盈亏金额:-4.990400,手续费:0.243415,返的手续费:0.024341,最后金额:4.2294429230769230
2022-03-09 14:35:26.435 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:35:26.436 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:35:26.523 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:35:26.524 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:35:26.524 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:26.620 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:26.621 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:35:26.621 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:26.712 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:26.712 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 账户初始保证金:139.0798720000000000,盈亏金额:-97.690500,手续费:0.790073,返的手续费:0.079007,最后金额:40.6783060000000000
2022-03-09 14:35:26.713 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:35:26.714 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:35:26.803 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:35:26.804 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:35:26.805 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:26.895 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:26.896 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:35:26.897 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:35:26.987 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:35:26.988 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 账户初始保证金:431.5054967741935484,盈亏金额:-650.071500,手续费:0.829502,返的手续费:0.082950,最后金额:-219.3125552258064516
2022-03-09 14:35:26.990 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,合伙人的穿仓回退:51905041穿仓回退金额为:-21.931255;51904446穿仓回退金额为:-197.381299
2022-03-09 14:36:55.970 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:36:55.971 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:36:56.061 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:36:56.062 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:36:56.063 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:36:56.156 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:36:56.157 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:36:56.158 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:36:56.245 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:36:56.246 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:36:56.247 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:36:56.337 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:36:56.338 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 14:36:56.338 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:36:56.428 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:36:56.429 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 14:36:56.455 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:36:56.456 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:36:56.545 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:36:56.546 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:36:56.547 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:36:56.636 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:36:56.637 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `liquidate_by` LIKE '%coerceClose%' LIMIT 0,1000 
2022-03-09 14:36:56.638 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:36:56.727 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 0
2022-03-09 14:37:19.961 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:37:19.962 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:37:20.056 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:37:20.057 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:37:20.058 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:37:20.150 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:37:20.151 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:37:20.151 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:37:20.242 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:37:20.242 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:37:20.243 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:37:20.331 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:37:20.332 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 14:37:20.333 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:37:20.423 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:37:20.423 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 14:37:20.450 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:37:20.451 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:37:20.541 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:37:20.542 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:37:20.542 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:37:20.631 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:37:20.632 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `liquidate_by` LIKE '%coerceClose%' LIMIT 0,1000 
2022-03-09 14:37:20.633 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:37:20.725 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:37:20.726 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:37:20.726 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:37:20.814 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:37:20.815 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:37:20.815 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:37:20.904 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:37:20.905 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:37:20.906 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:37:20.997 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:37:20.998 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 账户初始保证金:115.3237600000000000,盈亏金额:-117.997000,手续费:0.166038,返的手续费:0.016603,最后金额:-2.8226750000000000
2022-03-09 14:37:20.999 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,合伙人的穿仓回退:51905041穿仓回退金额为:-0.282267;51904446穿仓回退金额为:-2.540407
2022-03-09 14:40:28.971 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'2022-03-09 14:20:00' and user_id = ? and type not in (16,27) 
2022-03-09 14:40:28.972 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 14:40:29.064 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 14:40:29.066 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:40:29.066 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:40:29.163 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:40:29.164 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 14:40:29.164 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:636.53484948,操作后，账户变化金额:0E-16,操作后，计算剩余的金额:636.5348494800000000,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 14:40:29.165 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:40:29.166 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:40:29.265 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:40:29.265 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:40:29.265 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:40:29.360 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:40:29.361 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:40:29.361 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:40:29.456 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:40:29.456 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:40:29.457 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:40:29.548 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:40:29.549 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 14:40:29.549 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:40:29.637 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:40:29.638 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 14:40:29.639 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='2022-03-09 14:20:00' 
2022-03-09 14:40:29.640 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 14:40:29.740 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 14:40:29.740 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-2.6732400000000000, preBalance=199.0774623827295286, postBalance=196.2547865827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4671, note=单号:4671平仓收益-2.8226758000000000, createdDate=2022-03-09 14:20:20, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0166030000000000, preBalance=196.2547865827295286, postBalance=196.2547865827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4671, note=单号:4671返还手续费0.0166030000000000, createdDate=2022-03-09 14:20:20, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.1660388000000000, preBalance=196.2547865827295286, postBalance=196.2547865827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4671, note=单号:4671平仓手续费-0.1660388000000000, createdDate=2022-03-09 14:20:22, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=0.2822675800000000, preBalance=196.2547865827295286, postBalance=196.5370541627295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4671, note=单号:4671穿仓回补0.2822675800000000, createdDate=2022-03-09 14:20:26, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=2.5404082200000000, preBalance=196.5370541627295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4671, note=单号:4671穿仓回补2.5404082200000000, createdDate=2022-03-09 14:20:27, fromUserId=51904446, total=null)]
2022-03-09 14:40:29.741 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 14:40:29.741 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-2.6732400000000000
2022-03-09 14:40:29.742 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4671' LIMIT 0,1000 
2022-03-09 14:40:29.742 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:40:29.831 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:40:29.832 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:40:29.833 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:40:29.930 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:40:29.931 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4671' 
2022-03-09 14:40:29.931 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 14:40:30.020 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 14:40:30.020 [http-nio-10090-exec-5] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4671' AND `margin_type` = 'FIXED' 
2022-03-09 14:40:30.021 [http-nio-10090-exec-5] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 14:40:30.110 [http-nio-10090-exec-5] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 14:40:30.111 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:40:30.113 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 14:40:30.206 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:40:30.206 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4671,比例:0.100000,数据库:11.79970000,计算得:11.799700
2022-03-09 14:40:30.207 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:40:30.207 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 14:40:30.302 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:40:30.303 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4671,数据库:106.19730000,计算得:106.197300
2022-03-09 14:40:30.303 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0166030000000000
2022-03-09 14:40:30.303 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.1660388000000000
2022-03-09 14:40:30.304 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4671' LIMIT 0,1000 
2022-03-09 14:40:30.305 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:40:30.393 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:40:30.394 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:40:30.394 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:40:30.484 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:40:30.486 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:40:30.487 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 14:40:30.577 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:40:30.578 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4671,数据库:0.016603,计算:0.016603
2022-03-09 14:40:30.579 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:40:30.580 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:40:30.671 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:40:30.672 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:40:30.673 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:40:30.765 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:40:30.766 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:40:30.767 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:40:30.856 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:40:30.858 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:40:30.858 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:40:30.951 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:40:30.952 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:40:30.953 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 14:40:31.047 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:40:31.047 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4671,比列:0.300000,数据库:0.04483074,计算:0.044830
2022-03-09 14:40:31.048 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:40:31.049 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 14:40:31.143 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:40:31.144 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4671,比列:0.200000,数据库:0.02988716,计算:0.029886
2022-03-09 14:40:31.145 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:40:31.145 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 14:40:31.236 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:40:31.236 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4671,比列:0.400000,数据库:0.05977432,计算:0.059773
2022-03-09 14:40:31.237 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:40:31.239 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 14:40:31.327 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:40:31.328 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4671,比列:0.100000,数据库:0.01494358,计算:0.014943
2022-03-09 14:40:31.328 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:0.2822675800000000
2022-03-09 14:40:31.329 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:40:31.329 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 14:40:31.419 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:40:31.420 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4671,数据库:-0.28226758,计算得:0.282267
2022-03-09 14:40:31.420 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:2.5404082200000000
2022-03-09 14:40:31.421 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:40:31.421 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 14:40:31.512 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:40:31.513 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4671,数据库:-2.54040822,计算得:2.540408
2022-03-09 14:40:31.514 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 14:41:36.846 [http-nio-10090-exec-8] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:41:36.847 [http-nio-10090-exec-8] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:41:36.935 [http-nio-10090-exec-8] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:41:36.936 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:41:36.936 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:41:37.026 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:41:37.100 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,账户user_balance:[UserBalanceChain(userId=51905047, currencyId=6, balance=199.0774623827295286, hold=0E-16)],user_partner_balance:[UserBalanceChain(userId=51905047, currencyId=6, balance=0E-16, hold=0E-16)]
2022-03-09 14:43:16.336 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 14:43:16.338 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 14:43:16.428 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 14:43:16.429 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:43:16.429 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:43:16.517 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:43:16.517 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:199.0774623827295286,hold:0E-16
2022-03-09 14:43:16.517 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:199.07746238272952,操作后，账户变化金额:0E-16,操作后，计算剩余的金额:199.0774623827295200,操作后，数据库存储的总金额:199.0774623827295286
2022-03-09 14:43:16.518 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:43:16.518 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:43:16.609 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:43:16.609 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:43:16.610 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:43:16.698 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:43:16.699 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:43:16.699 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:43:16.787 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:43:16.788 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:43:16.788 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:43:16.877 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:43:16.877 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 14:43:16.877 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:43:16.966 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:43:16.966 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 14:43:16.967 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='' 
2022-03-09 14:43:16.967 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 14:43:17.056 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 5
2022-03-09 14:43:17.056 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=4, size=-2.6732400000000000, preBalance=199.0774623827295286, postBalance=196.2547865827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4671, note=单号:4671平仓收益-2.8226758000000000, createdDate=2022-03-09 14:20:20, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.0166030000000000, preBalance=196.2547865827295286, postBalance=196.2547865827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4671, note=单号:4671返还手续费0.0166030000000000, createdDate=2022-03-09 14:20:20, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-0.1660388000000000, preBalance=196.2547865827295286, postBalance=196.2547865827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4671, note=单号:4671平仓手续费-0.1660388000000000, createdDate=2022-03-09 14:20:22, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=0.2822675800000000, preBalance=196.2547865827295286, postBalance=196.5370541627295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4671, note=单号:4671穿仓回补0.2822675800000000, createdDate=2022-03-09 14:20:26, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=2.5404082200000000, preBalance=196.5370541627295286, postBalance=199.0774623827295286, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4671, note=单号:4671穿仓回补2.5404082200000000, createdDate=2022-03-09 14:20:27, fromUserId=51904446, total=null)]
2022-03-09 14:43:17.057 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 14:43:17.057 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-2.6732400000000000
2022-03-09 14:43:17.057 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4671' LIMIT 0,1000 
2022-03-09 14:43:17.057 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:43:17.146 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:43:17.147 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:43:17.147 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:43:17.236 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:43:17.237 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4671' 
2022-03-09 14:43:17.237 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 14:43:17.325 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 14:43:17.327 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4671' AND `margin_type` = 'FIXED' 
2022-03-09 14:43:17.328 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 14:43:17.416 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 14:43:17.417 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:43:17.418 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 14:43:17.508 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:43:17.508 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4671,比例:0.100000,数据库:11.79970000,计算得:11.799700
2022-03-09 14:43:17.509 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:43:17.509 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 14:43:17.598 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:43:17.598 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4671,数据库:106.19730000,计算得:106.197300
2022-03-09 14:43:17.598 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0166030000000000
2022-03-09 14:43:17.599 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.1660388000000000
2022-03-09 14:43:17.599 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4671' LIMIT 0,1000 
2022-03-09 14:43:17.599 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:43:17.688 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:43:17.688 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:43:17.688 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:43:17.777 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:43:17.778 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:43:17.779 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 14:43:17.868 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:43:17.869 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4671,数据库:0.016603,计算:0.016603
2022-03-09 14:43:17.870 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:43:17.870 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:43:17.958 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:43:17.959 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:43:17.960 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:43:18.048 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:43:18.049 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:43:18.049 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:43:18.145 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:43:18.145 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:43:18.145 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:43:18.242 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:43:18.244 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:43:18.245 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 14:43:18.345 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:43:18.345 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4671,比列:0.300000,数据库:0.04483074,计算:0.044830
2022-03-09 14:43:18.346 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:43:18.346 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 14:43:18.440 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:43:18.441 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4671,比列:0.200000,数据库:0.02988716,计算:0.029886
2022-03-09 14:43:18.442 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:43:18.442 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 14:43:18.535 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:43:18.535 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4671,比列:0.400000,数据库:0.05977432,计算:0.059773
2022-03-09 14:43:18.536 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:43:18.537 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 14:43:18.625 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:43:18.626 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4671,比列:0.100000,数据库:0.01494358,计算:0.014943
2022-03-09 14:43:18.627 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:0.2822675800000000
2022-03-09 14:43:18.628 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:43:18.628 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 14:43:18.717 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:43:18.718 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4671,数据库:-0.28226758,计算得:0.282267
2022-03-09 14:43:18.718 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:2.5404082200000000
2022-03-09 14:43:18.719 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4671' and type=? limit 0,1 
2022-03-09 14:43:18.719 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 14:43:18.808 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:43:18.808 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4671,数据库:-2.54040822,计算得:2.540408
2022-03-09 14:43:18.808 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 14:45:35.308 [http-nio-10090-exec-4] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:45:35.309 [http-nio-10090-exec-4] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:45:35.397 [http-nio-10090-exec-4] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:45:35.397 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:45:35.397 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:45:35.485 [http-nio-10090-exec-4] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:45:35.504 [http-nio-10090-exec-4] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,账户user_balance:[UserBalanceChain(userId=51905047, currencyId=6, balance=1000.0000000000000000, hold=0E-16)],user_partner_balance:[UserBalanceChain(userId=51905047, currencyId=6, balance=0E-16, hold=0E-16)]
2022-03-09 14:47:04.741 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 14:47:04.742 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 14:47:04.831 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 14:47:04.832 [http-nio-10090-exec-7] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:47:04.832 [http-nio-10090-exec-7] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:47:04.920 [http-nio-10090-exec-7] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:47:04.920 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:474.2223589261538462,hold:0E-16
2022-03-09 14:47:04.921 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:1000.0,操作后，账户变化金额:-525.7776410738461538,操作后，计算剩余的金额:474.2223589261538462,操作后，数据库存储的总金额:474.2223589261538462
2022-03-09 14:47:04.921 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:47:04.921 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:47:05.010 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:47:05.010 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:47:05.011 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:47:05.099 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:47:05.103 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:47:05.103 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:47:05.192 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:47:05.194 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:47:05.194 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:47:05.285 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:47:05.286 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 14:47:05.286 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:47:05.376 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:47:05.377 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 14:47:05.378 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='' 
2022-03-09 14:47:05.378 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 14:47:05.473 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 9
2022-03-09 14:47:05.474 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=3, size=-405.2937661538461538, preBalance=1000.0000000000000000, postBalance=594.7062338461538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676开仓保证金-405.2937661538461538, createdDate=2022-03-09 14:45:47, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=1.0537630000000000, preBalance=594.7062338461538462, postBalance=595.7599968461538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676返还手续费1.0537630000000000, createdDate=2022-03-09 14:45:47, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-10.5376379200000000, preBalance=595.7599968461538462, postBalance=585.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676开仓手续费-10.5376379200000000, createdDate=2022-03-09 14:45:49, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-111.0000000000000000, preBalance=585.2223589261538462, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676增加保证金-111.0000000000000000, createdDate=2022-03-09 14:45:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-5837.9712338461538462, preBalance=474.2223589261538462, postBalance=-5373.2276138400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677平仓收益-5847.4499727661538462, createdDate=2022-03-09 14:46:52, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=1.0531930000000000, preBalance=-5373.2276138400000000, postBalance=-5373.2276138400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677返还手续费1.0531930000000000, createdDate=2022-03-09 14:46:52, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=584.7449972766153846, preBalance=-5373.2276138400000000, postBalance=-4788.4826165633846154, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677穿仓回补584.7449972766153846, createdDate=2022-03-09 14:46:59, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=5262.7049754895384616, preBalance=-4788.4826165633846154, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677穿仓回补5262.7049754895384616, createdDate=2022-03-09 14:46:59, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-10.5319319200000000, preBalance=474.2223589261538462, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677平仓手续费-10.5319319200000000, createdDate=2022-03-09 14:46:59, fromUserId=0, total=null)]
2022-03-09 14:47:05.475 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 14:47:05.475 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-405.2937661538461538
2022-03-09 14:47:05.476 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:1.0537630000000000
2022-03-09 14:47:05.476 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-10.5376379200000000
2022-03-09 14:47:05.476 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4676' LIMIT 0,1000 
2022-03-09 14:47:05.476 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:47:05.566 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 14:47:05.567 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:47:05.567 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:47:05.657 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:47:05.658 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:47:05.659 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 14:47:05.753 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:05.753 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4676,数据库:1.053763,计算:1.053763
2022-03-09 14:47:05.754 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:47:05.754 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:47:05.843 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:47:05.844 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:47:05.844 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:47:05.934 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:47:05.935 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:47:05.935 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:47:06.023 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:47:06.024 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:47:06.025 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:47:06.113 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:47:06.114 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:47:06.114 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 14:47:06.203 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:06.203 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4676,比列:0.300000,数据库:2.84516247,计算:2.845162
2022-03-09 14:47:06.204 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:47:06.204 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 14:47:06.294 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:06.294 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:51,订单:4676,比列:0.200000,数据库:1.89677498,计算:1.896774
2022-03-09 14:47:06.295 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:47:06.295 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 14:47:06.383 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:06.384 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:51,订单:4676,比列:0.400000,数据库:3.79354996,计算:3.793549
2022-03-09 14:47:06.385 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:47:06.385 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 14:47:06.475 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:06.476 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:51,订单:4676,比列:0.100000,数据库:0.94838749,计算:0.948387
2022-03-09 14:47:06.476 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-111.0000000000000000
2022-03-09 14:47:06.477 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-5837.9712338461538462
2022-03-09 14:47:06.478 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4677' LIMIT 0,1000 
2022-03-09 14:47:06.478 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:47:06.566 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:47:06.567 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:47:06.568 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:47:06.656 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:47:06.656 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4677' 
2022-03-09 14:47:06.657 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 14:47:06.744 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 14:47:06.745 [http-nio-10090-exec-7] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4677' AND `margin_type` = 'FIXED' 
2022-03-09 14:47:06.745 [http-nio-10090-exec-7] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 14:47:06.834 [http-nio-10090-exec-7] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 14:47:06.835 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:47:06.836 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 14:47:06.924 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:06.925 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4677,比例:0.100000,数据库:635.42650000,计算得:635.426500
2022-03-09 14:47:06.926 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:47:06.926 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 14:47:07.021 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:07.022 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4677,数据库:5718.83850000,计算得:5718.838500
2022-03-09 14:47:07.022 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:1.0531930000000000
2022-03-09 14:47:07.022 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:584.7449972766153846
2022-03-09 14:47:07.023 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:47:07.023 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 14:47:07.113 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:07.114 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4677,数据库:-584.74499727,计算得:584.744997
2022-03-09 14:47:07.114 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:5262.7049754895384616
2022-03-09 14:47:07.114 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:47:07.115 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 14:47:07.203 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:07.204 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4677,数据库:-5262.70497548,计算得:5262.704975
2022-03-09 14:47:07.204 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-10.5319319200000000
2022-03-09 14:47:07.205 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4677' LIMIT 0,1000 
2022-03-09 14:47:07.205 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:47:07.294 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:47:07.294 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:47:07.294 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:47:07.382 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:47:07.384 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:47:07.384 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 14:47:07.474 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:07.474 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4677,数据库:1.053193,计算:1.053193
2022-03-09 14:47:07.475 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:47:07.475 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:47:07.565 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:47:07.566 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:47:07.566 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:47:07.654 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:47:07.655 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:47:07.656 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:47:07.743 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:47:07.744 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:47:07.744 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:47:07.836 [http-nio-10090-exec-7] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:47:07.837 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:47:07.837 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 14:47:07.926 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:07.927 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4677,比列:0.300000,数据库:2.84362167,计算:2.843621
2022-03-09 14:47:07.927 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:47:07.928 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 14:47:08.018 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:08.019 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4677,比列:0.200000,数据库:1.89574778,计算:1.895747
2022-03-09 14:47:08.019 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:47:08.019 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 14:47:08.108 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:08.109 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4677,比列:0.400000,数据库:3.79149556,计算:3.791495
2022-03-09 14:47:08.110 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:47:08.110 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 14:47:08.201 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:47:08.201 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4677,比列:0.100000,数据库:0.94787389,计算:0.947873
2022-03-09 14:47:08.202 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 14:52:28.159 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2022-03-09 14:52:28.162 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2022-03-09 14:52:48.463 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5004 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 14:52:53.477 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 72307 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 14:52:53.478 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 14:52:54.301 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 14:52:54.304 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 14:52:54.323 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 15 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 14:52:54.329 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 14:52:54.329 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 14:52:54.338 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 8 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 14:52:54.351 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 14:52:54.353 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 14:52:54.368 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2022-03-09 14:52:55.011 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 14:52:55.024 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 14:52:55.025 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 14:52:55.025 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 14:52:55.156 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 14:52:55.156 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1621 ms
2022-03-09 14:52:56.231 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 14:52:56.906 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 14:52:56.908 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 14:52:56.908 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 14:52:57.128 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 14:52:57.145 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 14:52:57.156 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 24.286 seconds (JVM running for 24.795)
2022-03-09 14:56:11.554 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 14:56:11.555 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 14:56:11.556 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2022-03-09 14:56:11.988 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 14:56:13.129 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 14:56:13.143 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 14:56:13.175 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 14:56:13.289 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 14:56:13.295 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:56:13.295 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:56:13.380 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:56:13.381 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:474.2223589261538462,hold:0E-16
2022-03-09 14:56:13.397 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:1000.0,操作后，账户变化金额:-525.7776410738461538,操作后，计算剩余的金额:474.2223589261538462,操作后，数据库存储的总金额:474.2223589261538462
2022-03-09 14:56:13.400 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:56:13.400 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:56:13.487 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:56:13.488 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:56:13.489 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:56:13.576 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:56:13.577 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:56:13.578 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:56:13.663 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:56:13.663 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:56:13.664 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:56:13.748 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:56:13.749 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 14:56:13.749 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:56:13.839 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:56:13.840 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 14:56:13.841 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='' 
2022-03-09 14:56:13.842 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 14:56:13.936 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 9
2022-03-09 14:56:13.936 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=3, size=-405.2937661538461538, preBalance=1000.0000000000000000, postBalance=594.7062338461538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676开仓保证金-405.2937661538461538, createdDate=2022-03-09 14:45:47, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=1.0537630000000000, preBalance=594.7062338461538462, postBalance=595.7599968461538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676返还手续费1.0537630000000000, createdDate=2022-03-09 14:45:47, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-10.5376379200000000, preBalance=595.7599968461538462, postBalance=585.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676开仓手续费-10.5376379200000000, createdDate=2022-03-09 14:45:49, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-111.0000000000000000, preBalance=585.2223589261538462, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676增加保证金-111.0000000000000000, createdDate=2022-03-09 14:45:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-5837.9712338461538462, preBalance=474.2223589261538462, postBalance=-5373.2276138400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677平仓收益-5847.4499727661538462, createdDate=2022-03-09 14:46:52, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=1.0531930000000000, preBalance=-5373.2276138400000000, postBalance=-5373.2276138400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677返还手续费1.0531930000000000, createdDate=2022-03-09 14:46:52, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=584.7449972766153846, preBalance=-5373.2276138400000000, postBalance=-4788.4826165633846154, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677穿仓回补584.7449972766153846, createdDate=2022-03-09 14:46:59, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=5262.7049754895384616, preBalance=-4788.4826165633846154, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677穿仓回补5262.7049754895384616, createdDate=2022-03-09 14:46:59, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-10.5319319200000000, preBalance=474.2223589261538462, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677平仓手续费-10.5319319200000000, createdDate=2022-03-09 14:46:59, fromUserId=0, total=null)]
2022-03-09 14:56:13.938 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 14:56:13.938 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-405.2937661538461538
2022-03-09 14:56:13.939 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:1.0537630000000000
2022-03-09 14:56:13.939 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-10.5376379200000000
2022-03-09 14:56:13.947 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4676' LIMIT 0,1000 
2022-03-09 14:56:13.947 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:56:14.035 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 14:56:14.036 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:56:14.036 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:56:14.125 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:56:14.187 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:56:14.188 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 14:56:14.276 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:14.277 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4676,数据库:1.053763,计算:1.053763
2022-03-09 14:56:14.278 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:56:14.279 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:56:14.366 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:56:14.366 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:56:14.367 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:56:14.451 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:56:14.452 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:56:14.452 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:56:14.538 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:56:14.540 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:56:14.540 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:56:14.626 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:56:14.628 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:56:14.629 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 14:56:14.716 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:14.717 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4676,比列:0.300000,数据库:2.84516247,计算:2.845162
2022-03-09 14:56:14.718 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:56:14.718 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 14:56:14.805 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:14.806 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:51,订单:4676,比列:0.200000,数据库:1.89677498,计算:1.896774
2022-03-09 14:56:14.807 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:56:14.807 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 14:56:14.906 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:14.907 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:51,订单:4676,比列:0.400000,数据库:3.79354996,计算:3.793549
2022-03-09 14:56:14.908 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:56:14.908 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 14:56:14.995 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:14.996 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:51,订单:4676,比列:0.100000,数据库:0.94838749,计算:0.948387
2022-03-09 14:56:14.996 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-111.0000000000000000
2022-03-09 14:56:14.996 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-5837.9712338461538462
2022-03-09 14:56:14.997 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4677' LIMIT 0,1000 
2022-03-09 14:56:14.997 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:56:15.087 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:56:15.088 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:56:15.089 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:56:15.173 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:56:15.175 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4677' 
2022-03-09 14:56:15.176 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 14:56:15.261 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 14:56:15.263 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4677' AND `margin_type` = 'FIXED' 
2022-03-09 14:56:15.264 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 14:56:15.349 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 14:56:15.351 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:56:15.351 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 14:56:15.438 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:15.439 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4677,比例:0.100000,数据库:635.42650000,计算得:635.426500
2022-03-09 14:56:15.440 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:56:15.441 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 14:56:15.532 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:15.533 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4677,数据库:5718.83850000,计算得:5718.838500
2022-03-09 14:56:15.533 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:1.0531930000000000
2022-03-09 14:56:15.533 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:584.7449972766153846
2022-03-09 14:56:15.534 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:56:15.534 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 14:56:15.621 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:15.622 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4677,数据库:-584.74499727,计算得:584.744997
2022-03-09 14:56:15.623 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:5262.7049754895384616
2022-03-09 14:56:15.624 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:56:15.625 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 14:56:15.711 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:15.711 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4677,数据库:-5262.70497548,计算得:5262.704975
2022-03-09 14:56:15.712 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-10.5319319200000000
2022-03-09 14:56:15.712 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4677' LIMIT 0,1000 
2022-03-09 14:56:15.712 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:56:15.799 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:56:15.800 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:56:15.800 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:56:15.884 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:56:15.886 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:56:15.886 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 14:56:15.973 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:15.974 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4677,数据库:1.053193,计算:1.053193
2022-03-09 14:56:15.975 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:56:15.976 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:56:16.062 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:56:16.063 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:56:16.063 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:56:16.149 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:56:16.150 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:56:16.150 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:56:16.234 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:56:16.235 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:56:16.235 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:56:16.320 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:56:16.321 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:56:16.322 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 14:56:16.408 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:16.409 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4677,比列:0.300000,数据库:2.84362167,计算:2.843621
2022-03-09 14:56:16.411 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:56:16.412 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 14:56:16.497 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:16.498 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4677,比列:0.200000,数据库:1.89574778,计算:1.895747
2022-03-09 14:56:16.499 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:56:16.499 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 14:56:16.584 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:16.585 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4677,比列:0.400000,数据库:3.79149556,计算:3.791495
2022-03-09 14:56:16.586 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:56:16.587 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 14:56:16.673 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:56:16.673 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4677,比列:0.100000,数据库:0.94787389,计算:0.947873
2022-03-09 14:56:16.673 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 14:59:15.204 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2022-03-09 14:59:15.220 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2022-03-09 14:59:35.145 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 5004 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 14:59:40.159 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 72346 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 14:59:40.160 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 14:59:41.137 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 14:59:41.139 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 14:59:41.157 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 13 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 14:59:41.161 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 14:59:41.162 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 14:59:41.169 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 14:59:41.178 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 14:59:41.180 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 14:59:41.195 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2022-03-09 14:59:41.931 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 14:59:41.945 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 14:59:41.946 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 14:59:41.946 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 14:59:42.095 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 14:59:42.095 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1876 ms
2022-03-09 14:59:43.390 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 14:59:44.132 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 14:59:44.135 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 14:59:44.135 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 14:59:44.413 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 14:59:44.429 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 14:59:44.440 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 24.969 seconds (JVM running for 25.488)
2022-03-09 14:59:47.870 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 14:59:47.870 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 14:59:47.872 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2022-03-09 14:59:48.276 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 14:59:49.493 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 14:59:49.502 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 14:59:49.543 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 14:59:49.656 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 14:59:49.661 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:59:49.661 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:59:49.749 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:59:49.750 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:474.2223589261538462,hold:0E-16
2022-03-09 14:59:49.759 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:1000.0,操作后，账户变化金额:-525.7776410738461538,操作后，计算剩余的金额:474.2223589261538462,操作后，数据库存储的总金额:474.2223589261538462
2022-03-09 14:59:49.760 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:59:49.761 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:59:49.851 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:59:49.852 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:59:49.852 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:59:49.950 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:59:49.951 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:59:49.952 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:59:50.047 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:59:50.048 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:59:50.049 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:59:50.140 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:59:50.140 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 14:59:50.141 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 14:59:50.233 [http-nio-10090-exec-1] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 14:59:50.233 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 14:59:50.234 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='' 
2022-03-09 14:59:50.234 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 14:59:50.348 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 9
2022-03-09 14:59:50.348 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=3, size=-405.2937661538461538, preBalance=1000.0000000000000000, postBalance=594.7062338461538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676开仓保证金-405.2937661538461538, createdDate=2022-03-09 14:45:47, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=1.0537630000000000, preBalance=594.7062338461538462, postBalance=595.7599968461538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676返还手续费1.0537630000000000, createdDate=2022-03-09 14:45:47, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-10.5376379200000000, preBalance=595.7599968461538462, postBalance=585.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676开仓手续费-10.5376379200000000, createdDate=2022-03-09 14:45:49, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-111.0000000000000000, preBalance=585.2223589261538462, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676增加保证金-111.0000000000000000, createdDate=2022-03-09 14:45:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-5837.9712338461538462, preBalance=474.2223589261538462, postBalance=-5373.2276138400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677平仓收益-5847.4499727661538462, createdDate=2022-03-09 14:46:52, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=1.0531930000000000, preBalance=-5373.2276138400000000, postBalance=-5373.2276138400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677返还手续费1.0531930000000000, createdDate=2022-03-09 14:46:52, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=584.7449972766153846, preBalance=-5373.2276138400000000, postBalance=-4788.4826165633846154, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677穿仓回补584.7449972766153846, createdDate=2022-03-09 14:46:59, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=5262.7049754895384616, preBalance=-4788.4826165633846154, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677穿仓回补5262.7049754895384616, createdDate=2022-03-09 14:46:59, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-10.5319319200000000, preBalance=474.2223589261538462, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677平仓手续费-10.5319319200000000, createdDate=2022-03-09 14:46:59, fromUserId=0, total=null)]
2022-03-09 14:59:50.350 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 14:59:50.350 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-405.2937661538461538
2022-03-09 14:59:50.350 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:1.0537630000000000
2022-03-09 14:59:50.351 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-10.5376379200000000
2022-03-09 14:59:50.359 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4676' LIMIT 0,1000 
2022-03-09 14:59:50.359 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:59:50.451 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 14:59:50.453 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:59:50.453 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:59:50.544 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:59:50.599 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:59:50.599 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 14:59:50.689 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:50.690 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4676,数据库:1.053763,计算:1.053763
2022-03-09 14:59:50.691 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:59:50.691 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:59:50.781 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:59:50.782 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:59:50.783 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:59:50.872 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:59:50.873 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:59:50.873 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:59:50.964 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:59:50.967 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:59:50.968 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:59:51.062 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:59:51.063 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:59:51.064 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 14:59:51.156 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:51.157 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4676,比列:0.300000,数据库:2.84516247,计算:2.845162
2022-03-09 14:59:51.158 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:59:51.158 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 14:59:51.250 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:51.250 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:51,订单:4676,比列:0.200000,数据库:1.89677498,计算:1.896774
2022-03-09 14:59:51.251 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:59:51.252 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 14:59:51.342 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:51.343 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:51,订单:4676,比列:0.400000,数据库:3.79354996,计算:3.793549
2022-03-09 14:59:51.343 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 14:59:51.344 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 14:59:51.436 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:51.436 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:51,订单:4676,比列:0.100000,数据库:0.94838749,计算:0.948387
2022-03-09 14:59:51.437 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-111.0000000000000000
2022-03-09 14:59:51.437 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-5837.9712338461538462
2022-03-09 14:59:51.438 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4677' LIMIT 0,1000 
2022-03-09 14:59:51.438 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:59:51.527 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:59:51.528 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:59:51.529 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:59:51.617 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:59:51.617 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4677' 
2022-03-09 14:59:51.617 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 14:59:51.707 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 14:59:51.708 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4677' AND `margin_type` = 'FIXED' 
2022-03-09 14:59:51.709 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 14:59:51.797 [http-nio-10090-exec-1] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 14:59:51.799 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:59:51.799 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 14:59:51.888 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:51.889 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4677,比例:0.100000,数据库:635.42650000,计算得:635.426500
2022-03-09 14:59:51.889 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:59:51.889 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 14:59:51.982 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:51.983 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4677,数据库:5718.83850000,计算得:5718.838500
2022-03-09 14:59:51.983 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:1.0531930000000000
2022-03-09 14:59:51.983 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:584.7449972766153846
2022-03-09 14:59:51.983 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:59:51.984 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 14:59:52.077 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:52.077 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4677,数据库:-584.74499727,计算得:584.744997
2022-03-09 14:59:52.077 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:5262.7049754895384616
2022-03-09 14:59:52.078 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:59:52.078 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 14:59:52.167 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:52.168 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4677,数据库:-5262.70497548,计算得:5262.704975
2022-03-09 14:59:52.168 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-10.5319319200000000
2022-03-09 14:59:52.169 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4677' LIMIT 0,1000 
2022-03-09 14:59:52.169 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 14:59:52.260 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 14:59:52.260 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 14:59:52.261 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 14:59:52.350 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 14:59:52.351 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:59:52.352 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 14:59:52.442 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:52.443 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4677,数据库:1.053193,计算:1.053193
2022-03-09 14:59:52.443 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 14:59:52.443 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:59:52.536 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:59:52.537 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 14:59:52.537 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:59:52.626 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:59:52.627 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 14:59:52.627 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:59:52.717 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:59:52.718 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 14:59:52.718 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 14:59:52.807 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 14:59:52.808 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:59:52.808 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 14:59:52.902 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:52.902 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4677,比列:0.300000,数据库:2.84362167,计算:2.843621
2022-03-09 14:59:52.903 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:59:52.904 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 14:59:52.998 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:52.998 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4677,比列:0.200000,数据库:1.89574778,计算:1.895747
2022-03-09 14:59:52.999 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:59:53.000 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 14:59:53.091 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:53.092 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4677,比列:0.400000,数据库:3.79149556,计算:3.791495
2022-03-09 14:59:53.093 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 14:59:53.093 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 14:59:53.184 [http-nio-10090-exec-1] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 14:59:53.184 [http-nio-10090-exec-1] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4677,比列:0.100000,数据库:0.94787389,计算:0.947873
2022-03-09 14:59:53.185 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 15:03:35.441 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2022-03-09 15:03:35.451 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2022-03-09 15:03:55.479 [main] WARN  org.springframework.boot.StartupInfoLogger - InetAddress.getLocalHost().getHostName() took 4871 milliseconds to respond. Please verify your network configuration (macOS machines may need to add entries to /etc/hosts).
2022-03-09 15:03:55.486 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 72406 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 15:03:55.487 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 15:03:56.445 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 15:03:56.448 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 15:03:56.468 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 15:03:56.475 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 15:03:56.476 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 15:03:56.486 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 15:03:56.501 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 15:03:56.503 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 15:03:56.521 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2022-03-09 15:03:57.234 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 15:03:57.247 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 15:03:57.248 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 15:03:57.248 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 15:03:57.378 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 15:03:57.378 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1837 ms
2022-03-09 15:03:58.551 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 15:03:59.373 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 15:03:59.375 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 15:03:59.375 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 15:03:59.644 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 15:03:59.662 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 15:03:59.677 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 19.805 seconds (JVM running for 20.367)
2022-03-09 15:04:22.996 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 15:04:22.997 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 15:04:22.998 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2022-03-09 15:04:23.449 [http-nio-10090-exec-2] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 15:04:24.682 [http-nio-10090-exec-2] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 15:04:24.692 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 15:04:24.727 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 15:04:24.858 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 15:04:24.864 [http-nio-10090-exec-2] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:04:24.864 [http-nio-10090-exec-2] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:04:24.959 [http-nio-10090-exec-2] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:04:24.959 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:474.2223589261538462,hold:0E-16
2022-03-09 15:04:24.973 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:1000.0,操作后，账户变化金额:-525.7776410738461538,操作后，计算剩余的金额:474.2223589261538462,操作后，数据库存储的总金额:474.2223589261538462
2022-03-09 15:04:24.975 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:04:24.975 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:04:25.073 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:04:25.074 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:04:25.074 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:04:25.172 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:04:25.173 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:04:25.174 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:04:25.269 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:04:25.270 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:04:25.271 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:04:25.366 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:04:25.368 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 15:04:25.369 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:04:25.465 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:04:25.466 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 15:04:25.467 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='' 
2022-03-09 15:04:25.468 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 15:04:25.573 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 9
2022-03-09 15:04:25.574 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=3, size=-405.2937661538461538, preBalance=1000.0000000000000000, postBalance=594.7062338461538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676开仓保证金-405.2937661538461538, createdDate=2022-03-09 14:45:47, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=1.0537630000000000, preBalance=594.7062338461538462, postBalance=595.7599968461538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676返还手续费1.0537630000000000, createdDate=2022-03-09 14:45:47, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-10.5376379200000000, preBalance=595.7599968461538462, postBalance=585.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676开仓手续费-10.5376379200000000, createdDate=2022-03-09 14:45:49, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-111.0000000000000000, preBalance=585.2223589261538462, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676增加保证金-111.0000000000000000, createdDate=2022-03-09 14:45:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-5837.9712338461538462, preBalance=474.2223589261538462, postBalance=-5373.2276138400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677平仓收益-5847.4499727661538462, createdDate=2022-03-09 14:46:52, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=1.0531930000000000, preBalance=-5373.2276138400000000, postBalance=-5373.2276138400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677返还手续费1.0531930000000000, createdDate=2022-03-09 14:46:52, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=584.7449972766153846, preBalance=-5373.2276138400000000, postBalance=-4788.4826165633846154, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677穿仓回补584.7449972766153846, createdDate=2022-03-09 14:46:59, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=5262.7049754895384616, preBalance=-4788.4826165633846154, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677穿仓回补5262.7049754895384616, createdDate=2022-03-09 14:46:59, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-10.5319319200000000, preBalance=474.2223589261538462, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677平仓手续费-10.5319319200000000, createdDate=2022-03-09 14:46:59, fromUserId=0, total=null)]
2022-03-09 15:04:25.575 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 15:04:25.576 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-405.2937661538461538
2022-03-09 15:04:25.576 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:1.0537630000000000
2022-03-09 15:04:25.576 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-10.5376379200000000
2022-03-09 15:04:25.582 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4676' LIMIT 0,1000 
2022-03-09 15:04:25.582 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:04:25.679 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 15:04:25.680 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:04:25.680 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:04:25.774 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:04:25.832 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 15:04:25.833 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 15:04:25.930 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:25.931 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4676,数据库:1.053763,计算:1.053763
2022-03-09 15:04:25.933 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:04:25.933 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:04:26.026 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:04:26.027 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:04:26.027 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:04:26.125 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:04:26.126 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:04:26.126 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:04:26.227 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:04:26.228 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:04:26.228 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:04:26.325 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:04:26.326 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 15:04:26.327 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:04:26.423 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:26.424 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4676,比列:0.300000,数据库:2.84516247,计算:2.845162
2022-03-09 15:04:26.426 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 15:04:26.427 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:04:26.521 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:26.521 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:51,订单:4676,比列:0.200000,数据库:1.89677498,计算:1.896774
2022-03-09 15:04:26.522 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 15:04:26.522 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:04:26.622 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:26.622 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:51,订单:4676,比列:0.400000,数据库:3.79354996,计算:3.793549
2022-03-09 15:04:26.623 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 15:04:26.623 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 15:04:26.720 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:26.720 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:51,订单:4676,比列:0.100000,数据库:0.94838749,计算:0.948387
2022-03-09 15:04:26.721 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-111.0000000000000000
2022-03-09 15:04:26.721 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-5837.9712338461538462
2022-03-09 15:04:26.721 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4677' LIMIT 0,1000 
2022-03-09 15:04:26.721 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:04:26.818 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:04:26.819 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:04:26.819 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:04:26.912 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:04:26.914 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4677' 
2022-03-09 15:04:26.914 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 15:04:27.007 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 15:04:27.008 [http-nio-10090-exec-2] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4677' AND `margin_type` = 'FIXED' 
2022-03-09 15:04:27.009 [http-nio-10090-exec-2] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 15:04:27.109 [http-nio-10090-exec-2] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 15:04:27.110 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:04:27.111 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 15:04:27.207 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:27.207 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4677,比例:0.100000,数据库:635.42650000,计算得:635.426500
2022-03-09 15:04:27.207 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:04:27.208 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 15:04:27.305 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:27.306 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4677,数据库:5718.83850000,计算得:5718.838500
2022-03-09 15:04:27.306 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:1.0531930000000000
2022-03-09 15:04:27.306 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:584.7449972766153846
2022-03-09 15:04:27.307 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:04:27.307 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 15:04:27.403 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:27.404 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4677,数据库:-584.74499727,计算得:584.744997
2022-03-09 15:04:27.405 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:5262.7049754895384616
2022-03-09 15:04:27.406 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:04:27.406 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 15:04:27.501 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:27.502 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4677,数据库:-5262.70497548,计算得:5262.704975
2022-03-09 15:04:27.503 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-10.5319319200000000
2022-03-09 15:04:27.504 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4677' LIMIT 0,1000 
2022-03-09 15:04:27.505 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:04:27.602 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:04:27.603 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:04:27.603 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:04:27.703 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:04:27.705 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:04:27.705 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 15:04:27.800 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:27.800 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4677,数据库:1.053193,计算:1.053193
2022-03-09 15:04:27.801 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:04:27.801 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:04:27.896 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:04:27.896 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:04:27.897 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:04:27.990 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:04:27.990 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:04:27.990 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:04:28.085 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:04:28.086 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:04:28.086 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:04:28.181 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:04:28.182 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:04:28.183 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:04:28.279 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:28.279 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4677,比列:0.300000,数据库:2.84362167,计算:2.843621
2022-03-09 15:04:28.280 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:04:28.280 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:04:28.374 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:28.375 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4677,比列:0.200000,数据库:1.89574778,计算:1.895747
2022-03-09 15:04:28.375 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:04:28.376 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:04:28.470 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:28.471 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4677,比列:0.400000,数据库:3.79149556,计算:3.791495
2022-03-09 15:04:28.472 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:04:28.473 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 15:04:28.569 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:04:28.569 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4677,比列:0.100000,数据库:0.94787389,计算:0.947873
2022-03-09 15:04:28.570 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 15:08:41.670 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:08:41.670 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:41.766 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:41.767 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:08:41.768 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:41.872 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:41.872 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:08:41.872 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:41.968 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:41.969 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:08:41.969 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:42.064 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:42.065 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 15:08:42.065 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:42.159 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:42.160 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 15:08:42.180 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:08:42.180 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:42.274 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:42.275 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:08:42.275 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:42.373 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:42.375 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionFinish - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,fee,partner_id partnerId,parent_id parentId,liquidate_by liquidateBy FROM `bib_cfd`.`position_finish` WHERE `user_id` = '51905047' AND `liquidate_by` LIKE '%coerceClose%' LIMIT 0,1000 
2022-03-09 15:08:42.375 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionFinish - ==> Parameters: 
2022-03-09 15:08:42.472 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionFinish - <==      Total: 0
2022-03-09 15:08:43.391 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:08:43.392 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:43.488 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:43.489 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:08:43.489 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:43.586 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:43.587 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:08:43.588 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:43.682 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:43.683 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:08:43.683 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:43.782 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:43.783 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 15:08:43.784 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:43.879 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:43.880 [http-nio-10090-exec-7] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 15:08:43.904 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:08:43.905 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:44.006 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:44.006 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:08:44.007 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:44.101 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:44.103 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `liquidate_by` LIKE '%coerceClose%' LIMIT 0,1000 
2022-03-09 15:08:44.103 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:08:44.200 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:08:44.201 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:08:44.201 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:08:44.296 [http-nio-10090-exec-7] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:08:44.298 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:08:44.298 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:44.394 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:44.395 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:08:44.396 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:08:44.491 [http-nio-10090-exec-7] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:08:44.492 [http-nio-10090-exec-7] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 账户初始保证金:58.7902492753623188,盈亏金额:-47.506800,手续费:1.015440,返的手续费:0.101544,最后金额:10.3695532753623188
2022-03-09 15:09:36.081 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 15:09:36.082 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905047(String)
2022-03-09 15:09:36.177 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 15:09:36.179 [http-nio-10090-exec-9] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:09:36.179 [http-nio-10090-exec-9] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:36.276 [http-nio-10090-exec-9] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:36.276 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:424.8877928861538462,hold:0E-16
2022-03-09 15:09:36.279 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:1000.0,操作后，账户变化金额:-575.1122071138461538,操作后，计算剩余的金额:424.8877928861538462,操作后，数据库存储的总金额:424.8877928861538462
2022-03-09 15:09:36.279 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:09:36.280 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:09:36.375 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:09:36.376 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:09:36.377 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:09:36.484 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:09:36.484 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:09:36.485 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:09:36.585 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:09:36.586 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:09:36.586 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:09:36.683 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:09:36.683 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 15:09:36.683 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:09:36.780 [http-nio-10090-exec-9] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:09:36.781 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 15:09:36.781 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905047' and created_date>='' 
2022-03-09 15:09:36.782 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 15:09:36.880 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 16
2022-03-09 15:09:36.880 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905047,流水:[UserBillChain(userId=51905047, type=3, size=-405.2937661538461538, preBalance=1000.0000000000000000, postBalance=594.7062338461538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676开仓保证金-405.2937661538461538, createdDate=2022-03-09 14:45:47, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=1.0537630000000000, preBalance=594.7062338461538462, postBalance=595.7599968461538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676返还手续费1.0537630000000000, createdDate=2022-03-09 14:45:47, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-10.5376379200000000, preBalance=595.7599968461538462, postBalance=585.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676开仓手续费-10.5376379200000000, createdDate=2022-03-09 14:45:49, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-111.0000000000000000, preBalance=585.2223589261538462, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4676, note=单号:4676增加保证金-111.0000000000000000, createdDate=2022-03-09 14:45:56, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=-5837.9712338461538462, preBalance=474.2223589261538462, postBalance=-5373.2276138400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677平仓收益-5847.4499727661538462, createdDate=2022-03-09 14:46:52, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=1.0531930000000000, preBalance=-5373.2276138400000000, postBalance=-5373.2276138400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677返还手续费1.0531930000000000, createdDate=2022-03-09 14:46:52, fromUserId=0, total=null), UserBillChain(userId=51905047, type=54, size=584.7449972766153846, preBalance=-5373.2276138400000000, postBalance=-4788.4826165633846154, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677穿仓回补584.7449972766153846, createdDate=2022-03-09 14:46:59, fromUserId=51905041, total=null), UserBillChain(userId=51905047, type=54, size=5262.7049754895384616, preBalance=-4788.4826165633846154, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677穿仓回补5262.7049754895384616, createdDate=2022-03-09 14:46:59, fromUserId=51904446, total=null), UserBillChain(userId=51905047, type=52, size=-10.5319319200000000, preBalance=474.2223589261538462, postBalance=474.2223589261538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4677, note=单号:4677平仓手续费-10.5319319200000000, createdDate=2022-03-09 14:46:59, fromUserId=0, total=null), UserBillChain(userId=51905047, type=3, size=-36.7902492753623188, preBalance=474.2223589261538462, postBalance=437.4321096507915274, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4678, note=单号:4678开仓保证金-36.7902492753623188, createdDate=2022-03-09 15:05:14, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.1015410000000000, preBalance=437.4321096507915274, postBalance=437.5336506507915274, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4678, note=单号:4678返还手续费0.1015410000000000, createdDate=2022-03-09 15:05:14, fromUserId=0, total=null), UserBillChain(userId=51905047, type=51, size=-1.0154108800000000, preBalance=437.5336506507915274, postBalance=436.5182397707915274, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4678, note=单号:4678开仓手续费-1.0154108800000000, createdDate=2022-03-09 15:05:19, fromUserId=0, total=null), UserBillChain(userId=51905047, type=55, size=-22.0000000000000000, preBalance=436.5182397707915274, postBalance=414.5182397707915274, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4678, note=单号:4678增加保证金-22.0000000000000000, createdDate=2022-03-09 15:05:24, fromUserId=0, total=null), UserBillChain(userId=51905047, type=4, size=11.2834492753623188, preBalance=414.5182397707915274, postBalance=424.8877928861538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4679, note=单号:4679平仓收益10.3695531153623188, createdDate=2022-03-09 15:06:27, fromUserId=0, total=null), UserBillChain(userId=51905047, type=41, size=0.1015440000000000, preBalance=424.8877928861538462, postBalance=424.8877928861538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4679, note=单号:4679返还手续费0.1015440000000000, createdDate=2022-03-09 15:06:27, fromUserId=0, total=null), UserBillChain(userId=51905047, type=52, size=-1.0154401600000000, preBalance=424.8877928861538462, postBalance=424.8877928861538462, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4679, note=单号:4679平仓手续费-1.0154401600000000, createdDate=2022-03-09 15:06:29, fromUserId=0, total=null)]
2022-03-09 15:09:36.881 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 15:09:36.881 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-405.2937661538461538
2022-03-09 15:09:36.881 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:1.0537630000000000
2022-03-09 15:09:36.881 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-10.5376379200000000
2022-03-09 15:09:36.881 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4676' LIMIT 0,1000 
2022-03-09 15:09:36.881 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:09:36.978 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 15:09:36.979 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:09:36.979 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:09:37.079 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:09:37.080 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 15:09:37.081 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 15:09:37.177 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:37.177 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4676,数据库:1.053763,计算:1.053763
2022-03-09 15:09:37.177 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:09:37.178 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:37.274 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:37.275 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:09:37.275 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:37.371 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:37.372 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:09:37.372 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:37.466 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:37.468 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:09:37.468 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:37.562 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:37.563 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 15:09:37.564 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:09:37.661 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:37.661 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4676,比列:0.300000,数据库:2.84516247,计算:2.845162
2022-03-09 15:09:37.662 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 15:09:37.663 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:09:37.757 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:37.758 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:51,订单:4676,比列:0.200000,数据库:1.89677498,计算:1.896774
2022-03-09 15:09:37.759 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 15:09:37.760 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:09:37.854 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:37.855 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:51,订单:4676,比列:0.400000,数据库:3.79354996,计算:3.793549
2022-03-09 15:09:37.855 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4676' and type=? limit 0,1 
2022-03-09 15:09:37.856 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 15:09:37.949 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:37.949 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:51,订单:4676,比列:0.100000,数据库:0.94838749,计算:0.948387
2022-03-09 15:09:37.950 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-111.0000000000000000
2022-03-09 15:09:37.950 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-5837.9712338461538462
2022-03-09 15:09:37.950 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4677' LIMIT 0,1000 
2022-03-09 15:09:37.950 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:09:38.044 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:09:38.045 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:09:38.045 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:09:38.143 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:09:38.145 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4677' 
2022-03-09 15:09:38.145 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 15:09:38.241 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 15:09:38.242 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4677' AND `margin_type` = 'FIXED' 
2022-03-09 15:09:38.243 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 15:09:38.337 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 15:09:38.338 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:09:38.339 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 15:09:38.436 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:38.437 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4677,比例:0.100000,数据库:635.42650000,计算得:635.426500
2022-03-09 15:09:38.437 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:09:38.438 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 15:09:38.535 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:38.536 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4677,数据库:5718.83850000,计算得:5718.838500
2022-03-09 15:09:38.536 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:1.0531930000000000
2022-03-09 15:09:38.536 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:584.7449972766153846
2022-03-09 15:09:38.536 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:09:38.537 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 38(Integer)
2022-03-09 15:09:38.634 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:38.634 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51905041,交易类型:54,订单:4677,数据库:-584.74499727,计算得:584.744997
2022-03-09 15:09:38.635 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:5262.7049754895384616
2022-03-09 15:09:38.635 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:09:38.635 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 15:09:38.741 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:38.742 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905047,合伙人:51904446,交易类型:54,订单:4677,数据库:-5262.70497548,计算得:5262.704975
2022-03-09 15:09:38.742 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-10.5319319200000000
2022-03-09 15:09:38.743 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4677' LIMIT 0,1000 
2022-03-09 15:09:38.743 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:09:38.839 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:09:38.840 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:09:38.841 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:09:38.943 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:09:38.944 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:09:38.944 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 15:09:39.046 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:39.047 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4677,数据库:1.053193,计算:1.053193
2022-03-09 15:09:39.047 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:09:39.047 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:39.143 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:39.144 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:09:39.144 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:39.243 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:39.244 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:09:39.244 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:39.345 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:39.346 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:09:39.346 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:39.440 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:39.441 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:09:39.442 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:09:39.546 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:39.547 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4677,比列:0.300000,数据库:2.84362167,计算:2.843621
2022-03-09 15:09:39.547 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:09:39.547 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:09:39.642 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:39.643 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4677,比列:0.200000,数据库:1.89574778,计算:1.895747
2022-03-09 15:09:39.644 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:09:39.644 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:09:39.738 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:39.739 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4677,比列:0.400000,数据库:3.79149556,计算:3.791495
2022-03-09 15:09:39.740 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4677' and type=? limit 0,1 
2022-03-09 15:09:39.740 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 15:09:39.838 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:39.838 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4677,比列:0.100000,数据库:0.94787389,计算:0.947873
2022-03-09 15:09:39.839 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-36.7902492753623188
2022-03-09 15:09:39.839 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.1015410000000000
2022-03-09 15:09:39.839 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-1.0154108800000000
2022-03-09 15:09:39.839 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4678' LIMIT 0,1000 
2022-03-09 15:09:39.840 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:09:39.936 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 2
2022-03-09 15:09:39.936 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:09:39.937 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:09:40.031 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:09:40.032 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4678' and type=? limit 0,1 
2022-03-09 15:09:40.033 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 15:09:40.141 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:40.142 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:51,订单:4678,数据库:0.101541,计算:0.101541
2022-03-09 15:09:40.142 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:09:40.142 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:40.236 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:40.237 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:09:40.237 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:40.332 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:40.332 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:09:40.332 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:40.428 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:40.428 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:09:40.429 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:40.522 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:40.523 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4678' and type=? limit 0,1 
2022-03-09 15:09:40.524 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:09:40.620 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:40.621 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:51,订单:4678,比列:0.300000,数据库:0.27416096,计算:0.274160
2022-03-09 15:09:40.621 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4678' and type=? limit 0,1 
2022-03-09 15:09:40.622 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:09:40.728 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:40.728 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:51,订单:4678,比列:0.200000,数据库:0.18277397,计算:0.182773
2022-03-09 15:09:40.729 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4678' and type=? limit 0,1 
2022-03-09 15:09:40.730 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:09:40.827 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:40.827 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:51,订单:4678,比列:0.400000,数据库:0.36554795,计算:0.365547
2022-03-09 15:09:40.828 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4678' and type=? limit 0,1 
2022-03-09 15:09:40.828 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 15:09:40.923 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:40.924 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:51,订单:4678,比列:0.100000,数据库:0.09138698,计算:0.091386
2022-03-09 15:09:40.924 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 逐仓保证金划入:-22.0000000000000000
2022-03-09 15:09:40.924 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:11.2834492753623188
2022-03-09 15:09:40.925 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4679' LIMIT 0,1000 
2022-03-09 15:09:40.925 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:09:41.020 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:09:41.021 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:09:41.021 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:09:41.116 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:09:41.117 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4679' 
2022-03-09 15:09:41.117 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 15:09:41.211 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 15:09:41.211 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905047' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4679' AND `margin_type` = 'FIXED' 
2022-03-09 15:09:41.211 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 15:09:41.305 [http-nio-10090-exec-9] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 15:09:41.306 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4679' and type=? limit 0,1 
2022-03-09 15:09:41.307 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 27(Integer)
2022-03-09 15:09:41.410 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:41.410 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51905041,交易类型:4,订单:4679,比例:0.100000,数据库:4.75068000,计算得:4.750680
2022-03-09 15:09:41.411 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4679' and type=? limit 0,1 
2022-03-09 15:09:41.411 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 15:09:41.506 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:41.507 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905047,默认合伙人:51904446,交易类型:4,订单:4679,数据库:42.75612000,计算得:42.756120
2022-03-09 15:09:41.507 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.1015440000000000
2022-03-09 15:09:41.507 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-1.0154401600000000
2022-03-09 15:09:41.507 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `order_id` = '4679' LIMIT 0,1000 
2022-03-09 15:09:41.507 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:09:41.601 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:09:41.602 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:09:41.602 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:09:41.696 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:09:41.697 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4679' and type=? limit 0,1 
2022-03-09 15:09:41.698 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905047(String), 41(Integer)
2022-03-09 15:09:41.792 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:41.793 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905047,交易类型:52,订单:4679,数据库:0.101544,计算:0.101544
2022-03-09 15:09:41.793 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:09:41.794 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:41.890 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:41.891 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:09:41.891 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:41.987 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:41.988 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:09:41.988 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:42.083 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:42.085 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:09:42.085 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:09:42.182 [http-nio-10090-exec-9] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:09:42.183 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4679' and type=? limit 0,1 
2022-03-09 15:09:42.184 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:09:42.279 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:42.279 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51904446,交易类型:52,订单:4679,比列:0.300000,数据库:0.27416884,计算:0.274168
2022-03-09 15:09:42.280 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4679' and type=? limit 0,1 
2022-03-09 15:09:42.280 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:09:42.378 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:42.379 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905052,交易类型:52,订单:4679,比列:0.200000,数据库:0.18277923,计算:0.182779
2022-03-09 15:09:42.380 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4679' and type=? limit 0,1 
2022-03-09 15:09:42.380 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:09:42.477 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:42.477 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905043,交易类型:52,订单:4679,比列:0.400000,数据库:0.36555846,计算:0.365558
2022-03-09 15:09:42.478 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4679' and type=? limit 0,1 
2022-03-09 15:09:42.478 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905041(String), 16(Integer)
2022-03-09 15:09:42.572 [http-nio-10090-exec-9] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:09:42.572 [http-nio-10090-exec-9] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户无返佣--手续费校验-->用户:51905047,合伙人:51905041,交易类型:52,订单:4679,比列:0.100000,数据库:0.09138961,计算:0.091389
2022-03-09 15:09:42.572 [http-nio-10090-exec-9] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905047流水--------
2022-03-09 15:36:15.241 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:36:15.243 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:36:15.338 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:36:15.338 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:36:15.338 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:36:15.426 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:36:15.427 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:36:15.427 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:36:15.514 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:36:15.515 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:36:15.515 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:36:15.604 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:36:15.605 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 15:36:15.605 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:36:15.693 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:36:15.694 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.SqlUtil - 用户:51905047,合伙人:[{"userId":"51905047","parentId":"51905041","gparentId":"0","partnerId":"51905041","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":}, {"userId":"51905041","parentId":"51905043","gparentId":"0","partnerId":"51905043","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.100000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.200000,"partnerTransferOutRatio":0.100000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 15:36:15.707 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:36:15.708 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:36:15.795 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:36:15.796 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:36:15.796 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:36:15.894 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:36:15.895 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905047' AND `liquidate_by` LIKE '%coerceClose%' LIMIT 0,1000 
2022-03-09 15:36:15.895 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:36:15.985 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:36:15.986 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:36:15.986 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:36:16.076 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:36:16.077 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905047' LIMIT 0,1 
2022-03-09 15:36:16.077 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:36:16.172 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:36:16.175 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905041' LIMIT 0,1 
2022-03-09 15:36:16.175 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:36:16.263 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:36:16.263 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 账户初始保证金:58.7902492753623188,盈亏金额:-47.506800,手续费:1.015440,返的手续费:0.101544,最后金额:10.3695532753623188
2022-03-09 15:40:12.036 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:40:12.038 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:40:12.125 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:40:12.125 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:40:12.126 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:40:12.220 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:40:12.264 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,账户user_balance:[UserBalanceChain(userId=51905043, currencyId=6, balance=100.0000000000000000, hold=0E-16)],user_partner_balance:[UserBalanceChain(userId=51905043, currencyId=6, balance=3139.9258647200000000, hold=0E-16)]
2022-03-09 15:41:58.215 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 15:41:58.216 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905043(String)
2022-03-09 15:41:58.306 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 15:41:58.307 [http-nio-10090-exec-8] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:41:58.307 [http-nio-10090-exec-8] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:41:58.394 [http-nio-10090-exec-8] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:41:58.394 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:0E-16,hold:0E-16
2022-03-09 15:41:58.394 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:100.0,操作后，账户变化金额:-100.0000000000000000,操作后，计算剩余的金额:0E-16,操作后，数据库存储的总金额:0E-16
2022-03-09 15:41:58.395 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:41:58.395 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:41:58.485 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:41:58.485 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:41:58.485 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:41:58.574 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:41:58.575 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 15:41:58.576 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:41:58.667 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:41:58.667 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.SqlUtil - 用户:51905043,合伙人:[{"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 15:41:58.668 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905043' and created_date>='' 
2022-03-09 15:41:58.668 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 15:41:58.766 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 9
2022-03-09 15:41:58.766 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,流水:[UserBillChain(userId=51905043, type=41, size=0.4959190000000000, preBalance=100.0000000000000000, postBalance=100.4959190000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4680, note=单号:4680返还手续费0.4959190000000000, createdDate=2022-03-09 15:40:28, fromUserId=0, total=null), UserBillChain(userId=51905043, type=51, size=-1.6530663600000000, preBalance=100.4959190000000000, postBalance=98.8428526400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4680, note=单号:4680开仓手续费-1.6530663600000000, createdDate=2022-03-09 15:40:30, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.5785736800000000, preBalance=3139.9258647200000000, postBalance=3140.5044384000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4680, note=手续费返佣：0.57857368,单号来源:4680,用户来源: 51905043, createdDate=2022-03-09 15:40:30, fromUserId=51905043, total=null), UserBillChain(userId=51905043, type=4, size=-113.0382000000000000, preBalance=98.8428526400000000, postBalance=-15.3513354400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4681, note=单号:4681平仓收益-114.1941880800000000, createdDate=2022-03-09 15:41:22, fromUserId=0, total=null), UserBillChain(userId=51905043, type=41, size=0.4954230000000000, preBalance=-15.3513354400000000, postBalance=-15.3513354400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4681, note=单号:4681返还手续费0.4954230000000000, createdDate=2022-03-09 15:41:22, fromUserId=0, total=null), UserBillChain(userId=51905043, type=52, size=-1.6514110800000000, preBalance=-15.3513354400000000, postBalance=-15.3513354400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4681, note=单号:4681平仓手续费-1.6514110800000000, createdDate=2022-03-09 15:41:30, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.5779940400000000, preBalance=3140.5044384000000000, postBalance=3141.0824324400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4681, note=手续费返佣：0.57799404,单号来源:4681,用户来源: 51905043, createdDate=2022-03-09 15:41:30, fromUserId=51905043, total=null), UserBillChain(userId=51905043, type=54, size=3.0702670880000000, preBalance=-15.3513354400000000, postBalance=-12.2810683520000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4681, note=单号:4681穿仓回补3.0702670880000000, createdDate=2022-03-09 15:41:30, fromUserId=51905052, total=null), UserBillChain(userId=51905043, type=54, size=12.2810683520000000, preBalance=-12.2810683520000000, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4681, note=单号:4681穿仓回补12.2810683520000000, createdDate=2022-03-09 15:41:30, fromUserId=51904446, total=null)]
2022-03-09 15:41:58.768 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 15:41:58.768 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.4959190000000000
2022-03-09 15:41:58.768 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-1.6530663600000000
2022-03-09 15:41:58.768 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4680' LIMIT 0,1000 
2022-03-09 15:41:58.769 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:41:58.860 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:41:58.861 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:41:58.862 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:41:58.952 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:41:58.954 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4680' and type=? limit 0,1 
2022-03-09 15:41:58.954 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 15:41:59.045 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:41:59.045 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:51,订单:4680,数据库:0.495919,计算:0.495919
2022-03-09 15:41:59.046 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:41:59.047 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:41:59.140 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:41:59.142 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:41:59.142 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:41:59.237 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:41:59.238 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4680' and type=? limit 0,1 
2022-03-09 15:41:59.238 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:41:59.331 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:41:59.332 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:51,订单:4680,比列:0.300000,数据库:0.34714420,计算:0.347143
2022-03-09 15:41:59.333 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4680' and type=? limit 0,1 
2022-03-09 15:41:59.333 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:41:59.423 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:41:59.424 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:51,订单:4680,比列:0.200000,数据库:0.23142947,计算:0.231429
2022-03-09 15:41:59.424 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4680' and type=? limit 0,1 
2022-03-09 15:41:59.425 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:41:59.516 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:41:59.516 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:51,订单:4680,比列:0.500000,数据库:0.57857368,计算:0.578573
2022-03-09 15:41:59.516 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.5785736800000000
2022-03-09 15:41:59.516 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3139.9258647200000000,分佣金额:0.5785736800000000,之后余额:3140.5044384000000000
2022-03-09 15:41:59.517 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-113.0382000000000000
2022-03-09 15:41:59.517 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4681' LIMIT 0,1000 
2022-03-09 15:41:59.518 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:41:59.613 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:41:59.614 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:41:59.615 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:41:59.705 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:41:59.706 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4681' 
2022-03-09 15:41:59.707 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 15:41:59.795 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 15:41:59.796 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4681' and type=? limit 0,1 
2022-03-09 15:41:59.797 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 27(Integer)
2022-03-09 15:41:59.886 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:41:59.886 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51905052,交易类型:4,订单:4681,比例:0.200000,数据库:22.60764000,计算得:22.607640
2022-03-09 15:41:59.887 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4681' and type=? limit 0,1 
2022-03-09 15:41:59.887 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 15:41:59.977 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:41:59.977 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51904446,交易类型:4,订单:4681,数据库:90.43056000,计算得:90.430560
2022-03-09 15:41:59.977 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.4954230000000000
2022-03-09 15:41:59.978 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-1.6514110800000000
2022-03-09 15:41:59.979 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4681' LIMIT 0,1000 
2022-03-09 15:41:59.979 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:42:00.068 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:42:00.069 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:42:00.069 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:42:00.158 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:42:00.159 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4681' and type=? limit 0,1 
2022-03-09 15:42:00.160 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 15:42:00.250 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:00.250 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:52,订单:4681,数据库:0.495423,计算:0.495423
2022-03-09 15:42:00.251 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:42:00.251 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:00.341 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:00.342 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:42:00.342 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:00.431 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:00.432 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4681' and type=? limit 0,1 
2022-03-09 15:42:00.432 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:42:00.521 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:00.522 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:52,订单:4681,比列:0.300000,数据库:0.34679642,计算:0.346796
2022-03-09 15:42:00.523 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4681' and type=? limit 0,1 
2022-03-09 15:42:00.524 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:42:00.614 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:00.614 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:52,订单:4681,比列:0.200000,数据库:0.23119761,计算:0.231197
2022-03-09 15:42:00.615 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4681' and type=? limit 0,1 
2022-03-09 15:42:00.616 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:42:00.720 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:00.721 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:52,订单:4681,比列:0.500000,数据库:0.57799404,计算:0.577993
2022-03-09 15:42:00.721 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.5779940400000000
2022-03-09 15:42:00.721 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3140.5044384000000000,分佣金额:0.5779940400000000,之后余额:3141.0824324400000000
2022-03-09 15:42:00.721 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:3.0702670880000000
2022-03-09 15:42:00.722 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4681' and type=? limit 0,1 
2022-03-09 15:42:00.723 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 38(Integer)
2022-03-09 15:42:00.819 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:00.820 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905043,合伙人:51905052,交易类型:54,订单:4681,数据库:-3.07026708,计算得:3.070267
2022-03-09 15:42:00.820 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:12.2810683520000000
2022-03-09 15:42:00.821 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4681' and type=? limit 0,1 
2022-03-09 15:42:00.821 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 15:42:00.913 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:00.914 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905043,合伙人:51904446,交易类型:54,订单:4681,数据库:-12.28106835,计算得:12.281068
2022-03-09 15:42:00.914 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 15:42:43.981 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 15:42:43.981 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905043(String)
2022-03-09 15:42:44.074 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 15:42:44.075 [http-nio-10090-exec-10] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:42:44.076 [http-nio-10090-exec-10] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:44.167 [http-nio-10090-exec-10] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:44.167 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:0E-16,hold:0E-16
2022-03-09 15:42:44.167 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:100.0,操作后，账户变化金额:-100.0000000000000000,操作后，计算剩余的金额:0E-16,操作后，数据库存储的总金额:0E-16
2022-03-09 15:42:44.168 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:42:44.168 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:42:44.258 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:42:44.258 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:42:44.259 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:42:44.346 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:42:44.347 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 15:42:44.347 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:42:44.436 [http-nio-10090-exec-10] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:42:44.436 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.SqlUtil - 用户:51905043,合伙人:[{"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 15:42:44.437 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905043' and created_date>='' 
2022-03-09 15:42:44.438 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 15:42:44.527 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 9
2022-03-09 15:42:44.527 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,流水:[UserBillChain(userId=51905043, type=41, size=0.4954420000000000, preBalance=100.0000000000000000, postBalance=100.4954420000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4682, note=单号:4682返还手续费0.4954420000000000, createdDate=2022-03-09 15:42:24, fromUserId=0, total=null), UserBillChain(userId=51905043, type=51, size=-1.6514744400000000, preBalance=100.4954420000000000, postBalance=98.8439675600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4682, note=单号:4682开仓手续费-1.6514744400000000, createdDate=2022-03-09 15:42:30, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.5780162200000000, preBalance=3141.0824324400000000, postBalance=3141.6604486600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4682, note=手续费返佣：0.57801622,单号来源:4682,用户来源: 51905043, createdDate=2022-03-09 15:42:30, fromUserId=51905043, total=null), UserBillChain(userId=51905043, type=4, size=-99.9801000000000000, preBalance=98.8439675600000000, postBalance=-2.2918908400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4683, note=单号:4683平仓收益-101.1358584000000000, createdDate=2022-03-09 15:42:37, fromUserId=0, total=null), UserBillChain(userId=51905043, type=41, size=0.4953240000000000, preBalance=-2.2918908400000000, postBalance=-2.2918908400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4683, note=单号:4683返还手续费0.4953240000000000, createdDate=2022-03-09 15:42:37, fromUserId=0, total=null), UserBillChain(userId=51905043, type=52, size=-1.6510824000000000, preBalance=-2.2918908400000000, postBalance=-2.2918908400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4683, note=单号:4683平仓手续费-1.6510824000000000, createdDate=2022-03-09 15:42:40, fromUserId=0, total=null), UserBillChain(userId=51905043, type=54, size=0.4583781680000000, preBalance=-2.2918908400000000, postBalance=-1.8335126720000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4683, note=单号:4683穿仓回补0.4583781680000000, createdDate=2022-03-09 15:42:40, fromUserId=51905052, total=null), UserBillChain(userId=51905043, type=54, size=1.8335126720000000, preBalance=-1.8335126720000000, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4683, note=单号:4683穿仓回补1.8335126720000000, createdDate=2022-03-09 15:42:40, fromUserId=51904446, total=null), UserBillChain(userId=51905043, type=16, size=0.5778792000000000, preBalance=3141.6604486600000000, postBalance=3142.2383278600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4683, note=手续费返佣：0.5778792,单号来源:4683,用户来源: 51905043, createdDate=2022-03-09 15:42:40, fromUserId=51905043, total=null)]
2022-03-09 15:42:44.528 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 15:42:44.528 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.4954420000000000
2022-03-09 15:42:44.528 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-1.6514744400000000
2022-03-09 15:42:44.528 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4682' LIMIT 0,1000 
2022-03-09 15:42:44.529 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:42:44.632 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:42:44.633 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:42:44.633 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:42:44.722 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:42:44.723 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4682' and type=? limit 0,1 
2022-03-09 15:42:44.724 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 15:42:44.812 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:44.812 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:51,订单:4682,数据库:0.495442,计算:0.495442
2022-03-09 15:42:44.812 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:42:44.813 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:44.901 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:44.902 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:42:44.903 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:44.991 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:44.992 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4682' and type=? limit 0,1 
2022-03-09 15:42:44.992 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:42:45.080 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:45.080 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:51,订单:4682,比列:0.300000,数据库:0.34680973,计算:0.346809
2022-03-09 15:42:45.082 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4682' and type=? limit 0,1 
2022-03-09 15:42:45.082 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:42:45.170 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:45.170 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:51,订单:4682,比列:0.200000,数据库:0.23120648,计算:0.231206
2022-03-09 15:42:45.171 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4682' and type=? limit 0,1 
2022-03-09 15:42:45.171 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:42:45.259 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:45.259 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:51,订单:4682,比列:0.500000,数据库:0.57801622,计算:0.578016
2022-03-09 15:42:45.259 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.5780162200000000
2022-03-09 15:42:45.259 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3141.0824324400000000,分佣金额:0.5780162200000000,之后余额:3141.6604486600000000
2022-03-09 15:42:45.260 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-99.9801000000000000
2022-03-09 15:42:45.260 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4683' LIMIT 0,1000 
2022-03-09 15:42:45.260 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:42:45.348 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:42:45.349 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:42:45.349 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:42:45.437 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:42:45.438 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4683' 
2022-03-09 15:42:45.438 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 15:42:45.526 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 15:42:45.527 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:45.527 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 27(Integer)
2022-03-09 15:42:45.623 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:45.623 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51905052,交易类型:4,订单:4683,比例:0.200000,数据库:19.99602000,计算得:19.996020
2022-03-09 15:42:45.624 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:45.624 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 15:42:45.716 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:45.716 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51904446,交易类型:4,订单:4683,数据库:79.98408000,计算得:79.984080
2022-03-09 15:42:45.716 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.4953240000000000
2022-03-09 15:42:45.716 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-1.6510824000000000
2022-03-09 15:42:45.717 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4683' LIMIT 0,1000 
2022-03-09 15:42:45.717 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:42:45.806 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:42:45.807 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:42:45.807 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:42:45.898 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:42:45.900 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:45.900 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 15:42:45.988 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:45.989 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:52,订单:4683,数据库:0.495324,计算:0.495324
2022-03-09 15:42:45.990 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:42:45.991 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:46.084 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:46.085 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:42:46.086 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:46.174 [http-nio-10090-exec-10] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:46.175 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:46.176 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:42:46.267 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:46.267 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:52,订单:4683,比列:0.300000,数据库:0.34672752,计算:0.346727
2022-03-09 15:42:46.268 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:46.268 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:42:46.357 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:46.357 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:52,订单:4683,比列:0.200000,数据库:0.23115168,计算:0.231151
2022-03-09 15:42:46.358 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:46.359 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:42:46.447 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:46.448 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:52,订单:4683,比列:0.500000,数据库:0.57787920,计算:0.577878
2022-03-09 15:42:46.448 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:0.4583781680000000
2022-03-09 15:42:46.449 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:46.449 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 38(Integer)
2022-03-09 15:42:46.541 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:46.542 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905043,合伙人:51905052,交易类型:54,订单:4683,数据库:-0.45837816,计算得:0.458378
2022-03-09 15:42:46.542 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:1.8335126720000000
2022-03-09 15:42:46.543 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:46.543 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 15:42:46.633 [http-nio-10090-exec-10] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:46.633 [http-nio-10090-exec-10] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905043,合伙人:51904446,交易类型:54,订单:4683,数据库:-1.83351267,计算得:1.833512
2022-03-09 15:42:46.633 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.5778792000000000
2022-03-09 15:42:46.633 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3141.6604486600000000,分佣金额:0.5778792000000000,之后余额:3142.2383278600000000
2022-03-09 15:42:46.633 [http-nio-10090-exec-10] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 15:42:49.500 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 15:42:49.500 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905043(String)
2022-03-09 15:42:49.588 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 15:42:49.589 [http-nio-10090-exec-2] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:42:49.589 [http-nio-10090-exec-2] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:49.679 [http-nio-10090-exec-2] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:49.679 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:0E-16,hold:0E-16
2022-03-09 15:42:49.680 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:100.0,操作后，账户变化金额:-100.0000000000000000,操作后，计算剩余的金额:0E-16,操作后，数据库存储的总金额:0E-16
2022-03-09 15:42:49.680 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:42:49.681 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:42:49.769 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:42:49.770 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:42:49.771 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:42:49.858 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:42:49.859 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 15:42:49.859 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:42:49.947 [http-nio-10090-exec-2] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:42:49.947 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.SqlUtil - 用户:51905043,合伙人:[{"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 15:42:49.947 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905043' and created_date>='' 
2022-03-09 15:42:49.948 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 15:42:50.037 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 9
2022-03-09 15:42:50.038 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,流水:[UserBillChain(userId=51905043, type=41, size=0.4954420000000000, preBalance=100.0000000000000000, postBalance=100.4954420000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4682, note=单号:4682返还手续费0.4954420000000000, createdDate=2022-03-09 15:42:24, fromUserId=0, total=null), UserBillChain(userId=51905043, type=51, size=-1.6514744400000000, preBalance=100.4954420000000000, postBalance=98.8439675600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4682, note=单号:4682开仓手续费-1.6514744400000000, createdDate=2022-03-09 15:42:30, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.5780162200000000, preBalance=3141.0824324400000000, postBalance=3141.6604486600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4682, note=手续费返佣：0.57801622,单号来源:4682,用户来源: 51905043, createdDate=2022-03-09 15:42:30, fromUserId=51905043, total=null), UserBillChain(userId=51905043, type=4, size=-99.9801000000000000, preBalance=98.8439675600000000, postBalance=-2.2918908400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4683, note=单号:4683平仓收益-101.1358584000000000, createdDate=2022-03-09 15:42:37, fromUserId=0, total=null), UserBillChain(userId=51905043, type=41, size=0.4953240000000000, preBalance=-2.2918908400000000, postBalance=-2.2918908400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4683, note=单号:4683返还手续费0.4953240000000000, createdDate=2022-03-09 15:42:37, fromUserId=0, total=null), UserBillChain(userId=51905043, type=52, size=-1.6510824000000000, preBalance=-2.2918908400000000, postBalance=-2.2918908400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4683, note=单号:4683平仓手续费-1.6510824000000000, createdDate=2022-03-09 15:42:40, fromUserId=0, total=null), UserBillChain(userId=51905043, type=54, size=0.4583781680000000, preBalance=-2.2918908400000000, postBalance=-1.8335126720000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4683, note=单号:4683穿仓回补0.4583781680000000, createdDate=2022-03-09 15:42:40, fromUserId=51905052, total=null), UserBillChain(userId=51905043, type=54, size=1.8335126720000000, preBalance=-1.8335126720000000, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4683, note=单号:4683穿仓回补1.8335126720000000, createdDate=2022-03-09 15:42:40, fromUserId=51904446, total=null), UserBillChain(userId=51905043, type=16, size=0.5778792000000000, preBalance=3141.6604486600000000, postBalance=3142.2383278600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4683, note=手续费返佣：0.5778792,单号来源:4683,用户来源: 51905043, createdDate=2022-03-09 15:42:40, fromUserId=51905043, total=null)]
2022-03-09 15:42:50.038 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 15:42:50.038 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.4954420000000000
2022-03-09 15:42:50.038 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-1.6514744400000000
2022-03-09 15:42:50.039 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4682' LIMIT 0,1000 
2022-03-09 15:42:50.039 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:42:50.138 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:42:50.139 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:42:50.139 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:42:50.234 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:42:50.236 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4682' and type=? limit 0,1 
2022-03-09 15:42:50.236 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 15:42:50.334 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:50.335 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:51,订单:4682,数据库:0.495442,计算:0.495442
2022-03-09 15:42:50.335 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:42:50.336 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:50.426 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:50.427 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:42:50.427 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:50.515 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:50.516 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4682' and type=? limit 0,1 
2022-03-09 15:42:50.516 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:42:50.606 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:50.607 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:51,订单:4682,比列:0.300000,数据库:0.34680973,计算:0.346809
2022-03-09 15:42:50.607 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4682' and type=? limit 0,1 
2022-03-09 15:42:50.608 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:42:50.702 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:50.702 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:51,订单:4682,比列:0.200000,数据库:0.23120648,计算:0.231206
2022-03-09 15:42:50.702 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4682' and type=? limit 0,1 
2022-03-09 15:42:50.702 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:42:50.793 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:50.793 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:51,订单:4682,比列:0.500000,数据库:0.57801622,计算:0.578016
2022-03-09 15:42:50.793 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.5780162200000000
2022-03-09 15:42:50.793 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3141.0824324400000000,分佣金额:0.5780162200000000,之后余额:3141.6604486600000000
2022-03-09 15:42:50.793 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-99.9801000000000000
2022-03-09 15:42:50.794 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4683' LIMIT 0,1000 
2022-03-09 15:42:50.794 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:42:50.883 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:42:50.884 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:42:50.884 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:42:50.972 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:42:50.973 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4683' 
2022-03-09 15:42:50.974 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 15:42:51.061 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 15:42:51.062 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:51.062 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 27(Integer)
2022-03-09 15:42:51.150 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:51.151 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51905052,交易类型:4,订单:4683,比例:0.200000,数据库:19.99602000,计算得:19.996020
2022-03-09 15:42:51.151 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:51.151 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 15:42:51.268 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:51.268 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51904446,交易类型:4,订单:4683,数据库:79.98408000,计算得:79.984080
2022-03-09 15:42:51.268 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.4953240000000000
2022-03-09 15:42:51.268 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-1.6510824000000000
2022-03-09 15:42:51.269 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4683' LIMIT 0,1000 
2022-03-09 15:42:51.269 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:42:51.358 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:42:51.359 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:42:51.359 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:42:51.457 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:42:51.458 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:51.459 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 15:42:51.548 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:51.548 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:52,订单:4683,数据库:0.495324,计算:0.495324
2022-03-09 15:42:51.549 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:42:51.549 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:51.639 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:51.640 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:42:51.640 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:42:51.730 [http-nio-10090-exec-2] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:42:51.731 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:51.731 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:42:51.819 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:51.820 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:52,订单:4683,比列:0.300000,数据库:0.34672752,计算:0.346727
2022-03-09 15:42:51.821 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:51.821 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:42:51.909 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:51.910 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:52,订单:4683,比列:0.200000,数据库:0.23115168,计算:0.231151
2022-03-09 15:42:51.910 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:51.911 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:42:51.999 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:51.999 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:52,订单:4683,比列:0.500000,数据库:0.57787920,计算:0.577878
2022-03-09 15:42:51.999 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:0.4583781680000000
2022-03-09 15:42:52.000 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:52.000 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 38(Integer)
2022-03-09 15:42:52.095 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:52.095 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905043,合伙人:51905052,交易类型:54,订单:4683,数据库:-0.45837816,计算得:0.458378
2022-03-09 15:42:52.096 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 穿仓回补（给用户加钱到0）给用户:1.8335126720000000
2022-03-09 15:42:52.096 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4683' and type=? limit 0,1 
2022-03-09 15:42:52.096 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 38(Integer)
2022-03-09 15:42:52.185 [http-nio-10090-exec-2] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:42:52.186 [http-nio-10090-exec-2] INFO  com.zmj.demo.common.dev1.ThroughPositionsCalc - partnerBack--合伙人--穿仓回退--->用户:51905043,合伙人:51904446,交易类型:54,订单:4683,数据库:-1.83351267,计算得:1.833512
2022-03-09 15:42:52.186 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.5778792000000000
2022-03-09 15:42:52.186 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3141.6604486600000000,分佣金额:0.5778792000000000,之后余额:3142.2383278600000000
2022-03-09 15:42:52.186 [http-nio-10090-exec-2] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 15:44:39.363 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 15:44:39.365 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905043(String)
2022-03-09 15:44:39.455 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 15:44:39.455 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:44:39.456 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:44:39.543 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:44:39.543 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:0E-16,hold:0E-16
2022-03-09 15:44:39.543 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:100.0,操作后，账户变化金额:-99.5989686000000000,操作后，计算剩余的金额:0.4010314000000000,操作后，数据库存储的总金额:0E-16
2022-03-09 15:44:39.544 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:44:39.544 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:44:39.631 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:44:39.632 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:44:39.632 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:44:39.721 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:44:39.722 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 15:44:39.722 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:44:39.809 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:44:39.810 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.SqlUtil - 用户:51905043,合伙人:[{"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 15:44:39.810 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905043' and created_date>='' 
2022-03-09 15:44:39.810 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 15:44:39.906 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 8
2022-03-09 15:44:39.907 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,流水:[UserBillChain(userId=51905043, type=41, size=0.4952540000000000, preBalance=100.0000000000000000, postBalance=100.4952540000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4685, note=单号:4685返还手续费0.4952540000000000, createdDate=2022-03-09 15:43:01, fromUserId=0, total=null), UserBillChain(userId=51905043, type=51, size=-1.6508487600000000, preBalance=100.4952540000000000, postBalance=98.8444052400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4685, note=单号:4685开仓手续费-1.6508487600000000, createdDate=2022-03-09 15:43:10, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.5777973800000000, preBalance=3142.2383278600000000, postBalance=3142.8161252400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4685, note=手续费返佣：0.57779738,单号来源:4685,用户来源: 51905043, createdDate=2022-03-09 15:43:10, fromUserId=51905043, total=null), UserBillChain(userId=51905043, type=4, size=-97.2873000000000000, preBalance=98.8444052400000000, postBalance=0.4010314000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4686, note=单号:4686平仓收益-98.4433738400000000, createdDate=2022-03-09 15:43:44, fromUserId=0, total=null), UserBillChain(userId=51905043, type=27, size=-0.4010314000000000, preBalance=0.4010314000000000, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=0, parentId=0, sourceId=4686, note=订单:4686爆仓剩余返还给默认合伙人,amount:-0.4010314000000000, createdDate=2022-03-09 15:43:44, fromUserId=0, total=null), UserBillChain(userId=51905043, type=41, size=0.4954600000000000, preBalance=0E-16, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4686, note=单号:4686返还手续费0.4954600000000000, createdDate=2022-03-09 15:43:44, fromUserId=0, total=null), UserBillChain(userId=51905043, type=52, size=-1.6515338400000000, preBalance=0E-16, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4686, note=单号:4686平仓手续费-1.6515338400000000, createdDate=2022-03-09 15:43:50, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.5780369200000000, preBalance=3142.8161252400000000, postBalance=3143.3941621600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4686, note=手续费返佣：0.57803692,单号来源:4686,用户来源: 51905043, createdDate=2022-03-09 15:43:50, fromUserId=51905043, total=null)]
2022-03-09 15:44:39.908 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 15:44:39.908 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.4952540000000000
2022-03-09 15:44:39.908 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-1.6508487600000000
2022-03-09 15:44:39.908 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4685' LIMIT 0,1000 
2022-03-09 15:44:39.909 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:44:39.998 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:44:39.999 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:44:39.999 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:44:40.086 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:44:40.087 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4685' and type=? limit 0,1 
2022-03-09 15:44:40.087 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 15:44:40.175 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:44:40.176 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:51,订单:4685,数据库:0.495254,计算:0.495254
2022-03-09 15:44:40.176 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:44:40.176 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:44:40.263 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:44:40.265 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:44:40.265 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:44:40.352 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:44:40.353 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4685' and type=? limit 0,1 
2022-03-09 15:44:40.353 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:44:40.441 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:44:40.442 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:51,订单:4685,比列:0.300000,数据库:0.34667842,计算:0.346678
2022-03-09 15:44:40.442 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4685' and type=? limit 0,1 
2022-03-09 15:44:40.443 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:44:40.531 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:44:40.531 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:51,订单:4685,比列:0.200000,数据库:0.23111895,计算:0.231118
2022-03-09 15:44:40.532 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4685' and type=? limit 0,1 
2022-03-09 15:44:40.532 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:44:40.623 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:44:40.624 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:51,订单:4685,比列:0.500000,数据库:0.57779738,计算:0.577797
2022-03-09 15:44:40.624 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.5777973800000000
2022-03-09 15:44:40.624 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3142.2383278600000000,分佣金额:0.5777973800000000,之后余额:3142.8161252400000000
2022-03-09 15:44:40.624 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-97.2873000000000000
2022-03-09 15:44:40.625 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4686' LIMIT 0,1000 
2022-03-09 15:44:40.625 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:44:40.717 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:44:40.718 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:44:40.718 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:44:40.808 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:44:40.808 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4686' 
2022-03-09 15:44:40.808 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 15:44:40.897 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 15:44:40.905 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:44:40.907 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 27(Integer)
2022-03-09 15:44:40.998 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:44:40.999 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51905052,交易类型:4,订单:4686,比例:0.200000,数据库:19.45746000,计算得:19.457460
2022-03-09 15:44:41.000 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:44:41.001 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 15:44:41.089 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:44:41.090 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51904446,交易类型:4,订单:4686,数据库:0.40103140,计算得:77.829840
2022-03-09 15:44:41.091 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 和用户对赌收益(头寸分佣) 区分普通和默认:-0.4010314000000000
2022-03-09 15:44:41.091 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.4954600000000000
2022-03-09 15:44:41.092 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-1.6515338400000000
2022-03-09 15:44:41.092 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4686' LIMIT 0,1000 
2022-03-09 15:44:41.093 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:44:41.181 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:44:41.181 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:44:41.181 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:44:41.269 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:44:41.270 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:44:41.271 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 15:44:41.359 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:44:41.359 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:52,订单:4686,数据库:0.495460,计算:0.495460
2022-03-09 15:44:41.360 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:44:41.360 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:44:41.448 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:44:41.448 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:44:41.448 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:44:41.537 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:44:41.537 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:44:41.538 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:44:41.629 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:44:41.630 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:52,订单:4686,比列:0.300000,数据库:0.34682215,计算:0.346821
2022-03-09 15:44:41.631 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:44:41.631 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:44:41.721 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:44:41.721 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:52,订单:4686,比列:0.200000,数据库:0.23121476,计算:0.231214
2022-03-09 15:44:41.722 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:44:41.723 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:44:41.824 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:44:41.825 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:52,订单:4686,比列:0.500000,数据库:0.57803692,计算:0.578036
2022-03-09 15:44:41.825 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.5780369200000000
2022-03-09 15:44:41.825 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3142.8161252400000000,分佣金额:0.5780369200000000,之后余额:3143.3941621600000000
2022-03-09 15:44:41.825 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 15:51:31.325 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 15:51:31.326 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905043(String)
2022-03-09 15:51:31.426 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 15:51:31.426 [http-nio-10090-exec-8] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:51:31.427 [http-nio-10090-exec-8] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:51:31.515 [http-nio-10090-exec-8] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:51:31.515 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:0E-16,hold:0E-16
2022-03-09 15:51:31.515 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:100.0,操作后，账户变化金额:-99.5989686000000000,操作后，计算剩余的金额:0.4010314000000000,操作后，数据库存储的总金额:0E-16
2022-03-09 15:51:31.515 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:51:31.516 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:51:31.603 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:51:31.603 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:51:31.604 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:51:31.692 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:51:31.693 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 15:51:31.693 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 15:51:31.782 [http-nio-10090-exec-8] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 15:51:31.782 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.SqlUtil - 用户:51905043,合伙人:[{"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 15:51:31.783 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905043' and created_date>='' 
2022-03-09 15:51:31.783 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 15:51:31.873 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 8
2022-03-09 15:51:31.874 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,流水:[UserBillChain(userId=51905043, type=41, size=0.4952540000000000, preBalance=100.0000000000000000, postBalance=100.4952540000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4685, note=单号:4685返还手续费0.4952540000000000, createdDate=2022-03-09 15:43:01, fromUserId=0, total=null), UserBillChain(userId=51905043, type=51, size=-1.6508487600000000, preBalance=100.4952540000000000, postBalance=98.8444052400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4685, note=单号:4685开仓手续费-1.6508487600000000, createdDate=2022-03-09 15:43:10, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.5777973800000000, preBalance=3142.2383278600000000, postBalance=3142.8161252400000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4685, note=手续费返佣：0.57779738,单号来源:4685,用户来源: 51905043, createdDate=2022-03-09 15:43:10, fromUserId=51905043, total=null), UserBillChain(userId=51905043, type=4, size=-97.2873000000000000, preBalance=98.8444052400000000, postBalance=0.4010314000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4686, note=单号:4686平仓收益-98.4433738400000000, createdDate=2022-03-09 15:43:44, fromUserId=0, total=null), UserBillChain(userId=51905043, type=27, size=-0.4010314000000000, preBalance=0.4010314000000000, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=0, parentId=0, sourceId=4686, note=订单:4686爆仓剩余返还给默认合伙人,amount:-0.4010314000000000, createdDate=2022-03-09 15:43:44, fromUserId=0, total=null), UserBillChain(userId=51905043, type=41, size=0.4954600000000000, preBalance=0E-16, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4686, note=单号:4686返还手续费0.4954600000000000, createdDate=2022-03-09 15:43:44, fromUserId=0, total=null), UserBillChain(userId=51905043, type=52, size=-1.6515338400000000, preBalance=0E-16, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4686, note=单号:4686平仓手续费-1.6515338400000000, createdDate=2022-03-09 15:43:50, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.5780369200000000, preBalance=3142.8161252400000000, postBalance=3143.3941621600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4686, note=手续费返佣：0.57803692,单号来源:4686,用户来源: 51905043, createdDate=2022-03-09 15:43:50, fromUserId=51905043, total=null)]
2022-03-09 15:51:31.875 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 15:51:31.875 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.4952540000000000
2022-03-09 15:51:31.875 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-1.6508487600000000
2022-03-09 15:51:31.876 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4685' LIMIT 0,1000 
2022-03-09 15:51:31.876 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:51:31.981 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:51:31.982 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:51:31.983 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:51:32.075 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:51:32.077 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4685' and type=? limit 0,1 
2022-03-09 15:51:32.078 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 15:51:32.169 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:51:32.170 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:51,订单:4685,数据库:0.495254,计算:0.495254
2022-03-09 15:51:32.170 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:51:32.171 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:51:32.260 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:51:32.261 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:51:32.262 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:51:32.351 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:51:32.351 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4685' and type=? limit 0,1 
2022-03-09 15:51:32.351 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:51:32.442 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:51:32.443 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:51,订单:4685,比列:0.300000,数据库:0.34667842,计算:0.346678
2022-03-09 15:51:32.444 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4685' and type=? limit 0,1 
2022-03-09 15:51:32.444 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:51:32.535 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:51:32.535 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:51,订单:4685,比列:0.200000,数据库:0.23111895,计算:0.231118
2022-03-09 15:51:32.536 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4685' and type=? limit 0,1 
2022-03-09 15:51:32.536 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:51:32.914 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:51:32.915 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:51,订单:4685,比列:0.500000,数据库:0.57779738,计算:0.577797
2022-03-09 15:51:32.915 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.5777973800000000
2022-03-09 15:51:32.915 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3142.2383278600000000,分佣金额:0.5777973800000000,之后余额:3142.8161252400000000
2022-03-09 15:51:32.915 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-97.2873000000000000
2022-03-09 15:51:32.916 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4686' LIMIT 0,1000 
2022-03-09 15:51:32.916 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:51:33.009 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:51:33.010 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:51:33.011 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:51:33.103 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:51:33.104 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4686' 
2022-03-09 15:51:33.105 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 15:51:33.194 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 15:51:33.196 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:51:33.196 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 27(Integer)
2022-03-09 15:51:33.285 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:51:33.285 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51905052,交易类型:4,订单:4686,比例:0.200000,数据库:19.45746000,计算得:19.457460
2022-03-09 15:51:33.286 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:51:33.286 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 15:51:33.380 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:51:33.381 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51904446,交易类型:4,订单:4686,数据库:0.40103140,计算得:77.829840
2022-03-09 15:51:33.381 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 和用户对赌收益(头寸分佣) 区分普通和默认:-0.4010314000000000
2022-03-09 15:51:33.381 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.4954600000000000
2022-03-09 15:51:33.381 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-1.6515338400000000
2022-03-09 15:51:33.382 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4686' LIMIT 0,1000 
2022-03-09 15:51:33.382 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 15:51:33.474 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 15:51:33.475 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 15:51:33.475 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 15:51:33.562 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 15:51:33.563 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:51:33.564 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 15:51:33.652 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:51:33.652 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:52,订单:4686,数据库:0.495460,计算:0.495460
2022-03-09 15:51:33.652 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 15:51:33.653 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:51:33.742 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:51:33.743 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 15:51:33.743 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 15:51:33.831 [http-nio-10090-exec-8] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 15:51:33.832 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:51:33.833 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 15:51:33.922 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:51:33.922 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:52,订单:4686,比列:0.300000,数据库:0.34682215,计算:0.346821
2022-03-09 15:51:33.923 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:51:33.923 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 15:51:34.013 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:51:34.014 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:52,订单:4686,比列:0.200000,数据库:0.23121476,计算:0.231214
2022-03-09 15:51:34.015 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4686' and type=? limit 0,1 
2022-03-09 15:51:34.016 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 15:51:34.105 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 15:51:34.106 [http-nio-10090-exec-8] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:52,订单:4686,比列:0.500000,数据库:0.57803692,计算:0.578036
2022-03-09 15:51:34.106 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.5780369200000000
2022-03-09 15:51:34.106 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3142.8161252400000000,分佣金额:0.5780369200000000,之后余额:3143.3941621600000000
2022-03-09 15:51:34.107 [http-nio-10090-exec-8] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 15:56:11.641 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2m16s630ms).
2022-03-09 16:14:46.101 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:14:46.102 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:14:46.185 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:14:46.185 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:14:46.186 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:14:46.267 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:14:46.292 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,账户user_balance:[UserBalanceChain(userId=51905043, currencyId=6, balance=100.0000000000000000, hold=0E-16)],user_partner_balance:[UserBalanceChain(userId=51905043, currencyId=6, balance=3143.3941621600000000, hold=0E-16)]
2022-03-09 16:14:53.500 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 16:14:53.500 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905043(String)
2022-03-09 16:14:53.583 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 16:14:53.583 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:14:53.584 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:14:53.665 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:14:53.665 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:100.0000000000000000,hold:0E-16
2022-03-09 16:14:53.665 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:100.0,操作后，账户变化金额:0,操作后，计算剩余的金额:100.0,操作后，数据库存储的总金额:100.0000000000000000
2022-03-09 16:14:53.665 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:14:53.666 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 16:14:53.746 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 16:14:53.746 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 16:14:53.746 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 16:14:53.828 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 16:14:53.828 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 16:14:53.828 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 16:14:53.918 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 16:14:53.919 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.SqlUtil - 用户:51905043,合伙人:[{"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 16:14:53.920 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905043' and created_date>='' 
2022-03-09 16:14:53.920 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 16:14:54.009 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 0
2022-03-09 16:14:54.009 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,流水:[]
2022-03-09 16:15:15.967 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 16:15:15.968 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905043(String)
2022-03-09 16:15:16.052 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 16:15:16.053 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:15:16.053 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:15:16.134 [http-nio-10090-exec-5] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:15:16.134 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:95.5348043000000000,hold:0E-16
2022-03-09 16:15:16.135 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:100.0,操作后，账户变化金额:-4.4651957000000000,操作后，计算剩余的金额:95.5348043000000000,操作后，数据库存储的总金额:95.5348043000000000
2022-03-09 16:15:16.135 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:15:16.135 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 16:15:16.219 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 16:15:16.219 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 16:15:16.220 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 16:15:16.305 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 16:15:16.305 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 16:15:16.306 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 16:15:16.388 [http-nio-10090-exec-5] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 16:15:16.388 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.SqlUtil - 用户:51905043,合伙人:[{"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 16:15:16.389 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905043' and created_date>='' 
2022-03-09 16:15:16.389 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 16:15:16.473 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 4
2022-03-09 16:15:16.473 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,流水:[UserBillChain(userId=51905043, type=3, size=-4.3483125000000000, preBalance=100.0000000000000000, postBalance=95.6516875000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4690, note=单号:4690开仓保证金-4.3483125000000000, createdDate=2022-03-09 16:15:11, fromUserId=0, total=null), UserBillChain(userId=51905043, type=41, size=0.0500920000000000, preBalance=95.6516875000000000, postBalance=95.7017795000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4690, note=单号:4690返还手续费0.0500920000000000, createdDate=2022-03-09 16:15:11, fromUserId=0, total=null), UserBillChain(userId=51905043, type=51, size=-0.1669752000000000, preBalance=95.7017795000000000, postBalance=95.5348043000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4690, note=单号:4690开仓手续费-0.1669752000000000, createdDate=2022-03-09 16:15:16, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.0584416000000000, preBalance=3143.3941621600000000, postBalance=3143.4526037600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4690, note=手续费返佣：0.0584416,单号来源:4690,用户来源: 51905043, createdDate=2022-03-09 16:15:16, fromUserId=51905043, total=null)]
2022-03-09 16:15:16.474 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 16:15:16.474 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-4.3483125000000000
2022-03-09 16:15:16.474 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0500920000000000
2022-03-09 16:15:16.474 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.1669752000000000
2022-03-09 16:15:16.475 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4690' LIMIT 0,1000 
2022-03-09 16:15:16.475 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 16:15:16.564 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 16:15:16.565 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 16:15:16.565 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 16:15:16.647 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 16:15:16.648 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4690' and type=? limit 0,1 
2022-03-09 16:15:16.649 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 16:15:16.733 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:15:16.733 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:51,订单:4690,数据库:0.050092,计算:0.050092
2022-03-09 16:15:16.733 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 16:15:16.733 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:15:16.816 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:15:16.817 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:15:16.817 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:15:16.909 [http-nio-10090-exec-5] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:15:16.910 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4690' and type=? limit 0,1 
2022-03-09 16:15:16.910 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 16:15:16.993 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:15:16.993 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:51,订单:4690,比列:0.300000,数据库:0.03506496,计算:0.035064
2022-03-09 16:15:16.994 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4690' and type=? limit 0,1 
2022-03-09 16:15:16.994 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 16:15:17.085 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:15:17.085 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:51,订单:4690,比列:0.200000,数据库:0.02337664,计算:0.023376
2022-03-09 16:15:17.087 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4690' and type=? limit 0,1 
2022-03-09 16:15:17.087 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 16:15:17.178 [http-nio-10090-exec-5] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:15:17.178 [http-nio-10090-exec-5] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:51,订单:4690,比列:0.500000,数据库:0.05844160,计算:0.058441
2022-03-09 16:15:17.178 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.0584416000000000
2022-03-09 16:15:17.178 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3143.3941621600000000,分佣金额:0.0584416000000000,之后余额:3143.4526037600000000
2022-03-09 16:15:17.178 [http-nio-10090-exec-5] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 16:39:01.209 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2022-03-09 16:39:01.215 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2022-03-09 16:39:07.160 [main] INFO  com.zmj.demo.DemoApplication - Starting DemoApplication using Java 1.8.0_312 on gai.local with PID 72976 (/Users/mac/tools/gitPro/515/demo/target/classes started by mac in /Users/mac/tools/gitPro/515/demo)
2022-03-09 16:39:07.163 [main] INFO  com.zmj.demo.DemoApplication - No active profile set, falling back to default profiles: default
2022-03-09 16:39:08.146 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 16:39:08.148 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
2022-03-09 16:39:08.167 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 14 ms. Found 0 Elasticsearch repository interfaces.
2022-03-09 16:39:08.172 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 16:39:08.172 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Reactive Elasticsearch repositories in DEFAULT mode.
2022-03-09 16:39:08.180 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Reactive Elasticsearch repository interfaces.
2022-03-09 16:39:08.190 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode!
2022-03-09 16:39:08.192 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-03-09 16:39:08.212 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2022-03-09 16:39:08.885 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 10090 (http)
2022-03-09 16:39:08.904 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-10090"]
2022-03-09 16:39:08.905 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2022-03-09 16:39:08.905 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.46]
2022-03-09 16:39:09.119 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2022-03-09 16:39:09.120 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1902 ms
2022-03-09 16:39:10.257 [main] INFO  o.s.b.a.web.servlet.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2022-03-09 16:39:11.023 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Spring Data Elasticsearch: 4.2.1
2022-03-09 16:39:11.024 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client in build: 7.12.1
2022-03-09 16:39:11.024 [main] INFO  o.s.data.elasticsearch.support.VersionInfo - Version Elasticsearch Client used: 7.12.1
2022-03-09 16:39:11.252 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-10090"]
2022-03-09 16:39:11.270 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 10090 (http) with context path ''
2022-03-09 16:39:11.284 [main] INFO  com.zmj.demo.DemoApplication - Started DemoApplication in 4.976 seconds (JVM running for 5.483)
2022-03-09 16:39:57.342 [http-nio-10090-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-03-09 16:39:57.343 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2022-03-09 16:39:57.344 [http-nio-10090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2022-03-09 16:39:57.612 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2022-03-09 16:39:59.078 [http-nio-10090-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2022-03-09 16:39:59.089 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:39:59.119 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:39:59.230 [http-nio-10090-exec-1] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:39:59.235 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:39:59.235 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:39:59.322 [http-nio-10090-exec-1] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:39:59.462 [http-nio-10090-exec-1] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,账户user_balance:[UserBalanceChain(userId=51905043, currencyId=6, balance=100.0000000000000000, hold=0E-16)],user_partner_balance:[UserBalanceChain(userId=51905043, currencyId=6, balance=3144.0952086600000000, hold=0E-16)]
2022-03-09 16:40:04.749 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==>  Preparing: SELECT user_id userId,sum(size) total from `bib_cfd`.`user_bill` where created_date>'' and user_id = ? and type not in (16,27) 
2022-03-09 16:40:04.750 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - ==> Parameters: 51905043(String)
2022-03-09 16:40:04.834 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillTotal - <==      Total: 1
2022-03-09 16:40:04.835 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:40:04.836 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:40:04.919 [http-nio-10090-exec-3] DEBUG c.z.d.d.dev1.AccountDao.getUserBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:40:04.920 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 操作后，数据库金额，balance:100.0000000000000000,hold:0E-16
2022-03-09 16:40:04.932 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 下单前，账户金额:100.0,操作后，账户变化金额:-20.9673015000000000,操作后，计算剩余的金额:79.0326985000000000,操作后，数据库存储的总金额:100.0000000000000000
2022-03-09 16:40:04.934 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:40:04.934 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 16:40:05.014 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 16:40:05.015 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 16:40:05.015 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 16:40:05.094 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 16:40:05.094 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==>  Preparing: SELECT user_id userId,parent_id parentId,gparent_id gparentId,partner_id partnerId,dist_id distId,level,type,defaulted,config,open_bet openBet,is_profession isProfession FROM `bib_cfd`.`user_distributor` WHERE `user_id` = '51904446' LIMIT 0,1 
2022-03-09 16:40:05.094 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - ==> Parameters: 
2022-03-09 16:40:05.177 [http-nio-10090-exec-3] DEBUG c.zmj.demo.dao.dev1.AccountDao.getUserDistributor - <==      Total: 1
2022-03-09 16:40:05.178 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.SqlUtil - 用户:51905043,合伙人:[{"userId":"51905043","parentId":"51905052","gparentId":"0","partnerId":"51905052","distId":"0","level":"1","type":3,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.100000,"userLossGivingBonsRate":0.000000}}, {"userId":"51905052","parentId":"51904446","gparentId":"0","partnerId":"51904446","distId":"0","level":"1","type":0,"defaulted":"0","openBet":1,"isProfession":"0","config":{"allotLowerFeeRate":0.700000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.200000,"rebateUserRatio":0.300000,"userLossGivingBonsRate":0.000000}}, {"userId":"51904446","parentId":"0","gparentId":"0","partnerId":"0","distId":"0","level":"0","type":0,"defaulted":"1","openBet":0,"isProfession":"0","config":{"allotLowerFeeRate":0.500000,"level":0,"maxConfigLevel":10,"partnerTransferOutMin":0.000000,"partnerTransferOutRatio":0.000000,"rebateUserRatio":0.000000,"userLossGivingBonsRate":0.000000}}]
2022-03-09 16:40:05.179 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==>  Preparing: SELECT user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId FROM `bib_cfd`.`user_bill` WHERE `user_id` = '51905043' and created_date>='' 
2022-03-09 16:40:05.179 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - ==> Parameters: 
2022-03-09 16:40:05.279 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBillByUser - <==      Total: 16
2022-03-09 16:40:05.279 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 用户:51905043,流水:[UserBillChain(userId=51905043, type=3, size=-4.3483125000000000, preBalance=100.0000000000000000, postBalance=95.6516875000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4690, note=单号:4690开仓保证金-4.3483125000000000, createdDate=2022-03-09 16:15:11, fromUserId=0, total=null), UserBillChain(userId=51905043, type=41, size=0.0500920000000000, preBalance=95.6516875000000000, postBalance=95.7017795000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4690, note=单号:4690返还手续费0.0500920000000000, createdDate=2022-03-09 16:15:11, fromUserId=0, total=null), UserBillChain(userId=51905043, type=51, size=-0.1669752000000000, preBalance=95.7017795000000000, postBalance=95.5348043000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4690, note=单号:4690开仓手续费-0.1669752000000000, createdDate=2022-03-09 16:15:16, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.0584416000000000, preBalance=3143.3941621600000000, postBalance=3143.4526037600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4690, note=手续费返佣：0.0584416,单号来源:4690,用户来源: 51905043, createdDate=2022-03-09 16:15:16, fromUserId=51905043, total=null), UserBillChain(userId=51905043, type=4, size=-2.8010000000000000, preBalance=95.5348043000000000, postBalance=92.6169885000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4691, note=单号:4691平仓收益-2.9178158000000000, createdDate=2022-03-09 16:22:47, fromUserId=0, total=null), UserBillChain(userId=51905043, type=41, size=0.0500630000000000, preBalance=92.6169885000000000, postBalance=92.6169885000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4691, note=单号:4691返还手续费0.0500630000000000, createdDate=2022-03-09 16:22:47, fromUserId=0, total=null), UserBillChain(userId=51905043, type=52, size=-0.1668788000000000, preBalance=92.6169885000000000, postBalance=92.6169885000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4691, note=单号:4691平仓手续费-0.1668788000000000, createdDate=2022-03-09 16:22:49, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.0584079000000000, preBalance=3143.4526037600000000, postBalance=3143.5110116600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4691, note=手续费返佣：0.0584079,单号来源:4691,用户来源: 51905043, createdDate=2022-03-09 16:22:50, fromUserId=51905043, total=null), UserBillChain(userId=51905043, type=41, size=0.2504100000000000, preBalance=92.6169885000000000, postBalance=92.8673985000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4692, note=单号:4692返还手续费0.2504100000000000, createdDate=2022-03-09 16:23:28, fromUserId=0, total=null), UserBillChain(userId=51905043, type=51, size=-0.8347000000000000, preBalance=92.8673985000000000, postBalance=92.0326985000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4692, note=单号:4692开仓手续费-0.8347000000000000, createdDate=2022-03-09 16:23:29, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.2921450000000000, preBalance=3143.5110116600000000, postBalance=3143.8031566600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4692, note=手续费返佣：0.292145,单号来源:4692,用户来源: 51905043, createdDate=2022-03-09 16:23:30, fromUserId=51905043, total=null), UserBillChain(userId=51905043, type=4, size=-10.6650000000000000, preBalance=13.0000000000000000, postBalance=1.7508960000000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4693, note=单号:4693平仓收益-11.2491040000000000, createdDate=2022-03-09 16:24:09, fromUserId=0, total=null), UserBillChain(userId=51905043, type=59, size=-1.7508960000000000, preBalance=1.7508960000000000, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=0, parentId=0, sourceId=4693, note=订单:4693爆仓剩余返还给默认合伙人,amount:-1.7508960000000000, createdDate=2022-03-09 16:24:09, fromUserId=0, total=null), UserBillChain(userId=51905043, type=41, size=0.2503300000000000, preBalance=0E-16, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4693, note=单号:4693返还手续费0.2503300000000000, createdDate=2022-03-09 16:24:09, fromUserId=0, total=null), UserBillChain(userId=51905043, type=52, size=-0.8344340000000000, preBalance=0E-16, postBalance=0E-16, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=51904446, parentId=51904446, sourceId=4693, note=单号:4693平仓手续费-0.8344340000000000, createdDate=2022-03-09 16:24:09, fromUserId=0, total=null), UserBillChain(userId=51905043, type=16, size=0.2920520000000000, preBalance=3143.8031566600000000, postBalance=3144.0952086600000000, preProfit=0E-16, postProfit=0E-16, preMargin=0E-16, postMargin=0E-16, partnerId=null, parentId=null, sourceId=4693, note=手续费返佣：0.292052,单号来源:4693,用户来源: 51905043, createdDate=2022-03-09 16:24:10, fromUserId=51905043, total=null)]
2022-03-09 16:40:05.280 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 16:40:05.280 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓-保证金:-4.3483125000000000
2022-03-09 16:40:05.280 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0500920000000000
2022-03-09 16:40:05.280 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.1669752000000000
2022-03-09 16:40:05.287 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4690' LIMIT 0,1000 
2022-03-09 16:40:05.288 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 16:40:05.373 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 16:40:05.375 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 16:40:05.375 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 16:40:05.458 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 16:40:05.512 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4690' and type=? limit 0,1 
2022-03-09 16:40:05.512 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 16:40:05.595 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:05.595 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:51,订单:4690,数据库:0.050092,计算:0.050092
2022-03-09 16:40:05.596 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 16:40:05.597 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:40:05.675 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:40:05.676 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:40:05.677 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:40:05.757 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:40:05.759 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4690' and type=? limit 0,1 
2022-03-09 16:40:05.759 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 16:40:05.849 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:05.850 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:51,订单:4690,比列:0.300000,数据库:0.03506496,计算:0.035064
2022-03-09 16:40:05.852 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4690' and type=? limit 0,1 
2022-03-09 16:40:05.853 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 16:40:05.938 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:05.939 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:51,订单:4690,比列:0.200000,数据库:0.02337664,计算:0.023376
2022-03-09 16:40:05.940 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4690' and type=? limit 0,1 
2022-03-09 16:40:05.943 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 16:40:06.026 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:06.028 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:51,订单:4690,比列:0.500000,数据库:0.05844160,计算:0.058441
2022-03-09 16:40:06.028 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.0584416000000000
2022-03-09 16:40:06.028 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3143.3941621600000000,分佣金额:0.0584416000000000,之后余额:3143.4526037600000000
2022-03-09 16:40:06.028 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-2.8010000000000000
2022-03-09 16:40:06.029 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4691' LIMIT 0,1000 
2022-03-09 16:40:06.029 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 16:40:06.110 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 16:40:06.111 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 16:40:06.111 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 16:40:06.196 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 16:40:06.197 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 盈亏计算不正确--->,用户:51905043,订单:4691,类型:4
2022-03-09 16:40:06.198 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4691' 
2022-03-09 16:40:06.198 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 16:40:06.285 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 16:40:06.287 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==>  Preparing: SELECT amount,profit,fee FROM `bib_cfd`.`clearing_transfer` WHERE `user_id` = '51905043' AND `source_type` LIKE 'cfd.bill.type.code.4' AND `order_id` = '4691' AND `margin_type` = 'FIXED' 
2022-03-09 16:40:06.288 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - ==> Parameters: 
2022-03-09 16:40:06.368 [http-nio-10090-exec-3] DEBUG c.z.demo.dao.dev1.AccountDao.getClearlingTransfer - <==      Total: 1
2022-03-09 16:40:06.371 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4691' and type=? limit 0,1 
2022-03-09 16:40:06.371 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 27(Integer)
2022-03-09 16:40:06.475 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:06.476 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51905052,交易类型:4,订单:4691,比例:0.200000,数据库:0.56020000,计算得:0.560200
2022-03-09 16:40:06.477 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4691' and type=? limit 0,1 
2022-03-09 16:40:06.477 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 16:40:06.560 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:06.561 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51904446,交易类型:4,订单:4691,数据库:2.24080000,计算得:2.240800
2022-03-09 16:40:06.561 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.0500630000000000
2022-03-09 16:40:06.561 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.1668788000000000
2022-03-09 16:40:06.562 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4691' LIMIT 0,1000 
2022-03-09 16:40:06.562 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 16:40:06.644 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 16:40:06.644 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 16:40:06.645 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 16:40:06.723 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 16:40:06.726 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4691' and type=? limit 0,1 
2022-03-09 16:40:06.726 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 16:40:06.809 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:06.810 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:52,订单:4691,数据库:0.050063,计算:0.050063
2022-03-09 16:40:06.810 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 16:40:06.811 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:40:06.897 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:40:06.898 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:40:06.898 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:40:06.978 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:40:06.979 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4691' and type=? limit 0,1 
2022-03-09 16:40:06.979 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 16:40:07.060 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:07.061 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:52,订单:4691,比列:0.300000,数据库:0.03504474,计算:0.035044
2022-03-09 16:40:07.061 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4691' and type=? limit 0,1 
2022-03-09 16:40:07.062 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 16:40:07.142 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:07.143 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:52,订单:4691,比列:0.200000,数据库:0.02336316,计算:0.023363
2022-03-09 16:40:07.144 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4691' and type=? limit 0,1 
2022-03-09 16:40:07.144 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 16:40:07.226 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:07.227 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:52,订单:4691,比列:0.500000,数据库:0.05840790,计算:0.058407
2022-03-09 16:40:07.227 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.0584079000000000
2022-03-09 16:40:07.228 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3143.4526037600000000,分佣金额:0.0584079000000000,之后余额:3143.5110116600000000
2022-03-09 16:40:07.228 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.2504100000000000
2022-03-09 16:40:07.228 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 开仓手续费(永续合约) -扣用户:-0.8347000000000000
2022-03-09 16:40:07.228 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4692' LIMIT 0,1000 
2022-03-09 16:40:07.229 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 16:40:07.310 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 16:40:07.311 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 16:40:07.311 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 16:40:07.391 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 16:40:07.392 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4692' and type=? limit 0,1 
2022-03-09 16:40:07.393 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 16:40:07.474 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:07.474 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:51,订单:4692,数据库:0.250410,计算:0.250410
2022-03-09 16:40:07.475 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 16:40:07.476 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:40:07.555 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:40:07.556 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:40:07.557 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:40:07.635 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:40:07.637 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4692' and type=? limit 0,1 
2022-03-09 16:40:07.637 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 16:40:07.720 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:07.720 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:51,订单:4692,比列:0.300000,数据库:0.17528700,计算:0.175287
2022-03-09 16:40:07.722 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4692' and type=? limit 0,1 
2022-03-09 16:40:07.723 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 16:40:07.804 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:07.804 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:51,订单:4692,比列:0.200000,数据库:0.11685800,计算:0.116858
2022-03-09 16:40:07.805 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4692' and type=? limit 0,1 
2022-03-09 16:40:07.806 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 16:40:07.887 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:07.888 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:51,订单:4692,比列:0.500000,数据库:0.29214500,计算:0.292145
2022-03-09 16:40:07.889 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.2921450000000000
2022-03-09 16:40:07.889 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3143.5110116600000000,分佣金额:0.2921450000000000,之后余额:3143.8031566600000000
2022-03-09 16:40:07.889 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓-平仓收益:-10.6650000000000000
2022-03-09 16:40:07.890 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4693' LIMIT 0,1000 
2022-03-09 16:40:07.891 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 16:40:07.972 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 16:40:07.973 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 16:40:07.974 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 16:40:08.054 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 16:40:08.056 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==>  Preparing: SELECT id sourceId,margin_type marginType FROM `bib_cfd`.`swap_order` WHERE `id` = '4693' 
2022-03-09 16:40:08.057 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - ==> Parameters: 
2022-03-09 16:40:08.136 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getMarginType - <==      Total: 1
2022-03-09 16:40:08.136 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4693' and type=? limit 0,1 
2022-03-09 16:40:08.137 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 27(Integer)
2022-03-09 16:40:08.218 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:08.218 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51905052,交易类型:4,订单:4693,比例:0.200000,数据库:2.13300000,计算得:2.133000
2022-03-09 16:40:08.220 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4693' and type=? limit 0,1 
2022-03-09 16:40:08.221 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 27(Integer)
2022-03-09 16:40:08.302 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:08.303 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.ProfitCalc - morePartnerProfit--有合伙人(开启对赌)--盈亏校验--->用户:51905043,默认合伙人:51904446,交易类型:4,订单:4693,数据库:8.53200000,计算得:8.532000
2022-03-09 16:40:08.303 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 爆仓剩余金额，返回给默认合伙人:-1.7508960000000000
2022-03-09 16:40:08.304 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4693' and type=? limit 0,1 
2022-03-09 16:40:08.304 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 59(Integer)
2022-03-09 16:40:08.391 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:08.391 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 爆仓剩余金额，返回给默认合伙人--->用户:51905043,类型:59,爆仓剩余金额:-1.7508960000000000,返还金额:1.7508960000000000
2022-03-09 16:40:08.392 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 返手续费(给用户) 直接去掉不去返佣:0.2503300000000000
2022-03-09 16:40:08.392 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 平仓手续费 -扣用户:-0.8344340000000000
2022-03-09 16:40:08.394 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==>  Preparing: SELECT id,position_id positionId,order_id orderId,user_id userId,symbol,leverage,margin_type marginType,direction,side,quantity,closed_quantity closedQuantity,margin, open_price openPrice,close_price closePrice,avg_cost avgCost,liquidate_by liquidateBy FROM `bib_cfd`.`position_action` WHERE `user_id` = '51905043' AND `order_id` = '4693' LIMIT 0,1000 
2022-03-09 16:40:08.394 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - ==> Parameters: 
2022-03-09 16:40:08.476 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.positionAction - <==      Total: 1
2022-03-09 16:40:08.477 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==>  Preparing: SELECT one_lot_size oneLotSize FROM `bib_cfd`.`instruments` WHERE `symbol` LIKE '%btcusdt%' 
2022-03-09 16:40:08.477 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - ==> Parameters: 
2022-03-09 16:40:08.558 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.instruments - <==      Total: 1
2022-03-09 16:40:08.559 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4693' and type=? limit 0,1 
2022-03-09 16:40:08.560 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 41(Integer)
2022-03-09 16:40:08.649 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:08.650 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - partnerFee--有合伙人--用户先返回手续费--用户返手续费校验--->用户:51905043,交易类型:52,订单:4693,数据库:0.250330,计算:0.250330
2022-03-09 16:40:08.650 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905052' LIMIT 0,1 
2022-03-09 16:40:08.651 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:40:08.730 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:40:08.730 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==>  Preparing: SELECT user_id userId,currency_id currencyId,balance,hold FROM `bib_cfd`.`user_partner_balance` WHERE `user_id` = '51905043' LIMIT 0,1 
2022-03-09 16:40:08.731 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - ==> Parameters: 
2022-03-09 16:40:08.811 [http-nio-10090-exec-3] DEBUG c.z.d.d.d.A.getUserPartnerBalanceHoldByUserId - <==      Total: 1
2022-03-09 16:40:08.812 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4693' and type=? limit 0,1 
2022-03-09 16:40:08.813 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51904446(String), 16(Integer)
2022-03-09 16:40:08.892 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:08.892 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51904446,交易类型:52,订单:4693,比列:0.300000,数据库:0.17523120,计算:0.175230
2022-03-09 16:40:08.893 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4693' and type=? limit 0,1 
2022-03-09 16:40:08.894 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905052(String), 16(Integer)
2022-03-09 16:40:08.987 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:08.987 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905052,交易类型:52,订单:4693,比列:0.200000,数据库:0.11682080,计算:0.116820
2022-03-09 16:40:08.988 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==>  Preparing: select user_id userId,type,size,pre_balance preBalance,post_balance postBalance,pre_profit preProfit,post_profit postProfit,pre_margin preMargin,post_margin postMargin,partner_id partnerId,parent_id parentId,source_id sourceId,note,created_date createdDate,from_user_id fromUserId from `bib_cfd`.`user_bill` where user_id=? and source_id='4693' and type=? limit 0,1 
2022-03-09 16:40:08.989 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - ==> Parameters: 51905043(String), 16(Integer)
2022-03-09 16:40:09.081 [http-nio-10090-exec-3] DEBUG com.zmj.demo.dao.dev1.AccountDao.getUserBill - <==      Total: 1
2022-03-09 16:40:09.081 [http-nio-10090-exec-3] INFO  com.zmj.demo.common.dev1.FeeCalc - feeToPartnerClac--有合伙人--用户自己有返佣--手续费校验-->用户:51905043,合伙人:51905043,交易类型:52,订单:4693,比列:0.500000,数据库:0.29205200,计算:0.292051
2022-03-09 16:40:09.081 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 合伙人手续费  (合伙人收取下面邀请人的交易手续费) 区分普通和默认:0.2920520000000000
2022-03-09 16:40:09.082 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - 分佣金额余额加减--->用户:51905043,类型:16,之前余额:3143.8031566600000000,分佣金额:0.2920520000000000,之后余额:3144.0952086600000000
2022-03-09 16:40:09.082 [http-nio-10090-exec-3] INFO  com.zmj.demo.service.impl.ToolServiceImpl - --------51905043流水--------
2022-03-09 17:40:05.853 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2m36s180ms).
2022-03-09 17:48:43.465 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=7m7s593ms).
2022-03-09 18:23:00.896 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2m17s394ms).
2022-03-09 18:53:47.262 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=11m45s343ms).
2022-03-09 18:58:19.604 [http-nio-10090-exec-6] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Starting...
2022-03-09 18:58:20.556 [http-nio-10090-exec-6] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Start completed.
2022-03-09 18:58:20.557 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.test.SmsEmailCode.getList - ==>  Preparing: SELECT id,created_date as createdDate,mobile,email,template_params as templateParams,status FROM `bib_intgr`.`intgr_message` WHERE `template_code` IN ('MAIL_USERS_REGISTER_CODE','SMS_USERS_MOBILE_REGISTER_CODE') ORDER BY `id` DESC LIMIT 0,10 
2022-03-09 18:58:20.558 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.test.SmsEmailCode.getList - ==> Parameters: 
2022-03-09 18:58:20.654 [http-nio-10090-exec-6] DEBUG com.zmj.demo.dao.test.SmsEmailCode.getList - <==      Total: 10
2022-03-09 18:58:32.260 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.test.SmsEmailCode.getList - ==>  Preparing: SELECT id,created_date as createdDate,mobile,email,template_params as templateParams,status FROM `bib_intgr`.`intgr_message` WHERE `template_code` IN ('MAIL_USERS_REGISTER_CODE','SMS_USERS_MOBILE_REGISTER_CODE') ORDER BY `id` DESC LIMIT 0,10 
2022-03-09 18:58:32.260 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.test.SmsEmailCode.getList - ==> Parameters: 
2022-03-09 18:58:32.353 [http-nio-10090-exec-8] DEBUG com.zmj.demo.dao.test.SmsEmailCode.getList - <==      Total: 10
2022-03-09 20:29:37.381 [HikariPool-2 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-2 - Thread starvation or clock leap detected (housekeeper delta=1h12m46s573ms).
2022-03-09 20:30:03.852 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h12m38s425ms).
